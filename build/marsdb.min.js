!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.Mars=e()}}(function(){return function e(t,n,r){function i(a,u){if(!n[a]){if(!t[a]){var s="function"==typeof require&&require;if(!u&&s)return s(a,!0);if(o)return o(a,!0);var l=new Error("Cannot find module '"+a+"'");throw l.code="MODULE_NOT_FOUND",l}var c=n[a]={exports:{}};t[a][0].call(c.exports,function(e){var n=t[a][1][e];return i(n?n:e)},c,c.exports,e,t,n,r)}return n[a].exports}for(var o="function"==typeof require&&require,a=0;a<r.length;a++)i(r[a]);return i}({1:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(n,"__esModule",{value:!0});var o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a={};!function(){for(var e=0;e<o.length;e++)a[o.charAt(e)]=e}();var u=function(e){return o.charAt(e)},s=function(e){return"="===e?-1:a[e]},l=n.Base64=function(){function e(){r(this,e)}return i(e,[{key:"encode",value:function(e){if("string"==typeof e){var t=e;e=this.newBinary(t.length);for(var n=0;n<t.length;n++){var r=t.charCodeAt(n);if(r>255)throw new Error("Not ascii. Base64.encode can only take ascii strings.");e[n]=r}}for(var i=[],o=null,a=null,s=null,l=null,n=0;n<e.length;n++)switch(n%3){case 0:o=e[n]>>2&63,a=(3&e[n])<<4;break;case 1:a|=e[n]>>4&15,s=(15&e[n])<<2;break;case 2:s|=e[n]>>6&3,l=63&e[n],i.push(u(o)),i.push(u(a)),i.push(u(s)),i.push(u(l)),o=null,a=null,s=null,l=null}return null!=o&&(i.push(u(o)),i.push(u(a)),null==s?i.push("="):i.push(u(s)),null==l&&i.push("=")),i.join("")}},{key:"decode",value:function(e){var t=Math.floor(3*e.length/4);"="==e.charAt(e.length-1)&&(t--,"="==e.charAt(e.length-2)&&t--);for(var n=this.newBinary(t),r=null,i=null,o=null,a=0,u=0;u<e.length;u++){var l=e.charAt(u),c=s(l);switch(u%4){case 0:if(0>c)throw new Error("invalid base64 string");r=c<<2;break;case 1:if(0>c)throw new Error("invalid base64 string");r|=c>>4,n[a++]=r,i=(15&c)<<4;break;case 2:c>=0&&(i|=c>>2,n[a++]=i,o=(3&c)<<6);break;case 3:c>=0&&(n[a++]=o|c)}}return n}},{key:"newBinary",value:function(e){if("undefined"==typeof Uint8Array||"undefined"==typeof ArrayBuffer){for(var t=[],n=0;e>n;n++)t.push(0);return t.$Uint8ArrayPolyfill=!0,t}return new Uint8Array(new ArrayBuffer(e))}}]),e}();n["default"]=new l},{}],2:[function(e,t,n){"use strict";function r(e){return e&&"undefined"!=typeof Symbol&&e.constructor===Symbol?"symbol":typeof e}function i(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==("undefined"==typeof t?"undefined":r(t))&&"function"!=typeof t?e:t}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+("undefined"==typeof t?"undefined":r(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(n,"__esModule",{value:!0}),n.Collection=void 0;var l=e("eventemitter3"),c=i(l),f=e("invariant"),d=i(f),h=e("./DocumentModifier"),p=i(h),y=e("./IndexManager"),v=i(y),g=e("./StorageManager"),m=i(g),b=e("./CursorObservable"),_=i(b),w=e("./Random"),x=i(w),j=e("./Document"),O=i(j),E=new x["default"],k=_["default"],S=m["default"],A=function(e){var t=E.hexString(20),n=[t,"/collection/"+e];return{value:x["default"].createWithSeed.apply(null,n).id(17),seed:t}},P=n.Collection=function(e){function t(e){var n=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];o(this,t);var r=a(this,Object.getPrototypeOf(t).call(this));r._methods={},r._modelName=e;var i=n.storageManager||S;return r.indexManager=new v["default"](r,n),r.storageManager=new i(r,n),r.idGenerator=n.idGenerator||A,r}return u(t,e),s(t,[{key:"create",value:function(e){return new O["default"](this,e)}},{key:"static",value:function(e,n){return(0,d["default"])(!t.prototype.hasOwnProperty(e)&&"function"==typeof n,"Static function `%s` must not be an existing one in a model",e),this[e]=n,this}},{key:"method",value:function(e,t){return(0,d["default"])(!this._methods[e]&&"function"==typeof t,"Method function `%s` already defined in a model",e),this._methods[e]=t,this}},{key:"ensureIndex",value:function(e){return this.indexManager.ensureIndex(e)}},{key:"insert",value:function(e){var t=this,n=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],r=this.idGenerator(this.modelName);return e=this.create(e),e._id=e._id||r.value,n.quiet||this.emit("sync:insert",e,r),this.indexManager.indexDocument(e).then(function(){return t.storageManager.persist(e._id,e).then(function(){return t.emit("insert",e,null,r),e._id})})}},{key:"insertAll",value:function(e,t){var n=this;return Promise.all(e.map(function(e){return n.insert(e,t)}))}},{key:"remove",value:function(e){var t=this,n=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];return n.quiet||this.emit("sync:remove",e,n),this.find(e).exec().then(function(e){(0,d["default"])(e.length<=1||n.multi,"remove(..): multi removing is not enabled by options.multi");var r=e.map(function(e){return t.storageManager["delete"](e._id)}),i=e.map(function(e){return t.indexManager.deindexDocument(e)}),o=r.concat(i);return Promise.all(o).then(function(){return e.forEach(function(e){return t.emit("remove",null,e)}),e})})}},{key:"update",value:function(e,t){var n=this,r=arguments.length<=2||void 0===arguments[2]?{}:arguments[2];return r.upsert=!1,r.quiet||this.emit("sync:update",e,t,r),new p["default"](this,e).modify(t,r).then(function(e){var t=e.original,r=e.updated;r=r.map(function(e){return n.create(e)});var i=r.map(function(e){return n.storageManager.persist(e._id,e)}),o=r.map(function(e,r){return n.indexManager.reindexDocument(t[r],e)}),a=i.concat(o);return Promise.all(a).then(function(){return r.forEach(function(e,r){n.emit("update",e,t[r])}),{modified:r.length,original:t,updated:r}})})}},{key:"getIndexIds",value:function(){return this.indexes._id.getAll()}},{key:"find",value:function(e){return new k(this,e)}},{key:"findOne",value:function(e,t){return this.find(e).sort(t).limit(1).aggregate(function(e){return e[0]})}},{key:"count",value:function(e){return this.ids(e).then(function(e){return e.length})}},{key:"ids",value:function(e){return new k(this,e).ids()}},{key:"modelName",get:function(){return this._modelName}},{key:"indexes",get:function(){return this.indexManager.indexes}},{key:"storage",get:function(){return this.storageManager}}],[{key:"defaultStorageManager",value:function(e){S=e}},{key:"defaultIdGenerator",value:function(e){A=e}},{key:"defaultCursorClass",value:function(e){k=e}}]),t}(c["default"]);n["default"]=P},{"./CursorObservable":5,"./Document":6,"./DocumentModifier":8,"./IndexManager":12,"./Random":14,"./StorageManager":15,eventemitter3:17,invariant:20}],3:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(n,"__esModule",{value:!0}),n.CollectionIndex=void 0;var a=e("invariant"),u=r(a),s=n.CollectionIndex=function(){function e(){var t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];i(this,e),(0,u["default"])(t.fieldName,'CollectionIndex(...): you must specify a "feildName" option'),(0,u["default"])(!Array.isArray(t.fieldName),"CollectionIndex(...): compound index is not supported yet"),this.fieldName=t.fieldName,this.unique=t.unique||!1,this.sparse=t.sparse||!1,this.reset()}return o(e,[{key:"reset",value:function(){}},{key:"insert",value:function(e){}},{key:"remove",value:function(e){}},{key:"update",value:function(e,t){}},{key:"getMatching",value:function(e){}},{key:"getBetweenBounds",value:function(e){}},{key:"getAll",value:function(e){}}]),e}();n["default"]=s},{invariant:20}],4:[function(e,t,n){"use strict";function r(e){return e&&"undefined"!=typeof Symbol&&e.constructor===Symbol?"symbol":typeof e}function i(e){return e&&e.__esModule?e:{"default":e}}function o(e){return e&&"undefined"!=typeof Symbol&&e.constructor===Symbol?"symbol":"undefined"==typeof e?"undefined":r(e)}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function u(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==("undefined"==typeof t?"undefined":r(t))&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+("undefined"==typeof t?"undefined":r(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function l(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var c,f=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(n,"__esModule",{value:!0}),n.Cursor=n.PIPELINE_PROCESSORS=n.PIPELINE_TYPE=void 0;var d=e("lodash/collection/each"),h=i(d),p=e("lodash/lang/isObject"),y=i(p),v=e("lodash/lang/isArray"),g=i(v),m=e("lodash/lang/isEmpty"),b=i(m),_=e("eventemitter3"),w=i(_),x=e("invariant"),j=i(x),O=e("keymirror"),E=i(O),k=e("./DocumentRetriver"),S=i(k),A=e("./DocumentMatcher"),P=i(A),M=e("./DocumentSorter"),$=i(M),I={},N=n.PIPELINE_TYPE=(0,E["default"])({Filter:null,Sort:null,Map:null,Aggregate:null,Reduce:null,Join:null,JoinEach:null,JoinAll:null,IfNotEmpty:null}),C=n.PIPELINE_PROCESSORS=(c={},l(c,N.Filter,function(e,t){return e.filter(t.value)}),l(c,N.Sort,function(e,t){return e.sort(t.value)}),l(c,N.Map,function(e,t){return e.map(t.value)}),l(c,N.Aggregate,function(e,t){return t.value(e)}),l(c,N.Reduce,function(e,t){return e.reduce(t.value,t.args[0])}),l(c,N.Join,function(e,t,n){return(0,g["default"])(e)?C[N.JoinEach](e,t,n):C[N.JoinAll](e,t,n)}),l(c,N.JoinEach,function(e,t,n){e=(0,g["default"])(e)?e:[e];var r=e.length;return Promise.all(e.map(function(e,i){return C[N.JoinAll](e,t,n,i,r)}))}),l(c,N.JoinAll,function(e,t,n){var r=arguments.length<=3||void 0===arguments[3]?0:arguments[3],i=arguments.length<=4||void 0===arguments[4]?1:arguments[4],o=n._propagateUpdate?n._propagateUpdate.bind(n):function(){},a=t.value(e,o,r,i);return a=(0,g["default"])(a)?a:[a],a.forEach(function(e){(0,y["default"])(e)&&e.then&&e.parent&&(e.parent(n),n.once("stopped",e.stop),n.once("cursorChanged",e.stop))}),Promise.all(a).then(function(){return e})}),l(c,N.IfNotEmpty,function(e){return(0,b["default"])(e)?I:e}),c),T=function(e){function t(e,n){a(this,t);var r=u(this,Object.getPrototypeOf(t).call(this));return r.db=e,r._query=n,r._pipeline=[],r._executing=null,r._ensureMatcherSorter(),r}return s(t,e),f(t,[{key:"skip",value:function(e){return this._ensureNotExecuting(),(0,j["default"])(e>=0||"undefined"==typeof e,"skip(...): skip must be a positive number"),this._skip=e,this}},{key:"limit",value:function(e){return this._ensureNotExecuting(),(0,j["default"])(e>=0||"undefined"==typeof e,"limit(...): limit must be a positive number"),this._limit=e,this}},{key:"find",value:function(e){return this._ensureNotExecuting(),this._query=e||this._query,this._ensureMatcherSorter(),this}},{key:"sort",value:function(e){return this._ensureNotExecuting(),(0,j["default"])("object"===("undefined"==typeof e?"undefined":o(e))||"undefined"==typeof e||Array.isArray(e),"sort(...): argument must be an object"),this._sort=e,this._ensureMatcherSorter(),this}},{key:"sortFunc",value:function(e){return(0,j["default"])("function"==typeof e,"sortFunc(...): argument must be a function"),this.addPipeline(N.Sort,e),this}},{key:"filter",value:function(e){return(0,j["default"])("function"==typeof e,"filter(...): argument must be a function"),this.addPipeline(N.Filter,e),this}},{key:"map",value:function(e){return(0,j["default"])("function"==typeof e,"map(...): mapper must be a function"),this.addPipeline(N.Map,e),this}},{key:"reduce",value:function(e,t){return(0,j["default"])("function"==typeof e,"reduce(...): reducer argument must be a function"),this.addPipeline(N.Reduce,e,t),this}},{key:"aggregate",value:function(e){return(0,j["default"])("function"==typeof e,"aggregate(...): aggregator must be a function"),this.addPipeline(N.Aggregate,e),this}},{key:"join",value:function(e){return(0,j["default"])("function"==typeof e,"join(...): argument must be a function"),this.addPipeline(N.Join,e),this}},{key:"joinEach",value:function(e){return(0,j["default"])("function"==typeof e,"joinEach(...): argument must be a function"),this.addPipeline(N.JoinEach,e),this}},{key:"joinAll",value:function(e){return(0,j["default"])("function"==typeof e,"joinAll(...): argument must be a function"),this.addPipeline(N.JoinAll,e),this}},{key:"ifNotEmpty",value:function(){return this.addPipeline(N.IfNotEmpty),this}},{key:"addPipeline",value:function(e,t){this._ensureNotExecuting(),(0,j["default"])(e&&N[e],"Unknown pipeline processor type %s",e);for(var n=arguments.length,r=Array(n>2?n-2:0),i=2;n>i;i++)r[i-2]=arguments[i];return this._pipeline.push({type:e,value:t,args:r||[]}),this}},{key:"processPipeline",value:function(e){var t=this,n=arguments.length<=1||void 0===arguments[1]?0:arguments[1],r=this._pipeline[n];return r?Promise.resolve(C[r.type](e,r,this)).then(function(e){return e===I?e:t.processPipeline(e,n+1)}):Promise.resolve(e)}},{key:"processSkipLimits",value:function(e){var t=this._skip||0,n=this._limit||e.length;return e.slice(t,n+t)}},{key:"exec",value:function(){var e=this;return this._executing=this._matchObjects().then(function(t){return e.processPipeline(t)}).then(function(t){return e._executing=null,t}),this._executing}},{key:"ids",value:function(){var e=this;return this._executing=this._matchObjects().then(function(e){return e.map(function(e){return e._id})}).then(function(t){return e._executing=null,t}),this._executing}},{key:"then",value:function(e,t){return this.exec().then(e,t)}},{key:"whenNotExecuting",value:function(){return Promise.resolve(this._executing)}},{key:"_matchObjects",value:function(){var e=this;return new S["default"](this.db).retriveForQeury(this._query).then(function(t){var n=[],r=e._limit&&!e._skip&&!e._sorter;if((0,h["default"])(t,function(t){var i=e._matcher.documentMatches(t);return i.result&&n.push(t),r&&n.length===e._limit?!1:void 0}),r)return n;if(e._sorter){var i=e._sorter.getComparator();n.sort(i)}return e.processSkipLimits(n)})}},{key:"_ensureMatcherSorter",value:function(){this._sorter=void 0,this._matcher=new P["default"](this._query||{}),(this._matcher.hasGeoQuery||this._sort)&&(this._sorter=new $["default"](this._sort||[],{matcher:this._matcher}))}},{key:"_ensureNotExecuting",value:function(){(0,j["default"])(!this.isExecuting,"_ensureNotExecuting(...): cursor is executing, cursor is immutable!")}},{key:"isExecuting",get:function(){return!!this._executing}}]),t}(w["default"]);n.Cursor=T,n["default"]=T},{"./DocumentMatcher":7,"./DocumentRetriver":9,"./DocumentSorter":10,eventemitter3:17,invariant:20,keymirror:19,"lodash/collection/each":25,"lodash/lang/isArray":85,"lodash/lang/isEmpty":86,"lodash/lang/isObject":92}],5:[function(e,t,n){"use strict";function r(e){return e&&"undefined"!=typeof Symbol&&e.constructor===Symbol?"symbol":typeof e}function i(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==("undefined"==typeof t?"undefined":r(t))&&"function"!=typeof t?e:t}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+("undefined"==typeof t?"undefined":r(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function s(e,t,n){var r=null,i=0,o=null,a=!0,u=null,s=function(){var s=this,l=arguments;if(o){var c=n&&i>=n;a=!c,c&&u&&(clearTimeout(r),u())}else o=new Promise(function(n,c){(u=function(){a?(r=setTimeout(u,t),a=!1):(o=null,i=0,r=null,a=!0,u=null,n(e.apply(s,l)))})()});return i+=1,o},l=function(e){n=e},c=function(e){t=e},f=function(){clearTimeout(r)};return s.updateBatchSize=l,s.updateWait=c,s.cancel=f,s}var l=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(n,"__esModule",{value:!0}),n.CursorObservable=void 0,n.debounce=s;var c=e("lodash/collection/size"),f=i(c),d=e("lodash/lang/isArray"),h=i(d),p=e("./Cursor"),y=i(p),v=e("./EJSON"),g=i(v),m=function(e){function t(e,n){o(this,t);var r=a(this,Object.getPrototypeOf(t).call(this,e,n));return r.update=s(r.update.bind(r),1e3/15,10),r.maybeUpdate=r.maybeUpdate.bind(r),r}return u(t,e),l(t,[{key:"batchSize",value:function(e){return this.update.updateBatchSize(e),this}},{key:"debounce",value:function(e){return this.update.updateWait(e),this}},{key:"observe",value:function(e){var t=this,n=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],r=function(e,n){return t.maybeUpdate(e,n)};this.db.on("insert",r),this.db.on("update",r),this.db.on("remove",r);var i=function(){t.db.removeListener("insert",r),t.db.removeListener("update",r),t.db.removeListener("remove",r),t.removeListener("update",e),t.emit("stopped",e)};e=this._prepareListener(e),this.on("update",e),this.on("stop",i);var o=function(e){t._parentCursor=e},a=function s(e){return{parent:o,stop:i,then:function(n,r){return n=t._prepareListener(n),s(e.then(n,r))}}};if(n.declare)return this;var u=this.update(!0);return a(u)}},{key:"stopObservers",value:function(){this.update.cancel(),this.emit("stop")}},{key:"update",value:function(){var e=this,t=arguments.length<=0||void 0===arguments[0]?!1:arguments[0];return this.exec().then(function(n){return e._latestResult=n,e._updateLatestIds(),e._propagateUpdate(t),n})}},{key:"maybeUpdate",value:function(e,t){var n=!e&&t&&(!this._latestIds||this._latestIds.has(t._id)),r=n||e&&t&&(this._matcher.documentMatches(e).result||this._matcher.documentMatches(t).result)&&((0,f["default"])(e)!==(0,f["default"])(t)||e.updatedAt&&(!t.updatedAt||t.updatedAt&&e.updatedAt>t.updatedAt)||!g["default"].equals(e,t)),i=r||e&&!t&&this._matcher.documentMatches(e).result;return i?(this.emit("cursorChanged"),this.update()):void 0}},{key:"_prepareListener",value:function(e){return s(e,0,0)}},{key:"_propagateUpdate",value:function(){var e=arguments.length<=0||void 0===arguments[0]?!1:arguments[0];this.emit("update",this._latestResult,e),!e&&this._parentCursor&&this._parentCursor._propagateUpdate&&this._parentCursor._propagateUpdate(!1)}},{key:"_updateLatestIds",value:function(){(0,h["default"])(this._latestResult)?this._latestIds=new Set(this._latestResult.map(function(e){return e._id})):this._latestResult&&this._latestResult._id&&(this._latestIds=new Set([this._latestResult._id]))}}]),t}(y["default"]);n.CursorObservable=m,n["default"]=m},{"./Cursor":4,"./EJSON":11,"lodash/collection/size":31,"lodash/lang/isArray":85}],6:[function(e,t,n){"use strict";function r(e){return e&&"undefined"!=typeof Symbol&&e.constructor===Symbol?"symbol":typeof e}function i(e){return e&&e.__esModule?e:{"default":e}}function o(e){return e&&"undefined"!=typeof Symbol&&e.constructor===Symbol?"symbol":"undefined"==typeof e?"undefined":r(e)}function a(e){var t=this,n=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];(0,E["default"])(e,"Document(...): you must give a collection for the document"),n=(0,b["default"])(n)?S["default"].parse(n):n,Object.defineProperty(this,"remove",{value:function(){return(0,E["default"])(t._id,"remove(...): document must have an _id for remove"),e.remove({_id:self._id})},writable:!1}),Object.defineProperty(this,"update",{value:function(t){return(0,E["default"])(this._id,"update(...): document must have an _id for update"),e.update({_id:self._id},t)},writable:!1}),Object.defineProperty(this,"copy",{value:function(){return new a(e,S["default"].clone(t))},writable:!1}),Object.defineProperty(this,"serialize",{value:function(){return S["default"].stringify(t)},writable:!1});for(var r in e._methods)Object.defineProperty(this,r,{value:e._methods[r],writable:!1});(0,y["default"])(this,n)}function u(e){return"string"==typeof e||"number"==typeof e}function s(e){return u(e)||e&&"object"===("undefined"==typeof e?"undefined":o(e))&&e._id&&u(e._id)&&1===(0,j["default"])(e)}function l(e){return(0,g["default"])(e)&&!S["default"].isBinary(e)}function c(e){return e&&3===A._type(e)}function f(e){return l(e)||c(e)}function d(e,t){if(!c(e))return!1;var n=void 0;return(0,w["default"])(e,function(r,i){var o="$"===i.substr(0,1);if(void 0===n)n=o;else if(n!==o){if(!t)throw new Error("Inconsistent operator: "+JSON.stringify(e));n=!1}}),!!n}function h(e){return/^[0-9]+$/.test(e)}Object.defineProperty(n,"__esModule",{value:!0}),n.MongoTypeComp=void 0,n.Document=a,n.selectorIsId=u,n.selectorIsIdPerhapsAsObject=s,n.isArray=l,n.isPlainObject=c,n.isIndexable=f,n.isOperatorObject=d,n.isNumericKey=h;var p=e("lodash/object/assign"),y=i(p),v=e("lodash/lang/isArray"),g=i(v),m=e("lodash/lang/isString"),b=i(m),_=e("lodash/collection/each"),w=i(_),x=e("lodash/collection/size"),j=i(x),O=e("invariant"),E=i(O),k=e("./EJSON"),S=i(k);n["default"]=a;var A=n.MongoTypeComp={_type:function(e){return"number"==typeof e?1:"string"==typeof e?2:"boolean"==typeof e?8:l(e)?4:null===e?10:e instanceof RegExp?11:"function"==typeof e?13:e instanceof Date?9:S["default"].isBinary(e)?5:3},_equal:function(e,t){return S["default"].equals(e,t,{keyOrderSensitive:!0})},_typeorder:function(e){return[-1,1,2,3,4,5,-1,6,7,8,0,9,-1,100,2,100,1,8,1][e]},_cmp:function(e,t){if(void 0===e)return void 0===t?0:-1;if(void 0===t)return 1;var n=A._type(e),r=A._type(t),i=A._typeorder(n),o=A._typeorder(r);if(i!==o)return o>i?-1:1;if(n!==r)throw Error("Missing type coercion logic in _cmp");if(7===n&&(n=r=2,e=e.toHexString(),t=t.toHexString()),9===n&&(n=r=1,e=e.getTime(),t=t.getTime()),1===n)return e-t;if(2===r)return t>e?-1:e===t?0:1;if(3===n){var a=function(e){var t=[];for(var n in e)t.push(n),t.push(e[n]);return t};return A._cmp(a(e),a(t))}if(4===n)for(var u=0;;u++){if(u===e.length)return u===t.length?0:-1;if(u===t.length)return 1;var s=A._cmp(e[u],t[u]);if(0!==s)return s}if(5===n){if(e.length!==t.length)return e.length-t.length;for(u=0;u<e.length;u++){if(e[u]<t[u])return-1;if(e[u]>t[u])return 1}return 0}if(8===n)return e?t?0:1:t?-1:0;if(10===n)return 0;if(11===n)throw Error("Sorting not supported on regular expression");if(13===n)throw Error("Sorting not supported on Javascript code");throw Error("Unknown type to sort")}}},{"./EJSON":11,invariant:20,"lodash/collection/each":25,"lodash/collection/size":31,"lodash/lang/isArray":85,"lodash/lang/isString":93,"lodash/object/assign":95}],7:[function(e,t,n){"use strict";function r(e){return e&&"undefined"!=typeof Symbol&&e.constructor===Symbol?"symbol":typeof e}function i(e){return e&&e.__esModule?e:{"default":e}}function o(e){return e&&"undefined"!=typeof Symbol&&e.constructor===Symbol?"symbol":"undefined"==typeof e?"undefined":r(e)}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function u(e){return function(t){return t instanceof RegExp?(0,y["default"])(t,e):"string"!=typeof t?!1:(e.lastIndex=0,e.test(t))}}function s(e){if((0,U.isOperatorObject)(e))throw Error("Can't create equalityValueSelector for operator object");return null==e?function(e){return null==e}:function(t){return U.MongoTypeComp._equal(e,t)}}function l(e,t){t=t||{};var n,r=e.split("."),i=r.length?r[0]:"",o=(0,U.isNumericKey)(i),a=r.length>=2&&(0,U.isNumericKey)(r[1]);r.length>1&&(n=l(r.slice(1).join(".")));var u=function(e){return e.dontIterate||delete e.dontIterate,e.arrayIndices&&!e.arrayIndices.length&&delete e.arrayIndices,e};return function(e,r){if(r||(r=[]),(0,U.isArray)(e)){if(!(o&&i<e.length))return[];r=r.concat(+i,"x")}var s=e[i];if(!n)return[u({value:s,dontIterate:(0,U.isArray)(e)&&(0,U.isArray)(s),arrayIndices:r})];if(!(0,U.isIndexable)(s))return(0,U.isArray)(e)?[]:[u({value:void 0,arrayIndices:r})];var l=[],c=function(e){Array.prototype.push.apply(l,e)};return c(n(s,r)),!(0,U.isArray)(s)||a&&t.forSort||(0,P["default"])(s,function(e,t){(0,U.isPlainObject)(e)&&c(n(e,r.concat(t)))}),l}}function c(e,t){var n=[];return(0,P["default"])(e,function(e){var r=(0,U.isArray)(e.value);t&&r&&!e.dontIterate||n.push({value:e.value,arrayIndices:e.arrayIndices}),r&&!e.dontIterate&&(0,P["default"])(e.value,function(t,r){n.push({value:t,arrayIndices:(e.arrayIndices||[]).concat(r)})})}),n}var f=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(n,"__esModule",{value:!0}),n.ELEMENT_OPERATORS=n.DocumentMatcher=void 0,n.regexpElementMatcher=u,n.equalityElementMatcher=s,n.makeLookupFunction=l,n.expandArraysInBranches=c;var d=e("lodash/lang/isEmpty"),h=i(d),p=e("lodash/lang/isEqual"),y=i(p),v=e("lodash/lang/isArray"),g=i(v),m=e("lodash/lang/isNumber"),b=i(m),_=e("lodash/lang/isObject"),w=i(_),x=e("lodash/lang/isNaN"),j=i(x),O=e("lodash/object/has"),E=i(O),k=e("lodash/object/keys"),S=i(k),A=e("lodash/collection/each"),P=i(A),M=e("lodash/collection/contains"),$=i(M),I=e("lodash/collection/all"),N=i(I),C=e("lodash/collection/map"),T=i(C),L=e("lodash/collection/any"),D=i(L),J=e("lodash/utility/identity"),q=i(J),R=e("./EJSON"),B=i(R),V=e("geojson-utils"),F=i(V),U=e("./Document"),W=n.DocumentMatcher=function(){function e(t){a(this,e),this._paths={},this._hasGeoQuery=!1,this._hasWhere=!1,this._isSimple=!0,this._matchingDocument=void 0,this._selector=null,this._docMatcher=this._compileSelector(t)}return f(e,[{key:"documentMatches",value:function(e){if(!e||"object"!==("undefined"==typeof e?"undefined":o(e)))throw Error("documentMatches needs a document");return this._docMatcher(e)}},{key:"_compileSelector",value:function(e){if(e instanceof Function)return this._isSimple=!1,this._selector=e,this._recordPathUsed(""),function(t){return{result:!!e.call(t)}};if((0,U.selectorIsId)(e))return this._selector={_id:e},this._recordPathUsed("_id"),function(t){return{result:B["default"].equals(t._id,e)}};if(!e||"_id"in e&&!e._id)return this._isSimple=!1,ie;if("boolean"==typeof e||(0,U.isArray)(e)||B["default"].isBinary(e))throw new Error("Invalid selector: "+e);return this._selector=B["default"].clone(e),K(e,this,{isRoot:!0})}},{key:"_recordPathUsed",value:function(e){this._paths[e]=!0}},{key:"_getPaths",value:function(){return(0,S["default"])(this._paths)}},{key:"hasGeoQuery",get:function(){return this._hasGeoQuery}},{key:"hasWhere",get:function(){return this._hasWhere}},{key:"isSimple",get:function(){return this._isSimple}}]),e}();n["default"]=W;var K=function(e,t){var n=arguments.length<=2||void 0===arguments[2]?{}:arguments[2],r=[];return(0,P["default"])(e,function(e,i){if("$"===i.substr(0,1)){if(!(0,E["default"])(Y,i))throw new Error("Unrecognized logical operator: "+i);t._isSimple=!1,r.push(Y[i](e,t,n.inElemMatch))}else{n.inElemMatch||t._recordPathUsed(i);var o=l(i),a=z(e,t,n.isRoot);r.push(function(e){var t=o(e);return a(t)})}}),ue(r)},z=function(e,t,n){return e instanceof RegExp?(t._isSimple=!1,G(u(e))):(0,U.isOperatorObject)(e)?Q(e,t,n):G(s(e))},G=function(e){var t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];return function(n){var r=n;t.dontExpandLeafArrays||(r=c(n,t.dontIncludeLeafArrays));var i={};return i.result=(0,D["default"])(r,function(t){var n=e(t.value);return"number"==typeof n&&(t.arrayIndices||(t.arrayIndices=[n]),n=!0),n&&t.arrayIndices&&(i.arrayIndices=t.arrayIndices),n}),i}},Q=function(e,t,n){var r=[];return(0,P["default"])(e,function(i,o){var a=(0,$["default"])(["$lt","$lte","$gt","$gte"],o)&&(0,b["default"])(i),u="$ne"===o&&!(0,w["default"])(i),s=(0,$["default"])(["$in","$nin"],o)&&(0,g["default"])(i)&&!(0,D["default"])(i,w["default"]);if("$eq"===o||a||s||u||(t._isSimple=!1),(0,E["default"])(Z,o))r.push(Z[o](i,e,t,n));else{if(!(0,E["default"])(re,o))throw new Error("Unrecognized operator: "+o);var l=re[o];r.push(G(l.compileElementSelector(i,e,t),l))}}),se(r)},H=function(e,t,n){if(!(0,U.isArray)(e)||(0,h["default"])(e))throw Error("$and/$or/$nor must be nonempty array");return(0,T["default"])(e,function(e){if(!(0,U.isPlainObject)(e))throw Error("$or/$and/$nor entries need to be full objects");return K(e,t,{inElemMatch:n})})},Y={$and:function(e,t,n){var r=H(e,t,n);return ue(r)},$or:function(e,t,n){var r=H(e,t,n);return 1===r.length?r[0]:function(e){var t=(0,D["default"])(r,function(t){return t(e).result});return{result:t}}},$nor:function(e,t,n){var r=H(e,t,n);return function(e){var t=(0,N["default"])(r,function(t){return!t(e).result});return{result:t}}},$where:function(e,t){return t._recordPathUsed(""),t._hasWhere=!0,e instanceof Function||(e=Function("obj","return "+e)),function(t){return{result:e.call(t,t)}}},$comment:function(){return function(){return{result:!0}}}},X=function(e){return function(t){var n=e(t);return{result:!n.result}}},Z={$not:function(e,t,n){return X(z(e,n))},$ne:function(e){return X(G(s(e)))},$nin:function(e){return X(G(re.$in.compileElementSelector(e)))},$exists:function(e){var t=G(function(e){return void 0!==e});return e?t:X(t)},$options:function(e,t){if(!(0,E["default"])(t,"$regex"))throw Error("$options needs a $regex");return oe},$maxDistance:function(e,t){if(!t.$near)throw Error("$maxDistance needs a $near");return oe},$all:function(e,t,n){if(!(0,U.isArray)(e))throw Error("$all requires array");if((0,h["default"])(e))return ie;var r=[];return(0,P["default"])(e,function(e){if((0,U.isOperatorObject)(e))throw Error("no $ expressions in $all");r.push(z(e,n))}),se(r)},$near:function(e,t,n,r){if(!r)throw Error("$near can't be inside another $ operator");n._hasGeoQuery=!0;var i,o,a;if((0,U.isPlainObject)(e)&&(0,E["default"])(e,"$geometry"))i=e.$maxDistance,o=e.$geometry,a=function(e){return e&&e.type?"Point"===e.type?F["default"].pointDistance(o,e):F["default"].geometryWithinRadius(e,o,i)?0:i+1:null};else{if(i=t.$maxDistance,!(0,U.isArray)(e)&&!(0,U.isPlainObject)(e))throw Error("$near argument must be coordinate pair or GeoJSON");o=te(e),a=function(e){return(0,U.isArray)(e)||(0,U.isPlainObject)(e)?ee(o,e):null}}return function(e){e=c(e);var t={result:!1};return(0,P["default"])(e,function(e){var n=a(e.value);null===n||n>i||void 0!==t.distance&&t.distance<=n||(t.result=!0,
t.distance=n,e.arrayIndices?t.arrayIndices=e.arrayIndices:delete t.arrayIndices)}),t}}},ee=function(e,t){e=te(e),t=te(t);var n=e[0]-t[0],r=e[1]-t[1];return(0,j["default"])(n)||(0,j["default"])(r)?null:Math.sqrt(n*n+r*r)},te=function(e){return(0,T["default"])(e,q["default"])},ne=function(e){return{compileElementSelector:function(t){if((0,U.isArray)(t))return function(){return!1};void 0===t&&(t=null);var n=U.MongoTypeComp._type(t);return function(r){return void 0===r&&(r=null),U.MongoTypeComp._type(r)!==n?!1:e(U.MongoTypeComp._cmp(r,t))}}}},re=n.ELEMENT_OPERATORS={$lt:ne(function(e){return 0>e}),$gt:ne(function(e){return e>0}),$lte:ne(function(e){return 0>=e}),$gte:ne(function(e){return e>=0}),$mod:{compileElementSelector:function(e){if(!(0,U.isArray)(e)||2!==e.length||"number"!=typeof e[0]||"number"!=typeof e[1])throw Error("argument to $mod must be an array of two numbers");var t=e[0],n=e[1];return function(e){return"number"==typeof e&&e%t===n}}},$in:{compileElementSelector:function(e){if(!(0,U.isArray)(e))throw Error("$in needs an array");var t=[];return(0,P["default"])(e,function(e){if(e instanceof RegExp)t.push(u(e));else{if((0,U.isOperatorObject)(e))throw Error("cannot nest $ under $in");t.push(s(e))}}),function(e){return void 0===e&&(e=null),(0,D["default"])(t,function(t){return t(e)})}}},$size:{dontExpandLeafArrays:!0,compileElementSelector:function(e){if("string"==typeof e)e=0;else if("number"!=typeof e)throw Error("$size needs a number");return function(t){return(0,U.isArray)(t)&&t.length===e}}},$type:{dontIncludeLeafArrays:!0,compileElementSelector:function(e){if("number"!=typeof e)throw Error("$type needs a number");return function(t){return void 0!==t&&U.MongoTypeComp._type(t)===e}}},$regex:{compileElementSelector:function(e,t){if(!("string"==typeof e||e instanceof RegExp))throw Error("$regex has to be a string or RegExp");var n;if(void 0!==t.$options){if(/[^gim]/.test(t.$options))throw new Error("Only the i, m, and g regexp options are supported");var r=e instanceof RegExp?e.source:e;n=new RegExp(r,t.$options)}else n=e instanceof RegExp?e:new RegExp(e);return u(n)}},$elemMatch:{dontExpandLeafArrays:!0,compileElementSelector:function(e,t,n){if(!(0,U.isPlainObject)(e))throw Error("$elemMatch need an object");var r,i;return(0,U.isOperatorObject)(e,!0)?(r=z(e,n),i=!1):(r=K(e,n,{inElemMatch:!0}),i=!0),function(e){if(!(0,U.isArray)(e))return!1;for(var t=0;t<e.length;++t){var n,o=e[t];if(i){if(!(0,U.isPlainObject)(o)&&!(0,U.isArray)(o))return!1;n=o}else n=[{value:o,dontIterate:!0}];if(r(n).result)return t}return!1}}}},ie=function(e){return{result:!1}},oe=function(e){return{result:!0}},ae=function(e){return 0===e.length?oe:1===e.length?e[0]:function(t){var n={};return n.result=(0,N["default"])(e,function(e){var r=e(t);return r.result&&void 0!==r.distance&&void 0===n.distance&&(n.distance=r.distance),r.result&&r.arrayIndices&&(n.arrayIndices=r.arrayIndices),r.result}),n.result||(delete n.distance,delete n.arrayIndices),n}},ue=ae,se=ae},{"./Document":6,"./EJSON":11,"geojson-utils":18,"lodash/collection/all":22,"lodash/collection/any":23,"lodash/collection/contains":24,"lodash/collection/each":25,"lodash/collection/map":29,"lodash/lang/isArray":85,"lodash/lang/isEmpty":86,"lodash/lang/isEqual":87,"lodash/lang/isNaN":89,"lodash/lang/isNumber":91,"lodash/lang/isObject":92,"lodash/object/has":96,"lodash/object/keys":97,"lodash/utility/identity":101}],8:[function(e,t,n){"use strict";function r(e){return e&&"undefined"!=typeof Symbol&&e.constructor===Symbol?"symbol":typeof e}function i(e){return e&&e.__esModule?e:{"default":e}}function o(e){return e&&"undefined"!=typeof Symbol&&e.constructor===Symbol?"symbol":"undefined"==typeof e?"undefined":r(e)}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(n,"__esModule",{value:!0}),n.DocumentModifier=void 0;var s=e("lodash/lang/isObject"),l=i(s),c=e("lodash/object/assign"),f=i(c),d=e("lodash/collection/each"),h=i(d),p=e("lodash/collection/all"),y=i(p),v=e("lodash/utility/identity"),g=i(v),m=e("./EJSON"),b=i(m),_=e("./DocumentRetriver"),w=i(_),x=e("./DocumentMatcher"),j=i(x),O=e("./DocumentSorter"),E=i(O),k=e("./Document"),S=n.DocumentModifier=function(){function e(t){var n=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];a(this,e),this.db=t,this._matcher=new j["default"](n),this._query=n}return u(e,[{key:"modify",value:function(e){var t=this,n=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];return new w["default"](this.db).retriveForQeury(this._query).then(function(r){var i=[],o=[];return(0,h["default"])(r,function(r){var a=t._matcher.documentMatches(r);if(a.result){var u=(0,f["default"])({arrayIndices:a.arrayIndices},n),s=t._modifyDocument(r,e,u);o.push(s),i.push(r)}}),{updated:o,original:i}})}},{key:"_modifyDocument",value:function(e,t){var n=arguments.length<=2||void 0===arguments[2]?{}:arguments[2];if(!(0,k.isPlainObject)(t))throw new Error("Modifier must be an object");t=b["default"].clone(t);var r,i=(0,k.isOperatorObject)(t);if(i)r=b["default"].clone(e),(0,h["default"])(t,function(e,t){var i=M[t];if(n.isInsert&&"$setOnInsert"===t&&(i=M.$set),!i)throw new Error("Invalid modifier specified "+t);(0,h["default"])(e,function(e,o){if(""===o)throw new Error("An empty update path is not valid.");if("_id"===o)throw new Error("Mod on _id not allowed");var a=o.split(".");if(!(0,y["default"])(a,g["default"]))throw new Error("The update path '"+o+"' contains an empty field name, which is not allowed.");var u=A(r,a,{noCreate:P[t],forbidArray:"$rename"===t,arrayIndices:n.arrayIndices}),s=a.pop();i(u,s,e,o,r)})});else{if(t._id&&!b["default"].equals(e._id,t._id))throw new Error("Cannot change the _id of a document");for(var o in t)if(/\./.test(o))throw new Error("When replacing document, field name may not contain '.'");r=t,r._id=e._id}return r}}]),e}();n["default"]=S;var A=function(e,t,n){n=n||{};for(var r=!1,i=0;i<t.length;i++){var a=i===t.length-1,u=t[i],s=(0,k.isIndexable)(e);if(!s){if(n.noCreate)return;var l=new Error("cannot use the part '"+u+"' to traverse "+e);throw l.setPropertyError=!0,l}if(e instanceof Array){if(n.forbidArray)return null;if("$"===u){if(r)throw new Error("Too many positional (i.e. '$') elements");if(!n.arrayIndices||!n.arrayIndices.length)throw new Error("The positional operator did not find the match needed from the query");u=n.arrayIndices[0],r=!0}else{if(!(0,k.isNumericKey)(u)){if(n.noCreate)return;throw new Error("can't append to array using string field name ["+u+"]")}u=parseInt(u,10)}if(a&&(t[i]=u),n.noCreate&&u>=e.length)return;for(;e.length<u;)e.push(null);if(!a)if(e.length===u)e.push({});else if("object"!==o(e[u]))throw new Error("can't modify field '"+t[i+1]+"' of list value "+JSON.stringify(e[u]))}else{if(u.length&&"$"===u.substr(0,1))throw new Error("can't set field named "+u);if(!(u in e)){if(n.noCreate)return;a||(e[u]={})}}if(a)return e;e=e[u]}},P={$unset:!0,$pop:!0,$rename:!0,$pull:!0,$pullAll:!0},M={$inc:function(e,t,n){if("number"!=typeof n)throw new Error("Modifier $inc allowed for numbers only");if(t in e){if("number"!=typeof e[t])throw new Error("Cannot apply $inc modifier to non-number");e[t]+=n}else e[t]=n},$set:function(e,t,n){if(!(0,l["default"])(e)){var r=new Error("Cannot set property on non-object field");throw r.setPropertyError=!0,r}if(null===e){var r=new Error("Cannot set property on null");throw r.setPropertyError=!0,r}e[t]=n},$setOnInsert:function(e,t,n){},$unset:function(e,t,n){void 0!==e&&(e instanceof Array?t in e&&(e[t]=null):delete e[t])},$push:function(e,t,n){if(void 0===e[t]&&(e[t]=[]),!(e[t]instanceof Array))throw new Error("Cannot apply $push modifier to non-array");if(!n||!n.$each)return void e[t].push(n);var r=n.$each;if(!(r instanceof Array))throw new Error("$each must be an array");var i=void 0;if("$position"in n){if("number"!=typeof n.$position)throw new Error("$position must be a numeric value");if(n.$position<0)throw new Error("$position in $push must be zero or positive");i=n.$position}var o=void 0;if("$slice"in n){if("number"!=typeof n.$slice)throw new Error("$slice must be a numeric value");if(n.$slice>0)throw new Error("$slice in $push must be zero or negative");o=n.$slice}var a=void 0;if(n.$sort){if(void 0===o)throw new Error("$sort requires $slice to be present");a=new E["default"](n.$sort).getComparator();for(var u=0;u<r.length;u++)if(3!==k.MongoTypeComp._type(r[u]))throw new Error("$push like modifiers using $sort require all elements to be objects")}if(void 0===i)for(var s=0;s<r.length;s++)e[t].push(r[s]);else{for(var l=[i,0],s=0;s<r.length;s++)l.push(r[s]);Array.prototype.splice.apply(e[t],l)}a&&e[t].sort(a),void 0!==o&&(0===o?e[t]=[]:e[t]=e[t].slice(o))},$pushAll:function(e,t,n){if(!("object"===("undefined"==typeof n?"undefined":o(n))&&n instanceof Array))throw new Error("Modifier $pushAll/pullAll allowed for arrays only");var r=e[t];if(void 0===r)e[t]=n;else{if(!(r instanceof Array))throw new Error("Cannot apply $pushAll modifier to non-array");for(var i=0;i<n.length;i++)r.push(n[i])}},$addToSet:function(e,t,n){var r=!1;if("object"===("undefined"==typeof n?"undefined":o(n)))for(var i in n){"$each"===i&&(r=!0);break}var a=r?n.$each:[n],u=e[t];if(void 0===u)e[t]=a;else{if(!(u instanceof Array))throw new Error("Cannot apply $addToSet modifier to non-array");(0,h["default"])(a,function(e){for(var t=0;t<u.length;t++)if(k.MongoTypeComp._equal(e,u[t]))return;u.push(e)})}},$pop:function(e,t,n){if(void 0!==e){var r=e[t];if(void 0!==r){if(!(r instanceof Array))throw new Error("Cannot apply $pop modifier to non-array");"number"==typeof n&&0>n?r.splice(0,1):r.pop()}}},$pull:function(e,t,n){if(void 0!==e){var r=e[t];if(void 0!==r){if(!(r instanceof Array))throw new Error("Cannot apply $pull/pullAll modifier to non-array");var i=[];if(null==n||"object"!==("undefined"==typeof n?"undefined":o(n))||n instanceof Array)for(var a=0;a<r.length;a++)k.MongoTypeComp._equal(r[a],n)||i.push(r[a]);else for(var u=new j["default"](n),a=0;a<r.length;a++)u.documentMatches(r[a]).result||i.push(r[a]);e[t]=i}}},$pullAll:function(e,t,n){if(!("object"===("undefined"==typeof n?"undefined":o(n))&&n instanceof Array))throw new Error("Modifier $pushAll/pullAll allowed for arrays only");if(void 0!==e){var r=e[t];if(void 0!==r){if(!(r instanceof Array))throw new Error("Cannot apply $pull/pullAll modifier to non-array");for(var i=[],a=0;a<r.length;a++){for(var u=!1,s=0;s<n.length;s++)if(k.MongoTypeComp._equal(r[a],n[s])){u=!0;break}u||i.push(r[a])}e[t]=i}}},$rename:function(e,t,n,r,i){if(r===n)throw new Error("$rename source must differ from target");if(null===e)throw new Error("$rename source field invalid");if("string"!=typeof n)throw new Error("$rename target must be a string");if(void 0!==e){var o=e[t];delete e[t];var a=n.split("."),u=A(i,a,{forbidArray:!0});if(null===u)throw new Error("$rename target field invalid");var s=a.pop();u[s]=o}},$bit:function(e,t,n){throw new Error("$bit is not supported")}}},{"./Document":6,"./DocumentMatcher":7,"./DocumentRetriver":9,"./DocumentSorter":10,"./EJSON":11,"lodash/collection/all":22,"lodash/collection/each":25,"lodash/lang/isObject":92,"lodash/object/assign":95,"lodash/utility/identity":101}],9:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(n,"__esModule",{value:!0}),n.DocumentRetriver=void 0;var a=e("lodash/lang/isObject"),u=r(a),s=e("lodash/lang/isArray"),l=r(s),c=e("lodash/object/has"),f=r(c),d=e("lodash/collection/size"),h=r(d),p=e("./Document"),y=n.DocumentRetriver=function(){function e(t){i(this,e),this.db=t}return o(e,[{key:"retriveForQeury",value:function(e){var t=void 0;return(0,p.selectorIsId)(e)?t=[e]:(0,p.selectorIsIdPerhapsAsObject)(e)?t=[e._id]:(0,u["default"])(e)&&(0,f["default"])(e,"_id")&&(0,u["default"])(e._id)&&(0,f["default"])(e._id,"$in")&&(0,l["default"])(e._id.$in)&&(t=e._id.$in),(0,h["default"])(t)>0?this.retriveIds(t):this.retriveAll()}},{key:"retriveAll",value:function(){var e=this;return new Promise(function(t,n){var r=[];e.db.storage.createReadStream().on("data",function(t){return r.push(e.db.create(t.value))}).on("end",function(){return t(r)})})}},{key:"retriveIds",value:function(e){var t=this,n=e.map(function(e){return t.retriveOne(e)});return Promise.all(n)}},{key:"retriveOne",value:function(e){var t=this;return this.db.storage.get(e).then(function(e){return t.db.create(e)})}}]),e}();n["default"]=y},{"./Document":6,"lodash/collection/size":31,"lodash/lang/isArray":85,"lodash/lang/isObject":92,"lodash/object/has":96}],10:[function(e,t,n){"use strict";function r(e){return e&&"undefined"!=typeof Symbol&&e.constructor===Symbol?"symbol":typeof e}function i(e){return e&&e.__esModule?e:{"default":e}}function o(e){return e&&"undefined"!=typeof Symbol&&e.constructor===Symbol?"symbol":"undefined"==typeof e?"undefined":r(e)}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(n,"__esModule",{value:!0}),n.DocumentSorter=void 0;var s=e("lodash/lang/isEmpty"),l=i(s),c=e("lodash/object/has"),f=i(c),d=e("lodash/collection/each"),h=i(d),p=e("lodash/collection/contains"),y=i(p),v=e("lodash/collection/all"),g=i(v),m=e("lodash/collection/size"),b=i(m),_=e("lodash/collection/map"),w=i(_),x=e("lodash/collection/pluck"),j=i(x),O=e("./DocumentMatcher"),E=i(O),k=e("./Document"),S=n.DocumentSorter=function(){function e(t){var n=this,r=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];a(this,e),this._sortSpecParts=[];var i=function(e,t){if(!e)throw Error("sort keys must be non-empty");if("$"===e.charAt(0))throw Error("unsupported sort key: "+e);n._sortSpecParts.push({path:e,lookup:(0,O.makeLookupFunction)(e,{forSort:!0}),ascending:t})};if(t instanceof Array)for(var u=0;u<t.length;u++)"string"==typeof t[u]?i(t[u],!0):i(t[u][0],"desc"!==t[u][1]);else{if("object"!==("undefined"==typeof t?"undefined":o(t)))throw Error("Bad sort specification: "+JSON.stringify(t));(0,h["default"])(t,function(e,t){i(t,e>=0)})}if(this.affectedByModifier){var s={};(0,h["default"])(this._sortSpecParts,function(e){s[e.path]=1}),this._selectorForAffectedByModifier=new E["default"](s)}this._keyComparator=A((0,w["default"])(this._sortSpecParts,function(e,t){return n._keyFieldComparator(t)})),this._keyFilter=null,r.matcher&&this._useWithMatcher(r.matcher)}return u(e,[{key:"getComparator",value:function(e){if(!e||!e.distances)return this._getBaseComparator();var t=e.distances;return A([this._getBaseComparator(),function(e,n){if(!t.has(e._id))throw Error("Missing distance for "+e._id);if(!t.has(n._id))throw Error("Missing distance for "+n._id);return t.get(e._id)-t.get(n._id)}])}},{key:"_getPaths",value:function(){return(0,j["default"])(this._sortSpecParts,"path")}},{key:"_getMinKeyFromDoc",value:function(e){var t=this,n=null;if(this._generateKeysFromDoc(e,function(e){return t._keyCompatibleWithSelector(e)?null===n?void(n=e):void(t._compareKeys(e,n)<0&&(n=e)):void 0}),null===n)throw Error("sort selector found no keys in doc?");return n}},{key:"_keyCompatibleWithSelector",value:function(e){return!this._keyFilter||this._keyFilter(e)}},{key:"_generateKeysFromDoc",value:function(e,t){if(0===this._sortSpecParts.length)throw new Error("can't generate keys without a spec");var n=[],r=function(e){return e.join(",")+","},i=null;if((0,h["default"])(this._sortSpecParts,function(t,o){var a=(0,O.expandArraysInBranches)(t.lookup(e),!0);a.length||(a=[{value:null}]);var u=!1;if(n[o]={},(0,h["default"])(a,function(e){if(!e.arrayIndices){if(a.length>1)throw Error("multiple branches but no array used?");return void(n[o][""]=e.value)}u=!0;var t=r(e.arrayIndices);if((0,f["default"])(n[o],t))throw Error("duplicate path: "+t);if(n[o][t]=e.value,i&&!(0,f["default"])(i,t))throw Error("cannot index parallel arrays")}),i){if(!(0,f["default"])(n[o],"")&&(0,b["default"])(i)!==(0,b["default"])(n[o]))throw Error("cannot index parallel arrays!")}else u&&(i={},(0,h["default"])(n[o],function(e,t){i[t]=!0}))}),!i){var o=(0,w["default"])(n,function(e){if(!(0,f["default"])(e,""))throw Error("no value in sole key case?");return e[""]});return void t(o)}(0,h["default"])(i,function(e,r){var i=(0,w["default"])(n,function(e){if((0,f["default"])(e,""))return e[""];if(!(0,f["default"])(e,r))throw Error("missing path?");return e[r]});t(i)})}},{key:"_compareKeys",value:function(e,t){if(e.length!==this._sortSpecParts.length||t.length!==this._sortSpecParts.length)throw Error("Key has wrong length");return this._keyComparator(e,t)}},{key:"_keyFieldComparator",value:function(e){var t=!this._sortSpecParts[e].ascending;return function(n,r){var i=k.MongoTypeComp._cmp(n[e],r[e]);return t&&(i=-i),i}}},{key:"_getBaseComparator",value:function(){var e=this;return this._sortSpecParts.length?function(t,n){var r=e._getMinKeyFromDoc(t),i=e._getMinKeyFromDoc(n);return e._compareKeys(r,i)}:function(e,t){return 0}}},{key:"_useWithMatcher",value:function(e){if(this._keyFilter)throw Error("called _useWithMatcher twice?");if(!(0,l["default"])(this._sortSpecParts)){var t=e._selector;if(!(t instanceof Function)){var n={};(0,h["default"])(this._sortSpecParts,function(e,t){n[e.path]=[]}),(0,h["default"])(t,function(e,t){var r=n[t];if(r){if(e instanceof RegExp){if(e.ignoreCase||e.multiline)return;return void r.push((0,O.regexpElementMatcher)(e))}return(0,k.isOperatorObject)(e)?void(0,h["default"])(e,function(t,n){(0,y["default"])(["$lt","$lte","$gt","$gte"],n)&&r.push(O.ELEMENT_OPERATORS[n].compileElementSelector(t)),"$regex"!==n||e.$options||r.push(O.ELEMENT_OPERATORS.$regex.compileElementSelector(t,e))}):void r.push((0,O.equalityElementMatcher)(e))}}),(0,l["default"])(n[this._sortSpecParts[0].path])||(this._keyFilter=function(e){return(0,g["default"])(this._sortSpecParts,function(t,r){return(0,g["default"])(n[t.path],function(t){return t(e[r])})})})}}}}]),e}();n["default"]=S;var A=function(e){return function(t,n){for(var r=0;r<e.length;++r){var i=e[r](t,n);if(0!==i)return i}return 0}}},{"./Document":6,"./DocumentMatcher":7,"lodash/collection/all":22,"lodash/collection/contains":24,"lodash/collection/each":25,"lodash/collection/map":29,"lodash/collection/pluck":30,"lodash/collection/size":31,"lodash/lang/isEmpty":86,"lodash/object/has":96}],11:[function(e,t,n){"use strict";function r(e){return e&&"undefined"!=typeof Symbol&&e.constructor===Symbol?"symbol":typeof e}function i(e){return e&&e.__esModule?e:{"default":e}}function o(e){return e&&"undefined"!=typeof Symbol&&e.constructor===Symbol?"symbol":"undefined"==typeof e?"undefined":r(e)}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function u(e){return(0,p["default"])(e)||e===1/0||e===-(1/0)}var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(n,"__esModule",{value:!0}),n.EJSON=void 0;var l=e("./Base64"),c=i(l),f=e("lodash/lang/isEmpty"),d=i(f),h=e("lodash/lang/isNaN"),p=i(h),y=e("lodash/lang/isArguments"),v=i(y),g=e("lodash/object/has"),m=i(g),b=e("lodash/object/keys"),_=i(b),w=e("lodash/collection/each"),x=i(w),j=n.EJSON=function(){function e(){a(this,e),this._setupBuiltinConverters(),this._customTypes={}}return s(e,[{key:"addType",value:function(e,t){if((0,m["default"])(this._customTypes,e))throw new Error("Type "+e+" already present");this._customTypes[e]=t}},{key:"toJSONValue",value:function(e){var t=this._toJSONValueHelper(e);return void 0!==t?t:("object"===("undefined"==typeof e?"undefined":o(e))&&(e=this.clone(e),this._adjustTypesToJSONValue(e)),e)}},{key:"fromJSONValue",value:function(e){var t=this._fromJSONValueHelper(e);return t===e&&"object"===("undefined"==typeof e?"undefined":o(e))?(e=this.clone(e),this._adjustTypesFromJSONValue(e),e):t}},{key:"stringify",value:function(e){var t=this.toJSONValue(e);return JSON.stringify(t)}},{key:"parse",value:function(e){if("string"!=typeof e)throw new Error("EJSON.parse argument should be a string");return this.fromJSONValue(JSON.parse(e))}},{key:"isBinary",value:function(e){return!!("undefined"!=typeof Uint8Array&&e instanceof Uint8Array||e&&e.$Uint8ArrayPolyfill)}},{key:"equals",value:function(e,t,n){var r,i=this,a=!(!n||!n.keyOrderSensitive);if(e===t)return!0;if((0,p["default"])(e)&&(0,p["default"])(t))return!0;if(!e||!t)return!1;if("object"!==("undefined"==typeof e?"undefined":o(e))||"object"!==("undefined"==typeof t?"undefined":o(t)))return!1;if(e instanceof Date&&t instanceof Date)return e.valueOf()===t.valueOf();if(this.isBinary(e)&&this.isBinary(t)){if(e.length!==t.length)return!1;for(r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}if("function"==typeof e.equals)return e.equals(t,n);if("function"==typeof t.equals)return t.equals(e,n);if(e instanceof Array){if(!(t instanceof Array))return!1;if(e.length!==t.length)return!1;for(r=0;r<e.length;r++)if(!this.equals(e[r],t[r],n))return!1;return!0}switch(this._isCustomType(e)+this._isCustomType(t)){case 1:return!1;case 2:return this.equals(this.toJSONValue(e),this.toJSONValue(t))}var u;if(a){var s=(0,_["default"])(t);return r=0,u=(0,_["default"])(e).every(function(o){return r>=s.length?!1:o!==s[r]?!1:i.equals(e[o],t[s[r]],n)?(r++,!0):!1}),u&&r===s.length}return r=0,u=(0,_["default"])(e).every(function(o){return(0,m["default"])(t,o)&&i.equals(e[o],t[o],n)?(r++,!0):!1}),u&&(0,_["default"])(t).length===r}},{key:"clone",value:function(e){var t,n=this;if("object"!==("undefined"==typeof e?"undefined":o(e)))return e;if(null===e)return null;if(e instanceof Date)return new Date(e.getTime());if(e instanceof RegExp)return e;if(this.isBinary(e)){t=c["default"].newBinary(e.length);for(var r=0;r<e.length;r++)t[r]=e[r];return t}if(Array.isArray(e)||(0,v["default"])(e)){t=[];for(var r=0;r<e.length;r++)t[r]=this.clone(e[r]);return t}return"function"==typeof e.clone?e.clone():this._isCustomType(e)?this.fromJSONValue(this.clone(this.toJSONValue(e)),!0):(t={},(0,x["default"])(e,function(e,r){t[r]=n.clone(e)}),t)}},{key:"newBinary",value:function(e){return c["default"].newBinary(e)}},{key:"_setupBuiltinConverters",value:function(){var e=this;this._builtinConverters=[{matchJSONValue:function(e){return(0,m["default"])(e,"$date")&&1===(0,_["default"])(e).length},matchObject:function(e){return e instanceof Date},toJSONValue:function(e){return{$date:e.getTime()}},fromJSONValue:function(e){return new Date(e.$date)}},{matchJSONValue:function(e){return(0,m["default"])(e,"$InfNaN")&&1===(0,_["default"])(e).length},matchObject:u,toJSONValue:function(e){var t;return t=(0,p["default"])(e)?0:e===1/0?1:-1,{$InfNaN:t}},fromJSONValue:function(e){return e.$InfNaN/0}},{matchJSONValue:function(e){return(0,m["default"])(e,"$binary")&&1===(0,_["default"])(e).length},matchObject:function(e){return"undefined"!=typeof Uint8Array&&e instanceof Uint8Array||e&&(0,m["default"])(e,"$Uint8ArrayPolyfill")},toJSONValue:function(e){return{$binary:c["default"].encode(e)}},fromJSONValue:function(e){return c["default"].decode(e.$binary)}},{matchJSONValue:function(e){return(0,m["default"])(e,"$escape")&&1===(0,_["default"])(e).length},matchObject:function(t){return(0,d["default"])(t)||(0,_["default"])(t).length>2?!1:e._builtinConverters.some(function(e){return e.matchJSONValue(t)})},toJSONValue:function(t){var n={};return(0,x["default"])(t,function(t,r){n[r]=e.toJSONValue(t)}),{$escape:n}},fromJSONValue:function(t){var n={};return(0,x["default"])(t.$escape,function(t,r){n[r]=e.fromJSONValue(t)}),n}},{matchJSONValue:function(e){return(0,m["default"])(e,"$type")&&(0,m["default"])(e,"$value")&&2===(0,_["default"])(e).length},matchObject:function(t){return e._isCustomType(t)},toJSONValue:function(e){var t=e.toJSONValue();return{$type:e.typeName(),$value:t}},fromJSONValue:function(t){var n=t.$type;if(!(0,m["default"])(e._customTypes,n))throw new Error("Custom EJSON type "+n+" is not defined");var r=e._customTypes[n];return r(t.$value)}}]}},{key:"_isCustomType",value:function(e){return e&&"function"==typeof e.toJSONValue&&"function"==typeof e.typeName&&(0,m["default"])(this._customTypes,e.typeName())}},{key:"_adjustTypesToJSONValue",value:function(e){var t=this;if(null===e)return null;var n=this._toJSONValueHelper(e);return void 0!==n?n:"object"!==("undefined"==typeof e?"undefined":o(e))?e:((0,x["default"])(e,function(n,r){if("object"===("undefined"==typeof n?"undefined":o(n))||void 0===n||u(n)){var i=t._toJSONValueHelper(n);return i?void(e[r]=i):void t._adjustTypesToJSONValue(n)}}),e)}},{key:"_toJSONValueHelper",value:function(e){for(var t=0;t<this._builtinConverters.length;t++){var n=this._builtinConverters[t];if(n.matchObject(e))return n.toJSONValue(e)}}},{key:"_adjustTypesFromJSONValue",value:function(e){var t=this;if(null===e)return null;var n=this._fromJSONValueHelper(e);return n!==e?n:"object"!==("undefined"==typeof e?"undefined":o(e))?e:((0,x["default"])(e,function(n,r){if("object"===("undefined"==typeof n?"undefined":o(n))){var i=t._fromJSONValueHelper(n);if(n!==i)return void(e[r]=i);t._adjustTypesFromJSONValue(n)}}),e)}},{key:"_fromJSONValueHelper",value:function(e){if("object"===("undefined"==typeof e?"undefined":o(e))&&null!==e&&(0,_["default"])(e).length<=2&&(0,_["default"])(e).every(function(e){return"string"==typeof e&&"$"===e.substr(0,1)}))for(var t=0;t<this._builtinConverters.length;t++){var n=this._builtinConverters[t];if(n.matchJSONValue(e))return n.fromJSONValue(e)}return e}}]),e}();n["default"]=new j},{"./Base64":1,"lodash/collection/each":25,"lodash/lang/isArguments":84,"lodash/lang/isEmpty":86,"lodash/lang/isNaN":89,"lodash/object/has":96,"lodash/object/keys":97}],12:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(n,"__esModule",{value:!0}),n.IndexManager=void 0;var a=e("lodash/object/keys"),u=r(a),s=e("invariant"),l=r(s),c=e("./PromiseQueue"),f=r(c),d=e("./CollectionIndex"),h=r(d),p=e("./DocumentRetriver"),y=r(p),v=n.IndexManager=function(){function e(t){var n=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];i(this,e),this.db=t,this.indexes={},this._queue=new f["default"](n.concurrency||2),this.ensureIndex({fieldName:"_id",unique:!0})}return o(e,[{key:"ensureIndex",value:function(e){(0,l["default"])(e&&e.fieldName,"You must specify a fieldName in options object");var t=e.fieldName;return this.indexes[t]?this.indexes[t].buildPromise?this.indexes[t].buildPromise:e&&e.forceRebuild?this.buildIndex(t):Promise.resolve():(this.indexes[t]=new h["default"](e),this.buildIndex(t))}},{key:"buildIndex",value:function(e){var t=this;(0,l["default"])(this.indexes[e],"Index with key `%s` does not ensured yet",e);var n=function(){return t.indexes[e].buildPromise=null},r=this._queue.add(this._doBuildIndex.bind(this,e)).then(n,n);return this.indexes[e].buildPromise=r,r}},{key:"buildAllIndexes",value:function(){var e=this;return Promise.all((0,u["default"])(this.indexes).map(function(t){return e.ensureIndex({fieldName:t,forceRebuild:!0})}))}},{key:"removeIndex",value:function(e){var t=this;return this._queue.add(function(){delete t.indexes[e]})}},{key:"indexDocument",value:function(e){var t=this;return this._queue.add(function(){var n=(0,u["default"])(t.indexes),r=null;try{n.forEach(function(n,i){r=i,t.indexes[n].insert(e)})}catch(i){throw n.slice(0,r).forEach(function(n){t.indexes[n].remove(e)}),i}})}},{key:"reindexDocument",value:function(e,t){var n=this;return this._queue.add(function(){var r=(0,u["default"])(n.indexes),i=null;try{r.forEach(function(r,o){i=o,n.indexes[r].update(e,t)})}catch(o){throw r.slice(0,i).forEach(function(r){n.indexes[r].revertUpdate(e,t)}),o}})}},{key:"deindexDocument",value:function(e){var t=this;return this._queue.add(function(){var n=(0,u["default"])(t.indexes);n.forEach(function(n){t.indexes[n].remove(e)})})}},{key:"_doBuildIndex",value:function(e){var t=this.indexes[e];t.reset();var n=[];return new y["default"](this.db).retriveAll().then(function(e){if(e.forEach(function(e){try{t.insert(e)}catch(r){n.push([r,e])}}),n.length>0)throw new Error("Index build failed with errors: ",n)})}}]),e}();n["default"]=v},{"./CollectionIndex":3,"./DocumentRetriver":9,"./PromiseQueue":13,invariant:20,"lodash/object/keys":97}],13:[function(e,t,n){"use strict";function r(e,t){this.pendingPromises=0,this.maxPendingPromises="undefined"!=typeof e?e:1/0,this.maxQueuedPromises="undefined"!=typeof t?t:1/0,this.queue=[]}Object.defineProperty(n,"__esModule",{value:!0}),n["default"]=r;var i="undefined"!=typeof Promise?Promise:function(){return{then:function(){throw new Error("Queue.configure() before use Queue")}}},o=function(){},a=function(e){return e&&"function"==typeof e.then?e:new i(function(t){t(e)})};r.configure=function(e){i=e},r.prototype.add=function(e){var t=this;return new i(function(n,r,i){return t.queue.length>=t.maxQueuedPromises?void r(new Error("Queue limit reached")):(t.queue.push({promiseGenerator:e,resolve:n,reject:r,notify:i||o}),void t._dequeue())})},r.prototype.getPendingLength=function(){return this.pendingPromises},r.prototype.getQueueLength=function(){return this.queue.length},r.prototype._dequeue=function(){var e=this;if(this.pendingPromises>=this.maxPendingPromises)return!1;var t=this.queue.shift();if(!t)return!1;try{this.pendingPromises++,a(t.promiseGenerator()).then(function(n){e.pendingPromises--,t.resolve(n),e._dequeue()},function(n){e.pendingPromises--,t.reject(n),e._dequeue()},function(e){t.notify(e)})}catch(n){e.pendingPromises--,t.reject(n),e._dequeue()}return!0}},{}],14:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function e(){var e=4022871197,t=function(t){t=t.toString();for(var n=0;n<t.length;n++){e+=t.charCodeAt(n);var r=.02519603282416938*e;e=r>>>0,r-=e,r*=e,e=r>>>0,r-=e,e+=4294967296*r}return 2.3283064365386963e-10*(e>>>0)};return t.version="Mash 0.9",t}return function(t){var n=0,r=0,i=0,o=1;0==t.length&&(t=[+new Date]);var a=e();n=a(" "),r=a(" "),i=a(" ");for(var u=0;u<t.length;u++)n-=a(t[u]),0>n&&(n+=1),r-=a(t[u]),0>r&&(r+=1),i-=a(t[u]),0>i&&(i+=1);a=null;var s=function(){var e=2091639*n+2.3283064365386963e-10*o;return n=r,r=i,i=e-(o=0|e)};return s.uint32=function(){return 4294967296*s()},s.fract53=function(){return s()+1.1102230246251565e-16*(2097152*s()|0)},s.version="Alea 0.9",s.args=t,s}(Array.prototype.slice.call(arguments))},a="23456789ABCDEFGHJKLMNPQRSTWXYZabcdefghijkmnopqrstuvwxyz",u="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789-_",s=n.Random=function(){
function e(){r(this,e);var t=arguments[0];if(!(void 0!==t||"undefined"!=typeof window&&window.crypto&&window.crypto.getRandomValues)){var n="undefined"!=typeof window&&window.innerHeight||"undefined"!=typeof document&&document.documentElement&&document.documentElement.clientHeight||"undefined"!=typeof document&&document.body&&document.body.clientHeight||1,i="undefined"!=typeof window&&window.innerWidth||"undefined"!=typeof document&&document.documentElement&&document.documentElement.clientWidth||"undefined"!=typeof document&&document.body&&document.body.clientWidth||1,a="undefined"!=typeof navigator&&navigator.userAgent||"";t=[new Date,n,i,a,Math.random()]}void 0!==t&&(this.alea=o.apply(null,t))}return i(e,[{key:"fraction",value:function(){var e=this;if(e.alea)return e.alea();if("undefined"!=typeof window&&window.crypto&&window.crypto.getRandomValues){var t=new Uint32Array(1);return window.crypto.getRandomValues(t),2.3283064365386963e-10*t[0]}throw new Error("No random generator available")}},{key:"hexString",value:function(e){for(var t=this,n=[],r=0;e>r;++r)n.push(t.choice("0123456789abcdef"));return n.join("")}},{key:"_randomString",value:function(e,t){for(var n=this,r=[],i=0;e>i;i++)r[i]=n.choice(t);return r.join("")}},{key:"id",value:function(e){var t=this;return void 0===e&&(e=17),t._randomString(e,a)}},{key:"secret",value:function(e){var t=this;return void 0===e&&(e=43),t._randomString(e,u)}},{key:"choice",value:function(e){var t=Math.floor(this.fraction()*e.length);return"string"==typeof e?e.substr(t,1):e[t]}}],[{key:"createWithSeed",value:function(){if(0===arguments.length)throw new Error("No seeds were provided");return new e(arguments)}}]),e}();n["default"]=s},{}],15:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(n,"__esModule",{value:!0}),n.StorageManager=void 0;var a=e("lodash/object/keys"),u=r(a),s=e("lodash/function/defer"),l=r(s),c=e("eventemitter3"),f=r(c),d=e("./PromiseQueue"),h=r(d),p=e("./EJSON"),y=r(p),v=n.StorageManager=function(){function e(t,n){i(this,e),this.db=t,this._queue=new h["default"](1),this._storage={},this.reload()}return o(e,[{key:"loaded",value:function(){return this._loadedPromise}},{key:"reload",value:function(){var e=this;this._loadedPromise?this._loadedPromise=this._loadedPromise.then(function(){return e._loadStorage()}):this._loadedPromise=this._loadStorage()}},{key:"destroy",value:function(){var e=this;return this._loadedPromise.then(function(){e._storage={}})}},{key:"persist",value:function(e,t){var n=this;return this._loadedPromise.then(function(){n._storage[e]=y["default"].clone(t)})}},{key:"delete",value:function(e){var t=this;return this._loadedPromise.then(function(){delete t._storage[e]})}},{key:"get",value:function(e){var t=this;return this._loadedPromise.then(function(){return y["default"].clone(t._storage[e])})}},{key:"createReadStream",value:function(){var e=this,t=new f["default"];return(0,l["default"])(function(){e._loadedPromise.then(function(){(0,u["default"])(e._storage).forEach(function(n){t.emit("data",{value:y["default"].clone(e._storage[n])})}),t.emit("end")})}),t}},{key:"_loadStorage",value:function(){return Promise.resolve()}}]),e}();n["default"]=v},{"./EJSON":11,"./PromiseQueue":13,eventemitter3:17,"lodash/function/defer":33,"lodash/object/keys":97}],16:[function(e,t,n){"use strict";var r=e("./dist/Collection")["default"],i=e("./dist/CursorObservable")["default"],o=e("./dist/StorageManager")["default"],a=e("./dist/Random")["default"],u=e("./dist/EJSON")["default"],s=e("./dist/Base64")["default"];t.exports={__esModule:!0,"default":r,Random:a,EJSON:u,Base64:s,Collection:r,CursorObservable:i,StorageManager:o}},{"./dist/Base64":1,"./dist/Collection":2,"./dist/CursorObservable":5,"./dist/EJSON":11,"./dist/Random":14,"./dist/StorageManager":15}],17:[function(e,t,n){"use strict";function r(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function i(){}var o="function"!=typeof Object.create?"~":!1;i.prototype._events=void 0,i.prototype.listeners=function(e,t){var n=o?o+e:e,r=this._events&&this._events[n];if(t)return!!r;if(!r)return[];if(r.fn)return[r.fn];for(var i=0,a=r.length,u=new Array(a);a>i;i++)u[i]=r[i].fn;return u},i.prototype.emit=function(e,t,n,r,i,a){var u=o?o+e:e;if(!this._events||!this._events[u])return!1;var s,l,c=this._events[u],f=arguments.length;if("function"==typeof c.fn){switch(c.once&&this.removeListener(e,c.fn,void 0,!0),f){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,t),!0;case 3:return c.fn.call(c.context,t,n),!0;case 4:return c.fn.call(c.context,t,n,r),!0;case 5:return c.fn.call(c.context,t,n,r,i),!0;case 6:return c.fn.call(c.context,t,n,r,i,a),!0}for(l=1,s=new Array(f-1);f>l;l++)s[l-1]=arguments[l];c.fn.apply(c.context,s)}else{var d,h=c.length;for(l=0;h>l;l++)switch(c[l].once&&this.removeListener(e,c[l].fn,void 0,!0),f){case 1:c[l].fn.call(c[l].context);break;case 2:c[l].fn.call(c[l].context,t);break;case 3:c[l].fn.call(c[l].context,t,n);break;default:if(!s)for(d=1,s=new Array(f-1);f>d;d++)s[d-1]=arguments[d];c[l].fn.apply(c[l].context,s)}}return!0},i.prototype.on=function(e,t,n){var i=new r(t,n||this),a=o?o+e:e;return this._events||(this._events=o?{}:Object.create(null)),this._events[a]?this._events[a].fn?this._events[a]=[this._events[a],i]:this._events[a].push(i):this._events[a]=i,this},i.prototype.once=function(e,t,n){var i=new r(t,n||this,!0),a=o?o+e:e;return this._events||(this._events=o?{}:Object.create(null)),this._events[a]?this._events[a].fn?this._events[a]=[this._events[a],i]:this._events[a].push(i):this._events[a]=i,this},i.prototype.removeListener=function(e,t,n,r){var i=o?o+e:e;if(!this._events||!this._events[i])return this;var a=this._events[i],u=[];if(t)if(a.fn)(a.fn!==t||r&&!a.once||n&&a.context!==n)&&u.push(a);else for(var s=0,l=a.length;l>s;s++)(a[s].fn!==t||r&&!a[s].once||n&&a[s].context!==n)&&u.push(a[s]);return u.length?this._events[i]=1===u.length?u[0]:u:delete this._events[i],this},i.prototype.removeAllListeners=function(e){return this._events?(e?delete this._events[o?o+e:e]:this._events=o?{}:Object.create(null),this):this},i.prototype.off=i.prototype.removeListener,i.prototype.addListener=i.prototype.on,i.prototype.setMaxListeners=function(){return this},i.prefixed=o,"undefined"!=typeof t&&(t.exports=i)},{}],18:[function(e,t,n){!function(){function e(e){for(var t=[],n=[],r=0;r<e[0].length;r++)t.push(e[0][r][1]),n.push(e[0][r][0]);return t=t.sort(function(e,t){return e-t}),n=n.sort(function(e,t){return e-t}),[[t[0],n[0]],[t[t.length-1],n[n.length-1]]]}function n(e,t,n){for(var r=[[0,0]],i=0;i<n.length;i++){for(var o=0;o<n[i].length;o++)r.push(n[i][o]);r.push(n[i][0]),r.push([0,0])}for(var a=!1,i=0,o=r.length-1;i<r.length;o=i++)r[i][0]>t!=r[o][0]>t&&e<(r[o][1]-r[i][1])*(t-r[i][0])/(r[o][0]-r[i][0])+r[i][1]&&(a=!a);return a}var r=this.gju={};"undefined"!=typeof t&&t.exports&&(t.exports=r),r.lineStringsIntersect=function(e,t){for(var n=[],r=0;r<=e.coordinates.length-2;++r)for(var i=0;i<=t.coordinates.length-2;++i){var o={x:e.coordinates[r][1],y:e.coordinates[r][0]},a={x:e.coordinates[r+1][1],y:e.coordinates[r+1][0]},u={x:t.coordinates[i][1],y:t.coordinates[i][0]},s={x:t.coordinates[i+1][1],y:t.coordinates[i+1][0]},l=(s.x-u.x)*(o.y-u.y)-(s.y-u.y)*(o.x-u.x),c=(a.x-o.x)*(o.y-u.y)-(a.y-o.y)*(o.x-u.x),f=(s.y-u.y)*(a.x-o.x)-(s.x-u.x)*(a.y-o.y);if(0!=f){var d=l/f,h=c/f;d>=0&&1>=d&&h>=0&&1>=h&&n.push({type:"Point",coordinates:[o.x+d*(a.x-o.x),o.y+d*(a.y-o.y)]})}}return 0==n.length&&(n=!1),n},r.pointInBoundingBox=function(e,t){return!(e.coordinates[1]<t[0][0]||e.coordinates[1]>t[1][0]||e.coordinates[0]<t[0][1]||e.coordinates[0]>t[1][1])},r.pointInPolygon=function(t,i){for(var o="Polygon"==i.type?[i.coordinates]:i.coordinates,a=!1,u=0;u<o.length;u++)r.pointInBoundingBox(t,e(o[u]))&&(a=!0);if(!a)return!1;for(var s=!1,u=0;u<o.length;u++)n(t.coordinates[1],t.coordinates[0],o[u])&&(s=!0);return s},r.pointInMultiPolygon=function(t,i){for(var o="MultiPolygon"==i.type?[i.coordinates]:i.coordinates,a=!1,u=!1,s=0;s<o.length;s++){for(var l=o[s],c=0;c<l.length;c++)a||r.pointInBoundingBox(t,e(l[c]))&&(a=!0);if(!a)return!1;for(var c=0;c<l.length;c++)u||n(t.coordinates[1],t.coordinates[0],l[c])&&(u=!0)}return u},r.numberToRadius=function(e){return e*Math.PI/180},r.numberToDegree=function(e){return 180*e/Math.PI},r.drawCircle=function(e,t,n){for(var i=[t.coordinates[1],t.coordinates[0]],o=e/1e3/6371,a=[r.numberToRadius(i[0]),r.numberToRadius(i[1])],n=n||15,u=[[i[0],i[1]]],s=0;n>s;s++){var l=2*Math.PI*s/n,c=Math.asin(Math.sin(a[0])*Math.cos(o)+Math.cos(a[0])*Math.sin(o)*Math.cos(l)),f=a[1]+Math.atan2(Math.sin(l)*Math.sin(o)*Math.cos(a[0]),Math.cos(o)-Math.sin(a[0])*Math.sin(c));u[s]=[],u[s][1]=r.numberToDegree(c),u[s][0]=r.numberToDegree(f)}return{type:"Polygon",coordinates:[u]}},r.rectangleCentroid=function(e){var t=e.coordinates[0],n=t[0][0],r=t[0][1],i=t[2][0],o=t[2][1],a=i-n,u=o-r;return{type:"Point",coordinates:[n+a/2,r+u/2]}},r.pointDistance=function(e,t){var n=e.coordinates[0],i=e.coordinates[1],o=t.coordinates[0],a=t.coordinates[1],u=r.numberToRadius(a-i),s=r.numberToRadius(o-n),l=Math.pow(Math.sin(u/2),2)+Math.cos(r.numberToRadius(i))*Math.cos(r.numberToRadius(a))*Math.pow(Math.sin(s/2),2),c=2*Math.atan2(Math.sqrt(l),Math.sqrt(1-l));return 6371*c*1e3},r.geometryWithinRadius=function(e,t,n){if("Point"==e.type)return r.pointDistance(e,t)<=n;if("LineString"==e.type||"Polygon"==e.type){var i,o={};i="Polygon"==e.type?e.coordinates[0]:e.coordinates;for(var a in i)if(o.coordinates=i[a],r.pointDistance(o,t)>n)return!1}return!0},r.area=function(e){for(var t,n,r=0,i=e.coordinates[0],o=i.length-1,a=0;a<i.length;o=a++){var t={x:i[a][1],y:i[a][0]},n={x:i[o][1],y:i[o][0]};r+=t.x*n.y,r-=t.y*n.x}return r/=2},r.centroid=function(e){for(var t,n,i,o=0,a=0,u=e.coordinates[0],s=u.length-1,l=0;l<u.length;s=l++){var n={x:u[l][1],y:u[l][0]},i={x:u[s][1],y:u[s][0]};t=n.x*i.y-i.x*n.y,o+=(n.x+i.x)*t,a+=(n.y+i.y)*t}return t=6*r.area(e),{type:"Point",coordinates:[a/t,o/t]}},r.simplify=function(e,t){t=t||20,e=e.map(function(e){return{lng:e.coordinates[0],lat:e.coordinates[1]}});var n,r,i,o,a,u,s,l,c,f,d,h,p,y,v,g,m,b,_,w=Math.PI/180*.5,x=new Array,j=new Array,O=new Array;if(e.length<3)return e;for(n=e.length,f=360*t/(2*Math.PI*6378137),f*=f,i=0,j[0]=0,O[0]=n-1,r=1;r>0;)if(o=j[r-1],a=O[r-1],r--,a-o>1){for(d=e[a].lng()-e[o].lng(),h=e[a].lat()-e[o].lat(),Math.abs(d)>180&&(d=360-Math.abs(d)),d*=Math.cos(w*(e[a].lat()+e[o].lat())),p=d*d+h*h,u=o+1,s=o,c=-1;a>u;u++)y=e[u].lng()-e[o].lng(),v=e[u].lat()-e[o].lat(),Math.abs(y)>180&&(y=360-Math.abs(y)),y*=Math.cos(w*(e[u].lat()+e[o].lat())),g=y*y+v*v,m=e[u].lng()-e[a].lng(),b=e[u].lat()-e[a].lat(),Math.abs(m)>180&&(m=360-Math.abs(m)),m*=Math.cos(w*(e[u].lat()+e[a].lat())),_=m*m+b*b,l=g>=p+_?_:_>=p+g?g:(y*h-v*d)*(y*h-v*d)/p,l>c&&(s=u,c=l);f>c?(x[i]=o,i++):(r++,j[r-1]=s,O[r-1]=a,r++,j[r-1]=o,O[r-1]=s)}else x[i]=o,i++;x[i]=n-1,i++;for(var E=new Array,u=0;i>u;u++)E.push(e[x[u]]);return E.map(function(e){return{type:"Point",coordinates:[e.lng,e.lat]}})},r.destinationPoint=function(e,t,n){n/=6371,t=r.numberToRadius(t);var i=r.numberToRadius(e.coordinates[0]),o=r.numberToRadius(e.coordinates[1]),a=Math.asin(Math.sin(o)*Math.cos(n)+Math.cos(o)*Math.sin(n)*Math.cos(t)),u=i+Math.atan2(Math.sin(t)*Math.sin(n)*Math.cos(o),Math.cos(n)-Math.sin(o)*Math.sin(a));return u=(u+3*Math.PI)%(2*Math.PI)-Math.PI,{type:"Point",coordinates:[r.numberToDegree(u),r.numberToDegree(a)]}}}()},{}],19:[function(e,t,n){"use strict";var r=function(e){var t,n={};if(!(e instanceof Object)||Array.isArray(e))throw new Error("keyMirror(...): Argument must be an object.");for(t in e)e.hasOwnProperty(t)&&(n[t]=t);return n};t.exports=r},{}],20:[function(e,t,n){"use strict";var r=function(e,t,n,r,i,o,a,u){if(!e){var s;if(void 0===t)s=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var l=[n,r,i,o,a,u],c=0;s=new Error(t.replace(/%s/g,function(){return l[c++]})),s.name="Invariant Violation"}throw s.framesToPop=1,s}};t.exports=r},{}],21:[function(e,t,n){function r(e){var t=e?e.length:0;return t?e[t-1]:void 0}t.exports=r},{}],22:[function(e,t,n){t.exports=e("./every")},{"./every":26}],23:[function(e,t,n){t.exports=e("./some")},{"./some":32}],24:[function(e,t,n){t.exports=e("./includes")},{"./includes":28}],25:[function(e,t,n){t.exports=e("./forEach")},{"./forEach":27}],26:[function(e,t,n){function r(e,t,n){var r=u(e)?i:a;return n&&s(e,t,n)&&(t=void 0),("function"!=typeof t||void 0!==n)&&(t=o(t,n,3)),r(e,t)}var i=e("../internal/arrayEvery"),o=e("../internal/baseCallback"),a=e("../internal/baseEvery"),u=e("../lang/isArray"),s=e("../internal/isIterateeCall");t.exports=r},{"../internal/arrayEvery":36,"../internal/baseCallback":41,"../internal/baseEvery":45,"../internal/isIterateeCall":76,"../lang/isArray":85}],27:[function(e,t,n){var r=e("../internal/arrayEach"),i=e("../internal/baseEach"),o=e("../internal/createForEach"),a=o(r,i);t.exports=a},{"../internal/arrayEach":35,"../internal/baseEach":44,"../internal/createForEach":66}],28:[function(e,t,n){function r(e,t,n,r){var d=e?o(e):0;return s(d)||(e=c(e),d=e.length),n="number"!=typeof n||r&&u(t,n,r)?0:0>n?f(d+n,0):n||0,"string"==typeof e||!a(e)&&l(e)?d>=n&&e.indexOf(t,n)>-1:!!d&&i(e,t,n)>-1}var i=e("../internal/baseIndexOf"),o=e("../internal/getLength"),a=e("../lang/isArray"),u=e("../internal/isIterateeCall"),s=e("../internal/isLength"),l=e("../lang/isString"),c=e("../object/values"),f=Math.max;t.exports=r},{"../internal/baseIndexOf":49,"../internal/getLength":70,"../internal/isIterateeCall":76,"../internal/isLength":78,"../lang/isArray":85,"../lang/isString":93,"../object/values":100}],29:[function(e,t,n){function r(e,t,n){var r=u(e)?i:a;return t=o(t,n,3),r(e,t)}var i=e("../internal/arrayMap"),o=e("../internal/baseCallback"),a=e("../internal/baseMap"),u=e("../lang/isArray");t.exports=r},{"../internal/arrayMap":37,"../internal/baseCallback":41,"../internal/baseMap":53,"../lang/isArray":85}],30:[function(e,t,n){function r(e,t){return i(e,o(t))}var i=e("./map"),o=e("../utility/property");t.exports=r},{"../utility/property":102,"./map":29}],31:[function(e,t,n){function r(e){var t=e?i(e):0;return o(t)?t:a(e).length}var i=e("../internal/getLength"),o=e("../internal/isLength"),a=e("../object/keys");t.exports=r},{"../internal/getLength":70,"../internal/isLength":78,"../object/keys":97}],32:[function(e,t,n){function r(e,t,n){var r=u(e)?i:a;return n&&s(e,t,n)&&(t=void 0),("function"!=typeof t||void 0!==n)&&(t=o(t,n,3)),r(e,t)}var i=e("../internal/arraySome"),o=e("../internal/baseCallback"),a=e("../internal/baseSome"),u=e("../lang/isArray"),s=e("../internal/isIterateeCall");t.exports=r},{"../internal/arraySome":38,"../internal/baseCallback":41,"../internal/baseSome":59,"../internal/isIterateeCall":76,"../lang/isArray":85}],33:[function(e,t,n){var r=e("../internal/baseDelay"),i=e("./restParam"),o=i(function(e,t){return r(e,1,t)});t.exports=o},{"../internal/baseDelay":43,"./restParam":34}],34:[function(e,t,n){function r(e,t){if("function"!=typeof e)throw new TypeError(i);return t=o(void 0===t?e.length-1:+t||0,0),function(){for(var n=arguments,r=-1,i=o(n.length-t,0),a=Array(i);++r<i;)a[r]=n[t+r];switch(t){case 0:return e.call(this,a);case 1:return e.call(this,n[0],a);case 2:return e.call(this,n[0],n[1],a)}var u=Array(t+1);for(r=-1;++r<t;)u[r]=n[r];return u[t]=a,e.apply(this,u)}}var i="Expected a function",o=Math.max;t.exports=r},{}],35:[function(e,t,n){function r(e,t){for(var n=-1,r=e.length;++n<r&&t(e[n],n,e)!==!1;);return e}t.exports=r},{}],36:[function(e,t,n){function r(e,t){for(var n=-1,r=e.length;++n<r;)if(!t(e[n],n,e))return!1;return!0}t.exports=r},{}],37:[function(e,t,n){function r(e,t){for(var n=-1,r=e.length,i=Array(r);++n<r;)i[n]=t(e[n],n,e);return i}t.exports=r},{}],38:[function(e,t,n){function r(e,t){for(var n=-1,r=e.length;++n<r;)if(t(e[n],n,e))return!0;return!1}t.exports=r},{}],39:[function(e,t,n){function r(e,t,n){for(var r=-1,o=i(t),a=o.length;++r<a;){var u=o[r],s=e[u],l=n(s,t[u],u,e,t);(l===l?l===s:s!==s)&&(void 0!==s||u in e)||(e[u]=l)}return e}var i=e("../object/keys");t.exports=r},{"../object/keys":97}],40:[function(e,t,n){function r(e,t){return null==t?e:i(t,o(t),e)}var i=e("./baseCopy"),o=e("../object/keys");t.exports=r},{"../object/keys":97,"./baseCopy":42}],41:[function(e,t,n){function r(e,t,n){var r=typeof e;return"function"==r?void 0===t?e:a(e,t,n):null==e?u:"object"==r?i(e):void 0===t?s(e):o(e,t)}var i=e("./baseMatches"),o=e("./baseMatchesProperty"),a=e("./bindCallback"),u=e("../utility/identity"),s=e("../utility/property");t.exports=r},{"../utility/identity":101,"../utility/property":102,"./baseMatches":54,"./baseMatchesProperty":55,"./bindCallback":62}],42:[function(e,t,n){function r(e,t,n){n||(n={});for(var r=-1,i=t.length;++r<i;){var o=t[r];n[o]=e[o]}return n}t.exports=r},{}],43:[function(e,t,n){function r(e,t,n){if("function"!=typeof e)throw new TypeError(i);return setTimeout(function(){e.apply(void 0,n)},t)}var i="Expected a function";t.exports=r},{}],44:[function(e,t,n){var r=e("./baseForOwn"),i=e("./createBaseEach"),o=i(r);t.exports=o},{"./baseForOwn":47,"./createBaseEach":64}],45:[function(e,t,n){function r(e,t){var n=!0;return i(e,function(e,r,i){return n=!!t(e,r,i)}),n}var i=e("./baseEach");t.exports=r},{"./baseEach":44}],46:[function(e,t,n){var r=e("./createBaseFor"),i=r();t.exports=i},{"./createBaseFor":65}],47:[function(e,t,n){function r(e,t){return i(e,t,o)}var i=e("./baseFor"),o=e("../object/keys");t.exports=r},{"../object/keys":97,"./baseFor":46}],48:[function(e,t,n){function r(e,t,n){if(null!=e){void 0!==n&&n in i(e)&&(t=[n]);for(var r=0,o=t.length;null!=e&&o>r;)e=e[t[r++]];return r&&r==o?e:void 0}}var i=e("./toObject");t.exports=r},{"./toObject":82}],49:[function(e,t,n){function r(e,t,n){if(t!==t)return i(e,n);for(var r=n-1,o=e.length;++r<o;)if(e[r]===t)return r;return-1}var i=e("./indexOfNaN");t.exports=r},{"./indexOfNaN":73}],50:[function(e,t,n){function r(e,t,n,u,s,l){return e===t?!0:null==e||null==t||!o(e)&&!a(t)?e!==e&&t!==t:i(e,t,r,n,u,s,l)}var i=e("./baseIsEqualDeep"),o=e("../lang/isObject"),a=e("./isObjectLike");t.exports=r},{"../lang/isObject":92,"./baseIsEqualDeep":51,"./isObjectLike":79}],51:[function(e,t,n){function r(e,t,n,r,d,y,v){var g=u(e),m=u(t),b=c,_=c;g||(b=p.call(e),b==l?b=f:b!=f&&(g=s(e))),m||(_=p.call(t),_==l?_=f:_!=f&&(m=s(t)));var w=b==f,x=_==f,j=b==_;if(j&&!g&&!w)return o(e,t,b);if(!d){var O=w&&h.call(e,"__wrapped__"),E=x&&h.call(t,"__wrapped__");if(O||E)return n(O?e.value():e,E?t.value():t,r,d,y,v)}if(!j)return!1;y||(y=[]),v||(v=[]);for(var k=y.length;k--;)if(y[k]==e)return v[k]==t;y.push(e),v.push(t);var S=(g?i:a)(e,t,n,r,d,y,v);return y.pop(),v.pop(),S}var i=e("./equalArrays"),o=e("./equalByTag"),a=e("./equalObjects"),u=e("../lang/isArray"),s=e("../lang/isTypedArray"),l="[object Arguments]",c="[object Array]",f="[object Object]",d=Object.prototype,h=d.hasOwnProperty,p=d.toString;t.exports=r},{"../lang/isArray":85,"../lang/isTypedArray":94,"./equalArrays":67,"./equalByTag":68,"./equalObjects":69}],52:[function(e,t,n){function r(e,t,n){var r=t.length,a=r,u=!n;if(null==e)return!a;for(e=o(e);r--;){var s=t[r];if(u&&s[2]?s[1]!==e[s[0]]:!(s[0]in e))return!1}for(;++r<a;){s=t[r];var l=s[0],c=e[l],f=s[1];if(u&&s[2]){if(void 0===c&&!(l in e))return!1}else{var d=n?n(c,f,l):void 0;if(!(void 0===d?i(f,c,n,!0):d))return!1}}return!0}var i=e("./baseIsEqual"),o=e("./toObject");t.exports=r},{"./baseIsEqual":50,"./toObject":82}],53:[function(e,t,n){function r(e,t){var n=-1,r=o(e)?Array(e.length):[];return i(e,function(e,i,o){r[++n]=t(e,i,o)}),r}var i=e("./baseEach"),o=e("./isArrayLike");t.exports=r},{"./baseEach":44,"./isArrayLike":74}],54:[function(e,t,n){function r(e){var t=o(e);if(1==t.length&&t[0][2]){var n=t[0][0],r=t[0][1];return function(e){return null==e?!1:e[n]===r&&(void 0!==r||n in a(e))}}return function(e){return i(e,t)}}var i=e("./baseIsMatch"),o=e("./getMatchData"),a=e("./toObject");t.exports=r},{"./baseIsMatch":52,"./getMatchData":71,"./toObject":82}],55:[function(e,t,n){function r(e,t){var n=u(e),r=s(e)&&l(t),h=e+"";return e=d(e),function(u){if(null==u)return!1;var s=h;if(u=f(u),(n||!r)&&!(s in u)){if(u=1==e.length?u:i(u,a(e,0,-1)),null==u)return!1;s=c(e),u=f(u)}return u[s]===t?void 0!==t||s in u:o(t,u[s],void 0,!0)}}var i=e("./baseGet"),o=e("./baseIsEqual"),a=e("./baseSlice"),u=e("../lang/isArray"),s=e("./isKey"),l=e("./isStrictComparable"),c=e("../array/last"),f=e("./toObject"),d=e("./toPath");t.exports=r},{"../array/last":21,"../lang/isArray":85,"./baseGet":48,"./baseIsEqual":50,"./baseSlice":58,"./isKey":77,"./isStrictComparable":80,"./toObject":82,"./toPath":83}],56:[function(e,t,n){function r(e){return function(t){return null==t?void 0:t[e]}}t.exports=r},{}],57:[function(e,t,n){function r(e){var t=e+"";return e=o(e),function(n){return i(n,e,t)}}var i=e("./baseGet"),o=e("./toPath");t.exports=r},{"./baseGet":48,"./toPath":83}],58:[function(e,t,n){function r(e,t,n){var r=-1,i=e.length;t=null==t?0:+t||0,0>t&&(t=-t>i?0:i+t),n=void 0===n||n>i?i:+n||0,0>n&&(n+=i),i=t>n?0:n-t>>>0,t>>>=0;for(var o=Array(i);++r<i;)o[r]=e[r+t];return o}t.exports=r},{}],59:[function(e,t,n){function r(e,t){var n;return i(e,function(e,r,i){return n=t(e,r,i),!n}),!!n}var i=e("./baseEach");t.exports=r},{"./baseEach":44}],60:[function(e,t,n){function r(e){return null==e?"":e+""}t.exports=r},{}],61:[function(e,t,n){function r(e,t){for(var n=-1,r=t.length,i=Array(r);++n<r;)i[n]=e[t[n]];return i}t.exports=r},{}],62:[function(e,t,n){function r(e,t,n){if("function"!=typeof e)return i;if(void 0===t)return e;switch(n){case 1:return function(n){return e.call(t,n)};case 3:return function(n,r,i){return e.call(t,n,r,i)};case 4:return function(n,r,i,o){return e.call(t,n,r,i,o)};case 5:return function(n,r,i,o,a){return e.call(t,n,r,i,o,a)}}return function(){return e.apply(t,arguments)}}var i=e("../utility/identity");t.exports=r},{"../utility/identity":101}],63:[function(e,t,n){function r(e){return a(function(t,n){var r=-1,a=null==t?0:n.length,u=a>2?n[a-2]:void 0,s=a>2?n[2]:void 0,l=a>1?n[a-1]:void 0;for("function"==typeof u?(u=i(u,l,5),a-=2):(u="function"==typeof l?l:void 0,a-=u?1:0),s&&o(n[0],n[1],s)&&(u=3>a?void 0:u,a=1);++r<a;){var c=n[r];c&&e(t,c,u)}return t})}var i=e("./bindCallback"),o=e("./isIterateeCall"),a=e("../function/restParam");t.exports=r},{"../function/restParam":34,"./bindCallback":62,"./isIterateeCall":76}],64:[function(e,t,n){function r(e,t){return function(n,r){var u=n?i(n):0;if(!o(u))return e(n,r);for(var s=t?u:-1,l=a(n);(t?s--:++s<u)&&r(l[s],s,l)!==!1;);return n}}var i=e("./getLength"),o=e("./isLength"),a=e("./toObject");t.exports=r},{"./getLength":70,"./isLength":78,"./toObject":82}],65:[function(e,t,n){function r(e){return function(t,n,r){for(var o=i(t),a=r(t),u=a.length,s=e?u:-1;e?s--:++s<u;){var l=a[s];if(n(o[l],l,o)===!1)break}return t}}var i=e("./toObject");t.exports=r},{"./toObject":82}],66:[function(e,t,n){function r(e,t){return function(n,r,a){return"function"==typeof r&&void 0===a&&o(n)?e(n,r):t(n,i(r,a,3))}}var i=e("./bindCallback"),o=e("../lang/isArray");t.exports=r},{"../lang/isArray":85,"./bindCallback":62}],67:[function(e,t,n){function r(e,t,n,r,o,a,u){var s=-1,l=e.length,c=t.length;if(l!=c&&!(o&&c>l))return!1;for(;++s<l;){var f=e[s],d=t[s],h=r?r(o?d:f,o?f:d,s):void 0;if(void 0!==h){if(h)continue;return!1}if(o){if(!i(t,function(e){return f===e||n(f,e,r,o,a,u)}))return!1}else if(f!==d&&!n(f,d,r,o,a,u))return!1}return!0}var i=e("./arraySome");t.exports=r},{"./arraySome":38}],68:[function(e,t,n){function r(e,t,n){switch(n){case i:case o:return+e==+t;case a:return e.name==t.name&&e.message==t.message;case u:return e!=+e?t!=+t:e==+t;case s:case l:return e==t+""}return!1}var i="[object Boolean]",o="[object Date]",a="[object Error]",u="[object Number]",s="[object RegExp]",l="[object String]";t.exports=r},{}],69:[function(e,t,n){function r(e,t,n,r,o,u,s){var l=i(e),c=l.length,f=i(t),d=f.length;if(c!=d&&!o)return!1;for(var h=c;h--;){var p=l[h];if(!(o?p in t:a.call(t,p)))return!1}for(var y=o;++h<c;){p=l[h];var v=e[p],g=t[p],m=r?r(o?g:v,o?v:g,p):void 0;if(!(void 0===m?n(v,g,r,o,u,s):m))return!1;y||(y="constructor"==p)}if(!y){var b=e.constructor,_=t.constructor;if(b!=_&&"constructor"in e&&"constructor"in t&&!("function"==typeof b&&b instanceof b&&"function"==typeof _&&_ instanceof _))return!1}return!0}var i=e("../object/keys"),o=Object.prototype,a=o.hasOwnProperty;t.exports=r},{"../object/keys":97}],70:[function(e,t,n){var r=e("./baseProperty"),i=r("length");t.exports=i},{"./baseProperty":56}],71:[function(e,t,n){function r(e){for(var t=o(e),n=t.length;n--;)t[n][2]=i(t[n][1]);return t}var i=e("./isStrictComparable"),o=e("../object/pairs");t.exports=r},{"../object/pairs":99,"./isStrictComparable":80}],72:[function(e,t,n){function r(e,t){var n=null==e?void 0:e[t];return i(n)?n:void 0}var i=e("../lang/isNative");t.exports=r},{"../lang/isNative":90}],73:[function(e,t,n){function r(e,t,n){for(var r=e.length,i=t+(n?0:-1);n?i--:++i<r;){var o=e[i];if(o!==o)return i}return-1}t.exports=r},{}],74:[function(e,t,n){function r(e){return null!=e&&o(i(e))}var i=e("./getLength"),o=e("./isLength");t.exports=r},{"./getLength":70,"./isLength":78}],75:[function(e,t,n){function r(e,t){return e="number"==typeof e||i.test(e)?+e:-1,t=null==t?o:t,e>-1&&e%1==0&&t>e}var i=/^\d+$/,o=9007199254740991;t.exports=r},{}],76:[function(e,t,n){function r(e,t,n){if(!a(n))return!1;var r=typeof t;if("number"==r?i(n)&&o(t,n.length):"string"==r&&t in n){var u=n[t];return e===e?e===u:u!==u}return!1}var i=e("./isArrayLike"),o=e("./isIndex"),a=e("../lang/isObject");t.exports=r},{"../lang/isObject":92,"./isArrayLike":74,"./isIndex":75}],77:[function(e,t,n){function r(e,t){var n=typeof e;if("string"==n&&u.test(e)||"number"==n)return!0;if(i(e))return!1;var r=!a.test(e);return r||null!=t&&e in o(t)}var i=e("../lang/isArray"),o=e("./toObject"),a=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\n\\]|\\.)*?\1)\]/,u=/^\w*$/;t.exports=r},{"../lang/isArray":85,"./toObject":82}],78:[function(e,t,n){function r(e){return"number"==typeof e&&e>-1&&e%1==0&&i>=e}var i=9007199254740991;t.exports=r},{}],79:[function(e,t,n){function r(e){return!!e&&"object"==typeof e}t.exports=r},{}],80:[function(e,t,n){function r(e){return e===e&&!i(e)}var i=e("../lang/isObject");t.exports=r},{"../lang/isObject":92}],81:[function(e,t,n){function r(e){for(var t=s(e),n=t.length,r=n&&e.length,l=!!r&&u(r)&&(o(e)||i(e)),f=-1,d=[];++f<n;){var h=t[f];(l&&a(h,r)||c.call(e,h))&&d.push(h)}return d}var i=e("../lang/isArguments"),o=e("../lang/isArray"),a=e("./isIndex"),u=e("./isLength"),s=e("../object/keysIn"),l=Object.prototype,c=l.hasOwnProperty;t.exports=r},{"../lang/isArguments":84,"../lang/isArray":85,"../object/keysIn":98,"./isIndex":75,"./isLength":78}],82:[function(e,t,n){function r(e){return i(e)?e:Object(e)}var i=e("../lang/isObject");t.exports=r},{"../lang/isObject":92}],83:[function(e,t,n){function r(e){if(o(e))return e;var t=[];return i(e).replace(a,function(e,n,r,i){t.push(r?i.replace(u,"$1"):n||e)}),t}var i=e("./baseToString"),o=e("../lang/isArray"),a=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\n\\]|\\.)*?)\2)\]/g,u=/\\(\\)?/g;t.exports=r},{"../lang/isArray":85,"./baseToString":60}],84:[function(e,t,n){function r(e){return o(e)&&i(e)&&u.call(e,"callee")&&!s.call(e,"callee")}var i=e("../internal/isArrayLike"),o=e("../internal/isObjectLike"),a=Object.prototype,u=a.hasOwnProperty,s=a.propertyIsEnumerable;t.exports=r},{"../internal/isArrayLike":74,"../internal/isObjectLike":79}],85:[function(e,t,n){var r=e("../internal/getNative"),i=e("../internal/isLength"),o=e("../internal/isObjectLike"),a="[object Array]",u=Object.prototype,s=u.toString,l=r(Array,"isArray"),c=l||function(e){return o(e)&&i(e.length)&&s.call(e)==a};t.exports=c},{"../internal/getNative":72,"../internal/isLength":78,"../internal/isObjectLike":79}],86:[function(e,t,n){function r(e){return null==e?!0:a(e)&&(o(e)||l(e)||i(e)||s(e)&&u(e.splice))?!e.length:!c(e).length}var i=e("./isArguments"),o=e("./isArray"),a=e("../internal/isArrayLike"),u=e("./isFunction"),s=e("../internal/isObjectLike"),l=e("./isString"),c=e("../object/keys");t.exports=r},{"../internal/isArrayLike":74,"../internal/isObjectLike":79,"../object/keys":97,"./isArguments":84,"./isArray":85,"./isFunction":88,"./isString":93}],87:[function(e,t,n){function r(e,t,n,r){n="function"==typeof n?o(n,r,3):void 0;var a=n?n(e,t):void 0;return void 0===a?i(e,t,n):!!a}var i=e("../internal/baseIsEqual"),o=e("../internal/bindCallback");t.exports=r},{"../internal/baseIsEqual":50,"../internal/bindCallback":62}],88:[function(e,t,n){function r(e){return i(e)&&u.call(e)==o}var i=e("./isObject"),o="[object Function]",a=Object.prototype,u=a.toString;t.exports=r},{"./isObject":92}],89:[function(e,t,n){function r(e){return i(e)&&e!=+e}var i=e("./isNumber");t.exports=r},{"./isNumber":91}],90:[function(e,t,n){function r(e){return null==e?!1:i(e)?c.test(s.call(e)):o(e)&&a.test(e)}var i=e("./isFunction"),o=e("../internal/isObjectLike"),a=/^\[object .+?Constructor\]$/,u=Object.prototype,s=Function.prototype.toString,l=u.hasOwnProperty,c=RegExp("^"+s.call(l).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");t.exports=r},{"../internal/isObjectLike":79,"./isFunction":88}],91:[function(e,t,n){function r(e){return"number"==typeof e||i(e)&&u.call(e)==o}var i=e("../internal/isObjectLike"),o="[object Number]",a=Object.prototype,u=a.toString;t.exports=r},{"../internal/isObjectLike":79}],92:[function(e,t,n){function r(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}t.exports=r},{}],93:[function(e,t,n){function r(e){return"string"==typeof e||i(e)&&u.call(e)==o}var i=e("../internal/isObjectLike"),o="[object String]",a=Object.prototype,u=a.toString;t.exports=r},{"../internal/isObjectLike":79}],94:[function(e,t,n){function r(e){return o(e)&&i(e.length)&&!!P[$.call(e)]}var i=e("../internal/isLength"),o=e("../internal/isObjectLike"),a="[object Arguments]",u="[object Array]",s="[object Boolean]",l="[object Date]",c="[object Error]",f="[object Function]",d="[object Map]",h="[object Number]",p="[object Object]",y="[object RegExp]",v="[object Set]",g="[object String]",m="[object WeakMap]",b="[object ArrayBuffer]",_="[object Float32Array]",w="[object Float64Array]",x="[object Int8Array]",j="[object Int16Array]",O="[object Int32Array]",E="[object Uint8Array]",k="[object Uint8ClampedArray]",S="[object Uint16Array]",A="[object Uint32Array]",P={};P[_]=P[w]=P[x]=P[j]=P[O]=P[E]=P[k]=P[S]=P[A]=!0,P[a]=P[u]=P[b]=P[s]=P[l]=P[c]=P[f]=P[d]=P[h]=P[p]=P[y]=P[v]=P[g]=P[m]=!1;var M=Object.prototype,$=M.toString;t.exports=r},{"../internal/isLength":78,"../internal/isObjectLike":79}],95:[function(e,t,n){var r=e("../internal/assignWith"),i=e("../internal/baseAssign"),o=e("../internal/createAssigner"),a=o(function(e,t,n){return n?r(e,t,n):i(e,t)});t.exports=a},{"../internal/assignWith":39,"../internal/baseAssign":40,"../internal/createAssigner":63}],96:[function(e,t,n){function r(e,t){if(null==e)return!1;var n=p.call(e,t);if(!n&&!l(t)){if(t=d(t),e=1==t.length?e:i(e,o(t,0,-1)),null==e)return!1;t=f(t),n=p.call(e,t)}return n||c(e.length)&&s(t,e.length)&&(u(e)||a(e))}var i=e("../internal/baseGet"),o=e("../internal/baseSlice"),a=e("../lang/isArguments"),u=e("../lang/isArray"),s=e("../internal/isIndex"),l=e("../internal/isKey"),c=e("../internal/isLength"),f=e("../array/last"),d=e("../internal/toPath"),h=Object.prototype,p=h.hasOwnProperty;t.exports=r},{"../array/last":21,"../internal/baseGet":48,"../internal/baseSlice":58,"../internal/isIndex":75,"../internal/isKey":77,"../internal/isLength":78,"../internal/toPath":83,
"../lang/isArguments":84,"../lang/isArray":85}],97:[function(e,t,n){var r=e("../internal/getNative"),i=e("../internal/isArrayLike"),o=e("../lang/isObject"),a=e("../internal/shimKeys"),u=r(Object,"keys"),s=u?function(e){var t=null==e?void 0:e.constructor;return"function"==typeof t&&t.prototype===e||"function"!=typeof e&&i(e)?a(e):o(e)?u(e):[]}:a;t.exports=s},{"../internal/getNative":72,"../internal/isArrayLike":74,"../internal/shimKeys":81,"../lang/isObject":92}],98:[function(e,t,n){function r(e){if(null==e)return[];s(e)||(e=Object(e));var t=e.length;t=t&&u(t)&&(o(e)||i(e))&&t||0;for(var n=e.constructor,r=-1,l="function"==typeof n&&n.prototype===e,f=Array(t),d=t>0;++r<t;)f[r]=r+"";for(var h in e)d&&a(h,t)||"constructor"==h&&(l||!c.call(e,h))||f.push(h);return f}var i=e("../lang/isArguments"),o=e("../lang/isArray"),a=e("../internal/isIndex"),u=e("../internal/isLength"),s=e("../lang/isObject"),l=Object.prototype,c=l.hasOwnProperty;t.exports=r},{"../internal/isIndex":75,"../internal/isLength":78,"../lang/isArguments":84,"../lang/isArray":85,"../lang/isObject":92}],99:[function(e,t,n){function r(e){e=o(e);for(var t=-1,n=i(e),r=n.length,a=Array(r);++t<r;){var u=n[t];a[t]=[u,e[u]]}return a}var i=e("./keys"),o=e("../internal/toObject");t.exports=r},{"../internal/toObject":82,"./keys":97}],100:[function(e,t,n){function r(e){return i(e,o(e))}var i=e("../internal/baseValues"),o=e("./keys");t.exports=r},{"../internal/baseValues":61,"./keys":97}],101:[function(e,t,n){function r(e){return e}t.exports=r},{}],102:[function(e,t,n){function r(e){return a(e)?i(e):o(e)}var i=e("../internal/baseProperty"),o=e("../internal/basePropertyDeep"),a=e("../internal/isKey");t.exports=r},{"../internal/baseProperty":56,"../internal/basePropertyDeep":57,"../internal/isKey":77}]},{},[16])(16)});