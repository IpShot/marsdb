!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.Mars=e()}}(function(){var e;return function t(e,n,r){function i(a,u){if(!n[a]){if(!e[a]){var s="function"==typeof require&&require;if(!u&&s)return s(a,!0);if(o)return o(a,!0);var l=new Error("Cannot find module '"+a+"'");throw l.code="MODULE_NOT_FOUND",l}var c=n[a]={exports:{}};e[a][0].call(c.exports,function(t){var n=e[a][1][t];return i(n?n:t)},c,c.exports,t,e,n,r)}return n[a].exports}for(var o="function"==typeof require&&require,a=0;a<r.length;a++)i(r[a]);return i}({1:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a={};!function(){for(var e=0;e<o.length;e++)a[o.charAt(e)]=e}();var u=function(e){return o.charAt(e)},s=function(e){return"="===e?-1:a[e]},l=function(){function e(){r(this,e)}return i(e,[{key:"encode",value:function(e){if("string"==typeof e){var t=e;e=this.newBinary(t.length);for(var n=0;n<t.length;n++){var r=t.charCodeAt(n);if(r>255)throw new Error("Not ascii. Base64.encode can only take ascii strings.");e[n]=r}}for(var i=[],o=null,a=null,s=null,l=null,n=0;n<e.length;n++)switch(n%3){case 0:o=e[n]>>2&63,a=(3&e[n])<<4;break;case 1:a|=e[n]>>4&15,s=(15&e[n])<<2;break;case 2:s|=e[n]>>6&3,l=63&e[n],i.push(u(o)),i.push(u(a)),i.push(u(s)),i.push(u(l)),o=null,a=null,s=null,l=null}return null!=o&&(i.push(u(o)),i.push(u(a)),null==s?i.push("="):i.push(u(s)),null==l&&i.push("=")),i.join("")}},{key:"decode",value:function(e){var t=Math.floor(3*e.length/4);"="==e.charAt(e.length-1)&&(t--,"="==e.charAt(e.length-2)&&t--);for(var n=this.newBinary(t),r=null,i=null,o=null,a=0,u=0;u<e.length;u++){var l=e.charAt(u),c=s(l);switch(u%4){case 0:if(0>c)throw new Error("invalid base64 string");r=c<<2;break;case 1:if(0>c)throw new Error("invalid base64 string");r|=c>>4,n[a++]=r,i=(15&c)<<4;break;case 2:c>=0&&(i|=c>>2,n[a++]=i,o=(3&c)<<6);break;case 3:c>=0&&(n[a++]=o|c)}}return n}},{key:"newBinary",value:function(e){if("undefined"==typeof Uint8Array||"undefined"==typeof ArrayBuffer){for(var t=[],n=0;e>n;n++)t.push(0);return t.$Uint8ArrayPolyfill=!0,t}return new Uint8Array(new ArrayBuffer(e))}}]),e}();n.Base64=l,n["default"]=new l},{}],2:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=function(e,t,n){for(var r=!0;r;){var i=e,o=t,a=n;u=l=s=void 0,r=!1,null===i&&(i=Function.prototype);var u=Object.getOwnPropertyDescriptor(i,o);if(void 0!==u){if("value"in u)return u.value;var s=u.get;return void 0===s?void 0:s.call(a)}var l=Object.getPrototypeOf(i);if(null===l)return void 0;e=l,t=o,n=a,r=!0}},s=e("eventemitter3"),l=r(s),c=e("invariant"),f=r(c),d=e("./DocumentModifier"),h=r(d),p=e("./IndexManager"),y=r(p),v=e("./StorageManager"),g=r(v),m=e("./CursorObservable"),b=r(m),_=e("./Cursor"),w=r(_),O=e("./Random"),x=r(O),k=e("./Document"),j=r(k),E=new x["default"],A=function(e){var t=E.hexString(20),n=[t,"/collection/"+e];return{value:x["default"].createWithSeed.apply(null,n).id(17),seed:t}},S=g["default"],M=function(e){function t(e){var n=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];i(this,t),u(Object.getPrototypeOf(t.prototype),"constructor",this).call(this),this._methods={},this._modelName=e;var r=n.storageManager||S;this.indexManager=new y["default"](this,n),this.storageManager=new r(this,n),this.idGenerator=n.idGenerator||A}return o(t,e),a(t,[{key:"create",value:function(e){return new j["default"](this,e)}},{key:"static",value:function(e,n){return(0,f["default"])(!t.prototype.hasOwnProperty(e)&&"function"==typeof n,"Static function `%s` must not be an existing one in a model",e),this[e]=n,this}},{key:"method",value:function(e,t){return(0,f["default"])(!this._methods[e]&&"function"==typeof t,"Method function `%s` already defined in a model",e),this._methods[e]=t,this}},{key:"ensureIndex",value:function(e){return this.indexManager.ensureIndex(e)}},{key:"insert",value:function(e){var t=this,n=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],r=this.idGenerator(this.modelName);return e=this.create(e),e._id=e._id||r.value,n.quiet||this.emit("sync:insert",e,r),this.indexManager.indexDocument(e).then(function(){return t.storageManager.persist(e._id,e).then(function(){return t.emit("insert",e,null,r),e._id})})}},{key:"insertAll",value:function(e,t){var n=this;return Promise.all(e.map(function(e){return n.insert(e,t)}))}},{key:"remove",value:function(e){var t=this,n=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];return n.quiet||this.emit("sync:remove",e,n),this.find(e).exec().then(function(e){(0,f["default"])(e.length<=1||n.multi,"remove(..): multi removing is not enabled by options.multi");var r=e.map(function(e){return t.storageManager["delete"](e._id)}),i=e.map(function(e){return t.indexManager.deindexDocument(e)}),o=r.concat(i);return Promise.all(o).then(function(){return e.forEach(function(e){return t.emit("remove",null,e)}),e})})}},{key:"update",value:function(e,t){var n=this,r=arguments.length<=2||void 0===arguments[2]?{}:arguments[2];return r.upsert=!1,r.quiet||this.emit("sync:update",e,t,r),new h["default"](this,e).modify(t,r).then(function(e){var t=e.original,r=e.updated;r=r.map(function(e){return n.create(e)});var i=r.map(function(e){return n.storageManager.persist(e._id,e)}),o=r.map(function(e,r){return n.indexManager.reindexDocument(t[r],e)}),a=i.concat(o);return Promise.all(a).then(function(){return r.forEach(function(e,r){n.emit("update",e,t[r])}),{modified:r.length,original:t,updated:r}})})}},{key:"getIndexIds",value:function(){return this.indexes._id.getAll()}},{key:"find",value:function(e){return new b["default"](this,e)}},{key:"findOne",value:function(e,t){return new w["default"](this,e).sort(t).limit(1).exec().then(function(e){return e[0]})}},{key:"count",value:function(e){return this.ids(e).then(function(e){return e.length})}},{key:"ids",value:function(e){return new w["default"](this,e).ids()}},{key:"modelName",get:function(){return this._modelName}},{key:"indexes",get:function(){return this.indexManager.indexes}},{key:"storage",get:function(){return this.storageManager}}],[{key:"defaultStorageManager",value:function(e){S=e}},{key:"defaultIdGenerator",value:function(e){A=e}}]),t}(l["default"]);n.Collection=M,n["default"]=M},{"./Cursor":4,"./CursorObservable":5,"./Document":6,"./DocumentModifier":8,"./IndexManager":12,"./Random":14,"./StorageManager":15,eventemitter3:19,invariant:21}],3:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=e("invariant"),u=r(a),s=function(){function e(){var t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];i(this,e),(0,u["default"])(t.fieldName,'CollectionIndex(...): you must specify a "feildName" option'),(0,u["default"])(!Array.isArray(t.fieldName),"CollectionIndex(...): compound index is not supported yet"),this.fieldName=t.fieldName,this.unique=t.unique||!1,this.sparse=t.sparse||!1,this.reset()}return o(e,[{key:"reset",value:function(){}},{key:"insert",value:function(e){}},{key:"remove",value:function(e){}},{key:"update",value:function(e,t){}},{key:"getMatching",value:function(e){}},{key:"getBetweenBounds",value:function(e){}},{key:"getAll",value:function(e){}}]),e}();n.CollectionIndex=s,n["default"]=s},{invariant:21}],4:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Object.defineProperty(n,"__esModule",{value:!0});var u,s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=function(e,t,n){for(var r=!0;r;){var i=e,o=t,a=n;u=l=s=void 0,r=!1,null===i&&(i=Function.prototype);var u=Object.getOwnPropertyDescriptor(i,o);if(void 0!==u){if("value"in u)return u.value;var s=u.get;return void 0===s?void 0:s.call(a)}var l=Object.getPrototypeOf(i);if(null===l)return void 0;e=l,t=o,n=a,r=!0}},c=e("lodash/collection/each"),f=r(c),d=e("lodash/lang/isObject"),h=r(d),p=e("lodash/lang/toArray"),y=r(p),v=e("eventemitter3"),g=r(v),m=e("invariant"),b=r(m),_=e("keymirror"),w=r(_),O=e("./DocumentRetriver"),x=r(O),k=e("./DocumentMatcher"),j=r(k),E=e("./DocumentSorter"),A=r(E),S=(0,w["default"])({Filter:null,Sort:null,Map:null,Aggregate:null,Reduce:null,Join:null,JoinEach:null,JoinAll:null});n.PIPELINE_TYPE=S;var M=(u={},a(u,S.Filter,function(e,t){return e.filter(t.value)}),a(u,S.Sort,function(e,t){return e.sort(t.value)}),a(u,S.Map,function(e,t){return e.map(t.value)}),a(u,S.Aggregate,function(e,t){return t.value(e)}),a(u,S.Reduce,function(e,t){return e.reduce(t.value,t.args[0])}),a(u,S.Join,function(e,t,n){return M[S.JoinEach](e,t,n)}),a(u,S.JoinEach,function(e,t,n){return Promise.all((0,y["default"])(e).map(function(e){return M[S.JoinAll](e,t,n)}))}),a(u,S.JoinAll,function(e,t,n){var r=t.value(e);return(0,h["default"])(r)&&r.then?(r.parent&&(r.parent(n),n.once("stopped",r.stop)),r.then(function(){return e})):e}),u);n.PIPELINE_PROCESSORS=M;var P=function(e){function t(e,n){i(this,t),l(Object.getPrototypeOf(t.prototype),"constructor",this).call(this),this.db=e,this._query=n,this._pipeline=[],this._ensureMatcherSorter()}return o(t,e),s(t,[{key:"skip",value:function(e){return this._ensureNotExecuting(),(0,b["default"])(e>=0||"undefined"==typeof e,"skip(...): skip must be a positive number"),this._skip=e,this}},{key:"limit",value:function(e){return this._ensureNotExecuting(),(0,b["default"])(e>=0||"undefined"==typeof e,"limit(...): limit must be a positive number"),this._limit=e,this}},{key:"find",value:function(e){return this._ensureNotExecuting(),this._query=e||this._query,this._ensureMatcherSorter(),this}},{key:"sort",value:function(e){return this._ensureNotExecuting(),(0,b["default"])("object"==typeof e||"undefined"==typeof e||Array.isArray(e),"sort(...): argument must be an object"),this._sort=e,this._ensureMatcherSorter(),this}},{key:"sortFunc",value:function(e){return(0,b["default"])("function"==typeof e,"sortFunc(...): argument must be a function"),this.addPipeline(S.Sort,e),this}},{key:"filter",value:function(e){return(0,b["default"])("function"==typeof e,"filter(...): argument must be a function"),this.addPipeline(S.Filter,e),this}},{key:"map",value:function(e){return(0,b["default"])("function"==typeof e,"map(...): mapper must be a function"),this.addPipeline(S.Map,e),this}},{key:"reduce",value:function(e,t){return(0,b["default"])("function"==typeof e,"reduce(...): reducer argument must be a function"),this.addPipeline(S.Reduce,e,t),this}},{key:"aggregate",value:function(e){return(0,b["default"])("function"==typeof e,"aggregate(...): aggregator must be a function"),this.addPipeline(S.Aggregate,e),this}},{key:"join",value:function(e){return this.joinEach(e)}},{key:"joinEach",value:function(e){return(0,b["default"])("function"==typeof e,"joinEach(...): argument must be a function"),this.addPipeline(S.JoinEach,e),this}},{key:"joinAll",value:function(e){return(0,b["default"])("function"==typeof e,"joinAll(...): argument must be a function"),this.addPipeline(S.JoinAll,e),this}},{key:"addPipeline",value:function(e,t){this._ensureNotExecuting(),(0,b["default"])(e&&S[e],"Unknown pipeline processor type %s",e);for(var n=arguments.length,r=Array(n>2?n-2:0),i=2;n>i;i++)r[i-2]=arguments[i];return this._pipeline.push({type:e,value:t,args:r||[]}),this}},{key:"processPipeline",value:function(e){var t=this,n=arguments.length<=1||void 0===arguments[1]?0:arguments[1],r=this._pipeline[n];return r?Promise.resolve(M[r.type](e,r,this)).then(function(e){return t.processPipeline(e,n+1)}):Promise.resolve(e)}},{key:"processSkipLimits",value:function(e){var t=this._skip||0,n=this._limit||e.length;return e.slice(t,n+t)}},{key:"exec",value:function(){var e=this;return this._executing=!0,this._matchObjects().then(function(t){return e.processPipeline(t)}).then(function(t){return e._executing=!1,t})}},{key:"then",value:function(e,t){return this.exec().then(e,t)}},{key:"ids",value:function(){var e=this;return this._executing=!0,this._matchObjects().then(function(e){return e.map(function(e){return e._id})}).then(function(t){return e._executing=!1,t})}},{key:"_matchObjects",value:function(){var e=this;return new x["default"](this.db).retriveForQeury(this._query).then(function(t){var n=[],r=e._limit&&!e._skip&&!e._sorter;if((0,f["default"])(t,function(t){var i=e._matcher.documentMatches(t);return i.result&&n.push(t),r&&n.length===e._limit?!1:void 0}),r)return n;if(e._sorter){var i=e._sorter.getComparator();n.sort(i)}return e.processSkipLimits(n)})}},{key:"_ensureMatcherSorter",value:function(){this._sorter=void 0,this._matcher=new j["default"](this._query||{}),(this._matcher.hasGeoQuery||this._sort)&&(this._sorter=new A["default"](this._sort||[],{matcher:this._matcher}))}},{key:"_ensureNotExecuting",value:function(){(0,b["default"])(!this.isExecuting,"_ensureNotExecuting(...): cursor is executing, cursor is immutable!")}},{key:"isExecuting",get:function(){return!!this._executing}}]),t}(g["default"]);n.Cursor=P,n["default"]=P},{"./DocumentMatcher":7,"./DocumentRetriver":9,"./DocumentSorter":10,eventemitter3:19,invariant:21,keymirror:22,"lodash/collection/each":27,"lodash/lang/isObject":95,"lodash/lang/toArray":98}],5:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function a(e,t,n){var r=null,i=0,o=null,a=!0,u=null,s=function(){var s=this,l=arguments;if(o){var c=n&&i>=n;a=!c,c&&u&&(clearTimeout(r),u())}else o=new Promise(function(n,c){(u=function(){a?(r=setTimeout(u,t),a=!1):(o=null,i=0,r=null,a=!0,u=null,n(e.apply(s,l)))})()});return i+=1,o},l=function(e){n=e},c=function(e){t=e},f=function(){clearTimeout(r)};return s.updateBatchSize=l,s.updateWait=c,s.cancel=f,s}Object.defineProperty(n,"__esModule",{value:!0});var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=function(e,t,n){for(var r=!0;r;){var i=e,o=t,a=n;u=l=s=void 0,r=!1,null===i&&(i=Function.prototype);var u=Object.getOwnPropertyDescriptor(i,o);if(void 0!==u){if("value"in u)return u.value;var s=u.get;return void 0===s?void 0:s.call(a)}var l=Object.getPrototypeOf(i);if(null===l)return void 0;e=l,t=o,n=a,r=!0}};n.debounce=a;var l=e("lodash/collection/size"),c=r(l),f=e("./Cursor"),d=r(f),h=e("./EJSON"),p=r(h),y=function(e){function t(e,n){i(this,t),s(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,e,n),this.update=a(this.update.bind(this),1e3/15,10),this.maybeUpdate=this.maybeUpdate.bind(this)}return o(t,e),u(t,[{key:"batchSize",value:function(e){return this.update.updateBatchSize(e),this}},{key:"debounce",value:function(e){return this.update.updateWait(e),this}},{key:"observe",value:function(e){var t=this;e=this._prepareListener(e),this.on("update",e);var n=function(e,n){return t.maybeUpdate(e,n)};this.db.on("insert",n),this.db.on("update",n),this.db.on("remove",n);var r=function(){t.db.removeListener("insert",n),t.db.removeListener("update",n),t.db.removeListener("remove",n),t.removeListener("update",e),t.emit("stopped")},i=function(e){t._parentCursor=e},o=function u(e){return{parent:i,stop:r,then:function(t,n){return u(e.then(t,n))}}},a=this.update(!0);return o(a)}},{key:"update",value:function(){var e=this,t=arguments.length<=0||void 0===arguments[0]?!1:arguments[0];return this.exec().then(function(n){return e._latestResult=n,e._latestIds=new Set(n.map(function(e){return e._id})),e._propagateUpdate(t),n})}},{key:"maybeUpdate",value:function(e,t){var n=!e&&t&&(!this._latestIds||this._latestIds.has(t._id)),r=n||e&&t&&(this._matcher.documentMatches(e).result||this._matcher.documentMatches(t).result)&&((0,c["default"])(e)!==(0,c["default"])(t)||e.updatedAt&&(!t.updatedAt||t.updatedAt&&e.updatedAt>t.updatedAt)||!p["default"].equals(e,t)),i=r||e&&!t&&this._matcher.documentMatches(e).result;return i?this.update():void 0}},{key:"_prepareListener",value:function(e){return a(e,0,0)}},{key:"_propagateUpdate",value:function(){var e=arguments.length<=0||void 0===arguments[0]?!1:arguments[0];this.emit("update",this._latestResult,e),!e&&this._parentCursor&&this._parentCursor._propagateUpdate&&this._parentCursor._propagateUpdate(!1)}}]),t}(d["default"]);n.CursorObservable=y,n["default"]=y},{"./Cursor":4,"./EJSON":11,"lodash/collection/size":33}],6:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e){var t=this,n=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];(0,x["default"])(e,"Document(...): you must give a collection for the document"),n=(0,g["default"])(n)?j["default"].parse(n):n,Object.defineProperty(this,"remove",{value:function(){return(0,x["default"])(t._id,"remove(...): document must have an _id for remove"),e.remove({_id:self._id})},writable:!1}),Object.defineProperty(this,"update",{value:function(t){return(0,x["default"])(this._id,"update(...): document must have an _id for update"),e.update({_id:self._id},t)},writable:!1}),Object.defineProperty(this,"copy",{value:function(){return new i(e,j["default"].clone(t))},writable:!1}),Object.defineProperty(this,"serialize",{value:function(){return j["default"].stringify(t)},writable:!1});for(var r in e._methods)Object.defineProperty(this,r,{value:e._methods[r],writable:!1});(0,h["default"])(this,n)}function o(e){return"string"==typeof e||"number"==typeof e}function a(e){return o(e)||e&&"object"==typeof e&&e._id&&o(e._id)&&1===(0,w["default"])(e)}function u(e){return(0,y["default"])(e)&&!j["default"].isBinary(e)}function s(e){return e&&3===E._type(e)}function l(e){return u(e)||s(e)}function c(e,t){if(!s(e))return!1;var n=void 0;return(0,b["default"])(e,function(r,i){var o="$"===i.substr(0,1);if(void 0===n)n=o;else if(n!==o){if(!t)throw new Error("Inconsistent operator: "+JSON.stringify(e));n=!1}}),!!n}function f(e){return/^[0-9]+$/.test(e)}Object.defineProperty(n,"__esModule",{value:!0}),n.Document=i,n.selectorIsId=o,n.selectorIsIdPerhapsAsObject=a,n.isArray=u,n.isPlainObject=s,n.isIndexable=l,n.isOperatorObject=c,n.isNumericKey=f;var d=e("lodash/object/assign"),h=r(d),p=e("lodash/lang/isArray"),y=r(p),v=e("lodash/lang/isString"),g=r(v),m=e("lodash/collection/each"),b=r(m),_=e("lodash/collection/size"),w=r(_),O=e("invariant"),x=r(O),k=e("./EJSON"),j=r(k);n["default"]=i;var E={_type:function(e){return"number"==typeof e?1:"string"==typeof e?2:"boolean"==typeof e?8:u(e)?4:null===e?10:e instanceof RegExp?11:"function"==typeof e?13:e instanceof Date?9:j["default"].isBinary(e)?5:3},_equal:function(e,t){return j["default"].equals(e,t,{keyOrderSensitive:!0})},_typeorder:function(e){return[-1,1,2,3,4,5,-1,6,7,8,0,9,-1,100,2,100,1,8,1][e]},_cmp:function(e,t){if(void 0===e)return void 0===t?0:-1;if(void 0===t)return 1;var n=E._type(e),r=E._type(t),i=E._typeorder(n),o=E._typeorder(r);if(i!==o)return o>i?-1:1;if(n!==r)throw Error("Missing type coercion logic in _cmp");if(7===n&&(n=r=2,e=e.toHexString(),t=t.toHexString()),9===n&&(n=r=1,e=e.getTime(),t=t.getTime()),1===n)return e-t;if(2===r)return t>e?-1:e===t?0:1;if(3===n){var a=function(e){var t=[];for(var n in e)t.push(n),t.push(e[n]);return t};return E._cmp(a(e),a(t))}if(4===n)for(var u=0;;u++){if(u===e.length)return u===t.length?0:-1;if(u===t.length)return 1;var s=E._cmp(e[u],t[u]);if(0!==s)return s}if(5===n){if(e.length!==t.length)return e.length-t.length;for(u=0;u<e.length;u++){if(e[u]<t[u])return-1;if(e[u]>t[u])return 1}return 0}if(8===n)return e?t?0:1:t?-1:0;if(10===n)return 0;if(11===n)throw Error("Sorting not supported on regular expression");if(13===n)throw Error("Sorting not supported on Javascript code");throw Error("Unknown type to sort")}};n.MongoTypeComp=E},{"./EJSON":11,invariant:21,"lodash/collection/each":27,"lodash/collection/size":33,"lodash/lang/isArray":88,"lodash/lang/isString":96,"lodash/object/assign":99}],7:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e){return function(t){return t instanceof RegExp?(0,h["default"])(t,e):"string"!=typeof t?!1:(e.lastIndex=0,e.test(t))}}function a(e){if((0,F.isOperatorObject)(e))throw Error("Can't create equalityValueSelector for operator object");return null==e?function(e){return null==e}:function(t){return F.MongoTypeComp._equal(e,t)}}function u(e,t){t=t||{};var n,r=e.split("."),i=r.length?r[0]:"",o=(0,F.isNumericKey)(i),a=r.length>=2&&(0,F.isNumericKey)(r[1]);r.length>1&&(n=u(r.slice(1).join(".")));var s=function(e){return e.dontIterate||delete e.dontIterate,e.arrayIndices&&!e.arrayIndices.length&&delete e.arrayIndices,e};return function(e,r){if(r||(r=[]),(0,F.isArray)(e)){if(!(o&&i<e.length))return[];r=r.concat(+i,"x")}var u=e[i];if(!n)return[s({value:u,dontIterate:(0,F.isArray)(e)&&(0,F.isArray)(u),arrayIndices:r})];if(!(0,F.isIndexable)(u))return(0,F.isArray)(e)?[]:[s({value:void 0,arrayIndices:r})];var l=[],c=function(e){Array.prototype.push.apply(l,e)};return c(n(u,r)),!(0,F.isArray)(u)||a&&t.forSort||(0,A["default"])(u,function(e,t){(0,F.isPlainObject)(e)&&c(n(e,r.concat(t)))}),l}}function s(e,t){var n=[];return(0,A["default"])(e,function(e){var r=(0,F.isArray)(e.value);t&&r&&!e.dontIterate||n.push({value:e.value,arrayIndices:e.arrayIndices}),r&&!e.dontIterate&&(0,A["default"])(e.value,function(t,r){n.push({value:t,arrayIndices:(e.arrayIndices||[]).concat(r)})})}),n}Object.defineProperty(n,"__esModule",{value:!0});var l=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();n.regexpElementMatcher=o,n.equalityElementMatcher=a,n.makeLookupFunction=u,n.expandArraysInBranches=s;var c=e("lodash/lang/isEmpty"),f=r(c),d=e("lodash/lang/isEqual"),h=r(d),p=e("lodash/lang/isArray"),y=r(p),v=e("lodash/lang/isNumber"),g=r(v),m=e("lodash/lang/isObject"),b=r(m),_=e("lodash/lang/isNaN"),w=r(_),O=e("lodash/object/has"),x=r(O),k=e("lodash/object/keys"),j=r(k),E=e("lodash/collection/each"),A=r(E),S=e("lodash/collection/contains"),M=r(S),P=e("lodash/collection/all"),$=r(P),I=e("lodash/collection/map"),N=r(I),C=e("lodash/collection/any"),T=r(C),L=e("lodash/utility/identity"),D=r(L),J=e("./EJSON"),q=r(J),R=e("geojson-utils"),B=r(R),F=e("./Document"),V=function(){function e(t){i(this,e),this._paths={},this._hasGeoQuery=!1,this._hasWhere=!1,this._isSimple=!0,this._matchingDocument=void 0,this._selector=null,this._docMatcher=this._compileSelector(t)}return l(e,[{key:"documentMatches",value:function(e){if(!e||"object"!=typeof e)throw Error("documentMatches needs a document");return this._docMatcher(e)}},{key:"_compileSelector",value:function(e){if(e instanceof Function)return this._isSimple=!1,this._selector=e,this._recordPathUsed(""),function(t){return{result:!!e.call(t)}};if((0,F.selectorIsId)(e))return this._selector={_id:e},this._recordPathUsed("_id"),function(t){return{result:q["default"].equals(t._id,e)}};if(!e||"_id"in e&&!e._id)return this._isSimple=!1,ne;if("boolean"==typeof e||(0,F.isArray)(e)||q["default"].isBinary(e))throw new Error("Invalid selector: "+e);return this._selector=q["default"].clone(e),U(e,this,{isRoot:!0})}},{key:"_recordPathUsed",value:function(e){this._paths[e]=!0}},{key:"_getPaths",value:function(){return(0,j["default"])(this._paths)}},{key:"hasGeoQuery",get:function(){return this._hasGeoQuery}},{key:"hasWhere",get:function(){return this._hasWhere}},{key:"isSimple",get:function(){return this._isSimple}}]),e}();n.DocumentMatcher=V,n["default"]=V;var U=function(e,t){var n=arguments.length<=2||void 0===arguments[2]?{}:arguments[2],r=[];return(0,A["default"])(e,function(e,i){if("$"===i.substr(0,1)){if(!(0,x["default"])(H,i))throw new Error("Unrecognized logical operator: "+i);t._isSimple=!1,r.push(H[i](e,t,n.inElemMatch))}else{n.inElemMatch||t._recordPathUsed(i);var o=u(i),a=W(e,t,n.isRoot);r.push(function(e){var t=o(e);return a(t)})}}),oe(r)},W=function(e,t,n){return e instanceof RegExp?(t._isSimple=!1,z(o(e))):(0,F.isOperatorObject)(e)?K(e,t,n):z(a(e))},z=function(e){var t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];return function(n){var r=n;t.dontExpandLeafArrays||(r=s(n,t.dontIncludeLeafArrays));var i={};return i.result=(0,T["default"])(r,function(t){var n=e(t.value);return"number"==typeof n&&(t.arrayIndices||(t.arrayIndices=[n]),n=!0),n&&t.arrayIndices&&(i.arrayIndices=t.arrayIndices),n}),i}},K=function(e,t,n){var r=[];return(0,A["default"])(e,function(i,o){var a=(0,M["default"])(["$lt","$lte","$gt","$gte"],o)&&(0,g["default"])(i),u="$ne"===o&&!(0,b["default"])(i),s=(0,M["default"])(["$in","$nin"],o)&&(0,y["default"])(i)&&!(0,T["default"])(i,b["default"]);if("$eq"===o||a||s||u||(t._isSimple=!1),(0,x["default"])(Y,o))r.push(Y[o](i,e,t,n));else{if(!(0,x["default"])(te,o))throw new Error("Unrecognized operator: "+o);var l=te[o];r.push(z(l.compileElementSelector(i,e,t),l))}}),ae(r)},G=function(e,t,n){if(!(0,F.isArray)(e)||(0,f["default"])(e))throw Error("$and/$or/$nor must be nonempty array");return(0,N["default"])(e,function(e){if(!(0,F.isPlainObject)(e))throw Error("$or/$and/$nor entries need to be full objects");return U(e,t,{inElemMatch:n})})},H={$and:function(e,t,n){var r=G(e,t,n);return oe(r)},$or:function(e,t,n){var r=G(e,t,n);return 1===r.length?r[0]:function(e){var t=(0,T["default"])(r,function(t){return t(e).result});return{result:t}}},$nor:function(e,t,n){var r=G(e,t,n);return function(e){var t=(0,$["default"])(r,function(t){return!t(e).result});return{result:t}}},$where:function(e,t){return t._recordPathUsed(""),t._hasWhere=!0,e instanceof Function||(e=Function("obj","return "+e)),function(t){return{result:e.call(t,t)}}},$comment:function(){return function(){return{result:!0}}}},Q=function(e){return function(t){var n=e(t);return{result:!n.result}}},Y={$not:function(e,t,n){return Q(W(e,n))},$ne:function(e){return Q(z(a(e)))},$nin:function(e){return Q(z(te.$in.compileElementSelector(e)))},$exists:function(e){var t=z(function(e){return void 0!==e});return e?t:Q(t)},$options:function(e,t){if(!(0,x["default"])(t,"$regex"))throw Error("$options needs a $regex");return re},$maxDistance:function(e,t){if(!t.$near)throw Error("$maxDistance needs a $near");return re},$all:function(e,t,n){if(!(0,F.isArray)(e))throw Error("$all requires array");if((0,f["default"])(e))return ne;var r=[];return(0,A["default"])(e,function(e){if((0,F.isOperatorObject)(e))throw Error("no $ expressions in $all");r.push(W(e,n))}),ae(r)},$near:function(e,t,n,r){if(!r)throw Error("$near can't be inside another $ operator");n._hasGeoQuery=!0;var i,o,a;if((0,F.isPlainObject)(e)&&(0,x["default"])(e,"$geometry"))i=e.$maxDistance,o=e.$geometry,a=function(e){return e&&e.type?"Point"===e.type?B["default"].pointDistance(o,e):B["default"].geometryWithinRadius(e,o,i)?0:i+1:null};else{if(i=t.$maxDistance,!(0,F.isArray)(e)&&!(0,F.isPlainObject)(e))throw Error("$near argument must be coordinate pair or GeoJSON");o=Z(e),a=function(e){return(0,F.isArray)(e)||(0,F.isPlainObject)(e)?X(o,e):null}}return function(e){e=s(e);var t={result:!1};return(0,A["default"])(e,function(e){var n=a(e.value);null===n||n>i||void 0!==t.distance&&t.distance<=n||(t.result=!0,t.distance=n,e.arrayIndices?t.arrayIndices=e.arrayIndices:delete t.arrayIndices)}),t}}},X=function(e,t){e=Z(e),t=Z(t);var n=e[0]-t[0],r=e[1]-t[1];return(0,w["default"])(n)||(0,w["default"])(r)?null:Math.sqrt(n*n+r*r)},Z=function(e){return(0,N["default"])(e,D["default"])},ee=function(e){return{compileElementSelector:function(t){if((0,F.isArray)(t))return function(){return!1};void 0===t&&(t=null);var n=F.MongoTypeComp._type(t);return function(r){return void 0===r&&(r=null),F.MongoTypeComp._type(r)!==n?!1:e(F.MongoTypeComp._cmp(r,t))}}}},te={$lt:ee(function(e){return 0>e}),$gt:ee(function(e){return e>0}),$lte:ee(function(e){return 0>=e}),$gte:ee(function(e){return e>=0}),$mod:{compileElementSelector:function(e){if(!(0,F.isArray)(e)||2!==e.length||"number"!=typeof e[0]||"number"!=typeof e[1])throw Error("argument to $mod must be an array of two numbers");var t=e[0],n=e[1];return function(e){return"number"==typeof e&&e%t===n}}},$in:{compileElementSelector:function(e){if(!(0,F.isArray)(e))throw Error("$in needs an array");var t=[];return(0,A["default"])(e,function(e){if(e instanceof RegExp)t.push(o(e));else{if((0,F.isOperatorObject)(e))throw Error("cannot nest $ under $in");t.push(a(e))}}),function(e){return void 0===e&&(e=null),(0,T["default"])(t,function(t){return t(e)})}}},$size:{dontExpandLeafArrays:!0,compileElementSelector:function(e){if("string"==typeof e)e=0;else if("number"!=typeof e)throw Error("$size needs a number");return function(t){return(0,F.isArray)(t)&&t.length===e}}},$type:{dontIncludeLeafArrays:!0,compileElementSelector:function(e){if("number"!=typeof e)throw Error("$type needs a number");return function(t){return void 0!==t&&F.MongoTypeComp._type(t)===e}}},$regex:{compileElementSelector:function(e,t){if(!("string"==typeof e||e instanceof RegExp))throw Error("$regex has to be a string or RegExp");var n;if(void 0!==t.$options){if(/[^gim]/.test(t.$options))throw new Error("Only the i, m, and g regexp options are supported");var r=e instanceof RegExp?e.source:e;n=new RegExp(r,t.$options)}else n=e instanceof RegExp?e:new RegExp(e);
return o(n)}},$elemMatch:{dontExpandLeafArrays:!0,compileElementSelector:function(e,t,n){if(!(0,F.isPlainObject)(e))throw Error("$elemMatch need an object");var r,i;return(0,F.isOperatorObject)(e,!0)?(r=W(e,n),i=!1):(r=U(e,n,{inElemMatch:!0}),i=!0),function(e){if(!(0,F.isArray)(e))return!1;for(var t=0;t<e.length;++t){var n,o=e[t];if(i){if(!(0,F.isPlainObject)(o)&&!(0,F.isArray)(o))return!1;n=o}else n=[{value:o,dontIterate:!0}];if(r(n).result)return t}return!1}}}};n.ELEMENT_OPERATORS=te;var ne=function(e){return{result:!1}},re=function(e){return{result:!0}},ie=function(e){return 0===e.length?re:1===e.length?e[0]:function(t){var n={};return n.result=(0,$["default"])(e,function(e){var r=e(t);return r.result&&void 0!==r.distance&&void 0===n.distance&&(n.distance=r.distance),r.result&&r.arrayIndices&&(n.arrayIndices=r.arrayIndices),r.result}),n.result||(delete n.distance,delete n.arrayIndices),n}},oe=ie,ae=ie},{"./Document":6,"./EJSON":11,"geojson-utils":20,"lodash/collection/all":24,"lodash/collection/any":25,"lodash/collection/contains":26,"lodash/collection/each":27,"lodash/collection/map":31,"lodash/lang/isArray":88,"lodash/lang/isEmpty":89,"lodash/lang/isEqual":90,"lodash/lang/isNaN":92,"lodash/lang/isNumber":94,"lodash/lang/isObject":95,"lodash/object/has":100,"lodash/object/keys":101,"lodash/utility/identity":105}],8:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=e("lodash/lang/isObject"),u=r(a),s=e("lodash/object/assign"),l=r(s),c=e("lodash/collection/each"),f=r(c),d=e("lodash/collection/all"),h=r(d),p=e("lodash/utility/identity"),y=r(p),v=e("./EJSON"),g=r(v),m=e("./DocumentRetriver"),b=r(m),_=e("./DocumentMatcher"),w=r(_),O=e("./DocumentSorter"),x=r(O),k=e("./Document"),j=function(){function e(t){var n=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];i(this,e),this.db=t,this._matcher=new w["default"](n),this._query=n}return o(e,[{key:"modify",value:function(e){var t=this,n=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];return new b["default"](this.db).retriveForQeury(this._query).then(function(r){var i=[],o=[];return(0,f["default"])(r,function(r){var a=t._matcher.documentMatches(r);if(a.result){var u=(0,l["default"])({arrayIndices:a.arrayIndices},n),s=t._modifyDocument(r,e,u);o.push(s),i.push(r)}}),{updated:o,original:i}})}},{key:"_modifyDocument",value:function(e,t){var n=arguments.length<=2||void 0===arguments[2]?{}:arguments[2];if(!(0,k.isPlainObject)(t))throw new Error("Modifier must be an object");t=g["default"].clone(t);var r,i=(0,k.isOperatorObject)(t);if(i)r=g["default"].clone(e),(0,f["default"])(t,function(e,t){var i=S[t];if(n.isInsert&&"$setOnInsert"===t&&(i=S.$set),!i)throw new Error("Invalid modifier specified "+t);(0,f["default"])(e,function(e,o){if(""===o)throw new Error("An empty update path is not valid.");if("_id"===o)throw new Error("Mod on _id not allowed");var a=o.split(".");if(!(0,h["default"])(a,y["default"]))throw new Error("The update path '"+o+"' contains an empty field name, which is not allowed.");var u=E(r,a,{noCreate:A[t],forbidArray:"$rename"===t,arrayIndices:n.arrayIndices}),s=a.pop();i(u,s,e,o,r)})});else{if(t._id&&!g["default"].equals(e._id,t._id))throw new Error("Cannot change the _id of a document");for(var o in t)if(/\./.test(o))throw new Error("When replacing document, field name may not contain '.'");r=t,r._id=e._id}return r}}]),e}();n.DocumentModifier=j,n["default"]=j;var E=function(e,t,n){n=n||{};for(var r=!1,i=0;i<t.length;i++){var o=i===t.length-1,a=t[i],u=(0,k.isIndexable)(e);if(!u){if(n.noCreate)return void 0;var s=new Error("cannot use the part '"+a+"' to traverse "+e);throw s.setPropertyError=!0,s}if(e instanceof Array){if(n.forbidArray)return null;if("$"===a){if(r)throw new Error("Too many positional (i.e. '$') elements");if(!n.arrayIndices||!n.arrayIndices.length)throw new Error("The positional operator did not find the match needed from the query");a=n.arrayIndices[0],r=!0}else{if(!(0,k.isNumericKey)(a)){if(n.noCreate)return void 0;throw new Error("can't append to array using string field name ["+a+"]")}a=parseInt(a,10)}if(o&&(t[i]=a),n.noCreate&&a>=e.length)return void 0;for(;e.length<a;)e.push(null);if(!o)if(e.length===a)e.push({});else if("object"!=typeof e[a])throw new Error("can't modify field '"+t[i+1]+"' of list value "+JSON.stringify(e[a]))}else{if(a.length&&"$"===a.substr(0,1))throw new Error("can't set field named "+a);if(!(a in e)){if(n.noCreate)return void 0;o||(e[a]={})}}if(o)return e;e=e[a]}},A={$unset:!0,$pop:!0,$rename:!0,$pull:!0,$pullAll:!0},S={$inc:function(e,t,n){if("number"!=typeof n)throw new Error("Modifier $inc allowed for numbers only");if(t in e){if("number"!=typeof e[t])throw new Error("Cannot apply $inc modifier to non-number");e[t]+=n}else e[t]=n},$set:function(e,t,n){if(!(0,u["default"])(e)){var r=new Error("Cannot set property on non-object field");throw r.setPropertyError=!0,r}if(null===e){var r=new Error("Cannot set property on null");throw r.setPropertyError=!0,r}e[t]=n},$setOnInsert:function(e,t,n){},$unset:function(e,t,n){void 0!==e&&(e instanceof Array?t in e&&(e[t]=null):delete e[t])},$push:function(e,t,n){if(void 0===e[t]&&(e[t]=[]),!(e[t]instanceof Array))throw new Error("Cannot apply $push modifier to non-array");if(!n||!n.$each)return void e[t].push(n);var r=n.$each;if(!(r instanceof Array))throw new Error("$each must be an array");var i=void 0;if("$position"in n){if("number"!=typeof n.$position)throw new Error("$position must be a numeric value");if(n.$position<0)throw new Error("$position in $push must be zero or positive");i=n.$position}var o=void 0;if("$slice"in n){if("number"!=typeof n.$slice)throw new Error("$slice must be a numeric value");if(n.$slice>0)throw new Error("$slice in $push must be zero or negative");o=n.$slice}var a=void 0;if(n.$sort){if(void 0===o)throw new Error("$sort requires $slice to be present");a=new x["default"](n.$sort).getComparator();for(var u=0;u<r.length;u++)if(3!==k.MongoTypeComp._type(r[u]))throw new Error("$push like modifiers using $sort require all elements to be objects")}if(void 0===i)for(var s=0;s<r.length;s++)e[t].push(r[s]);else{for(var l=[i,0],s=0;s<r.length;s++)l.push(r[s]);Array.prototype.splice.apply(e[t],l)}a&&e[t].sort(a),void 0!==o&&(0===o?e[t]=[]:e[t]=e[t].slice(o))},$pushAll:function(e,t,n){if(!("object"==typeof n&&n instanceof Array))throw new Error("Modifier $pushAll/pullAll allowed for arrays only");var r=e[t];if(void 0===r)e[t]=n;else{if(!(r instanceof Array))throw new Error("Cannot apply $pushAll modifier to non-array");for(var i=0;i<n.length;i++)r.push(n[i])}},$addToSet:function(e,t,n){var r=!1;if("object"==typeof n)for(var i in n){"$each"===i&&(r=!0);break}var o=r?n.$each:[n],a=e[t];if(void 0===a)e[t]=o;else{if(!(a instanceof Array))throw new Error("Cannot apply $addToSet modifier to non-array");(0,f["default"])(o,function(e){for(var t=0;t<a.length;t++)if(k.MongoTypeComp._equal(e,a[t]))return;a.push(e)})}},$pop:function(e,t,n){if(void 0!==e){var r=e[t];if(void 0!==r){if(!(r instanceof Array))throw new Error("Cannot apply $pop modifier to non-array");"number"==typeof n&&0>n?r.splice(0,1):r.pop()}}},$pull:function(e,t,n){if(void 0!==e){var r=e[t];if(void 0!==r){if(!(r instanceof Array))throw new Error("Cannot apply $pull/pullAll modifier to non-array");var i=[];if(null==n||"object"!=typeof n||n instanceof Array)for(var o=0;o<r.length;o++)k.MongoTypeComp._equal(r[o],n)||i.push(r[o]);else for(var a=new w["default"](n),o=0;o<r.length;o++)a.documentMatches(r[o]).result||i.push(r[o]);e[t]=i}}},$pullAll:function(e,t,n){if(!("object"==typeof n&&n instanceof Array))throw new Error("Modifier $pushAll/pullAll allowed for arrays only");if(void 0!==e){var r=e[t];if(void 0!==r){if(!(r instanceof Array))throw new Error("Cannot apply $pull/pullAll modifier to non-array");for(var i=[],o=0;o<r.length;o++){for(var a=!1,u=0;u<n.length;u++)if(k.MongoTypeComp._equal(r[o],n[u])){a=!0;break}a||i.push(r[o])}e[t]=i}}},$rename:function(e,t,n,r,i){if(r===n)throw new Error("$rename source must differ from target");if(null===e)throw new Error("$rename source field invalid");if("string"!=typeof n)throw new Error("$rename target must be a string");if(void 0!==e){var o=e[t];delete e[t];var a=n.split("."),u=E(i,a,{forbidArray:!0});if(null===u)throw new Error("$rename target field invalid");var s=a.pop();u[s]=o}},$bit:function(e,t,n){throw new Error("$bit is not supported")}}},{"./Document":6,"./DocumentMatcher":7,"./DocumentRetriver":9,"./DocumentSorter":10,"./EJSON":11,"lodash/collection/all":24,"lodash/collection/each":27,"lodash/lang/isObject":95,"lodash/object/assign":99,"lodash/utility/identity":105}],9:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=e("lodash/lang/isObject"),u=r(a),s=e("lodash/lang/isArray"),l=r(s),c=e("lodash/object/has"),f=r(c),d=e("lodash/collection/size"),h=r(d),p=e("./Document"),y=function(){function e(t){i(this,e),this.db=t}return o(e,[{key:"retriveForQeury",value:function(e){var t=void 0;return(0,p.selectorIsId)(e)?t=[e]:(0,p.selectorIsIdPerhapsAsObject)(e)?t=[e._id]:(0,u["default"])(e)&&(0,f["default"])(e,"_id")&&(0,u["default"])(e._id)&&(0,f["default"])(e._id,"$in")&&(0,l["default"])(e._id.$in)&&(t=e._id.$in),(0,h["default"])(t)>0?this.retriveIds(t):this.retriveAll()}},{key:"retriveAll",value:function(){var e=this;return new Promise(function(t,n){var r=[];e.db.storage.createReadStream().on("data",function(t){return r.push(e.db.create(t.value))}).on("end",function(){return t(r)})})}},{key:"retriveIds",value:function(e){var t=this,n=e.map(function(e){return t.retriveOne(e)});return Promise.all(n)}},{key:"retriveOne",value:function(e){var t=this;return this.db.storage.get(e).then(function(e){return t.db.create(e)})}}]),e}();n.DocumentRetriver=y,n["default"]=y},{"./Document":6,"lodash/collection/size":33,"lodash/lang/isArray":88,"lodash/lang/isObject":95,"lodash/object/has":100}],10:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=e("lodash/lang/isEmpty"),u=r(a),s=e("lodash/object/has"),l=r(s),c=e("lodash/collection/each"),f=r(c),d=e("lodash/collection/contains"),h=r(d),p=e("lodash/collection/all"),y=r(p),v=e("lodash/collection/size"),g=r(v),m=e("lodash/collection/map"),b=r(m),_=e("lodash/collection/pluck"),w=r(_),O=e("./DocumentMatcher"),x=r(O),k=e("./Document"),j=function(){function e(t){var n=this,r=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];i(this,e),this._sortSpecParts=[];var o=function(e,t){if(!e)throw Error("sort keys must be non-empty");if("$"===e.charAt(0))throw Error("unsupported sort key: "+e);n._sortSpecParts.push({path:e,lookup:(0,O.makeLookupFunction)(e,{forSort:!0}),ascending:t})};if(t instanceof Array)for(var a=0;a<t.length;a++)"string"==typeof t[a]?o(t[a],!0):o(t[a][0],"desc"!==t[a][1]);else{if("object"!=typeof t)throw Error("Bad sort specification: "+JSON.stringify(t));(0,f["default"])(t,function(e,t){o(t,e>=0)})}if(this.affectedByModifier){var u={};(0,f["default"])(this._sortSpecParts,function(e){u[e.path]=1}),this._selectorForAffectedByModifier=new x["default"](u)}this._keyComparator=E((0,b["default"])(this._sortSpecParts,function(e,t){return n._keyFieldComparator(t)})),this._keyFilter=null,r.matcher&&this._useWithMatcher(r.matcher)}return o(e,[{key:"getComparator",value:function(e){if(!e||!e.distances)return this._getBaseComparator();var t=e.distances;return E([this._getBaseComparator(),function(e,n){if(!t.has(e._id))throw Error("Missing distance for "+e._id);if(!t.has(n._id))throw Error("Missing distance for "+n._id);return t.get(e._id)-t.get(n._id)}])}},{key:"_getPaths",value:function(){return(0,w["default"])(this._sortSpecParts,"path")}},{key:"_getMinKeyFromDoc",value:function(e){var t=this,n=null;if(this._generateKeysFromDoc(e,function(e){return t._keyCompatibleWithSelector(e)?null===n?void(n=e):void(t._compareKeys(e,n)<0&&(n=e)):void 0}),null===n)throw Error("sort selector found no keys in doc?");return n}},{key:"_keyCompatibleWithSelector",value:function(e){return!this._keyFilter||this._keyFilter(e)}},{key:"_generateKeysFromDoc",value:function(e,t){if(0===this._sortSpecParts.length)throw new Error("can't generate keys without a spec");var n=[],r=function(e){return e.join(",")+","},i=null;if((0,f["default"])(this._sortSpecParts,function(t,o){var a=(0,O.expandArraysInBranches)(t.lookup(e),!0);a.length||(a=[{value:null}]);var u=!1;if(n[o]={},(0,f["default"])(a,function(e){if(!e.arrayIndices){if(a.length>1)throw Error("multiple branches but no array used?");return void(n[o][""]=e.value)}u=!0;var t=r(e.arrayIndices);if((0,l["default"])(n[o],t))throw Error("duplicate path: "+t);if(n[o][t]=e.value,i&&!(0,l["default"])(i,t))throw Error("cannot index parallel arrays")}),i){if(!(0,l["default"])(n[o],"")&&(0,g["default"])(i)!==(0,g["default"])(n[o]))throw Error("cannot index parallel arrays!")}else u&&(i={},(0,f["default"])(n[o],function(e,t){i[t]=!0}))}),!i){var o=(0,b["default"])(n,function(e){if(!(0,l["default"])(e,""))throw Error("no value in sole key case?");return e[""]});return void t(o)}(0,f["default"])(i,function(e,r){var i=(0,b["default"])(n,function(e){if((0,l["default"])(e,""))return e[""];if(!(0,l["default"])(e,r))throw Error("missing path?");return e[r]});t(i)})}},{key:"_compareKeys",value:function(e,t){if(e.length!==this._sortSpecParts.length||t.length!==this._sortSpecParts.length)throw Error("Key has wrong length");return this._keyComparator(e,t)}},{key:"_keyFieldComparator",value:function(e){var t=!this._sortSpecParts[e].ascending;return function(n,r){var i=k.MongoTypeComp._cmp(n[e],r[e]);return t&&(i=-i),i}}},{key:"_getBaseComparator",value:function(){var e=this;return this._sortSpecParts.length?function(t,n){var r=e._getMinKeyFromDoc(t),i=e._getMinKeyFromDoc(n);return e._compareKeys(r,i)}:function(e,t){return 0}}},{key:"_useWithMatcher",value:function(e){if(this._keyFilter)throw Error("called _useWithMatcher twice?");if(!(0,u["default"])(this._sortSpecParts)){var t=e._selector;if(!(t instanceof Function)){var n={};(0,f["default"])(this._sortSpecParts,function(e,t){n[e.path]=[]}),(0,f["default"])(t,function(e,t){var r=n[t];if(r){if(e instanceof RegExp){if(e.ignoreCase||e.multiline)return;return void r.push((0,O.regexpElementMatcher)(e))}return(0,k.isOperatorObject)(e)?void(0,f["default"])(e,function(t,n){(0,h["default"])(["$lt","$lte","$gt","$gte"],n)&&r.push(O.ELEMENT_OPERATORS[n].compileElementSelector(t)),"$regex"!==n||e.$options||r.push(O.ELEMENT_OPERATORS.$regex.compileElementSelector(t,e))}):void r.push((0,O.equalityElementMatcher)(e))}}),(0,u["default"])(n[this._sortSpecParts[0].path])||(this._keyFilter=function(e){return(0,y["default"])(this._sortSpecParts,function(t,r){return(0,y["default"])(n[t.path],function(t){return t(e[r])})})})}}}}]),e}();n.DocumentSorter=j,n["default"]=j;var E=function(e){return function(t,n){for(var r=0;r<e.length;++r){var i=e[r](t,n);if(0!==i)return i}return 0}}},{"./Document":6,"./DocumentMatcher":7,"lodash/collection/all":24,"lodash/collection/contains":26,"lodash/collection/each":27,"lodash/collection/map":31,"lodash/collection/pluck":32,"lodash/collection/size":33,"lodash/lang/isEmpty":89,"lodash/object/has":100}],11:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e){return(0,d["default"])(e)||e===1/0||e===-(1/0)}Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=e("./Base64"),s=r(u),l=e("lodash/lang/isEmpty"),c=r(l),f=e("lodash/lang/isNaN"),d=r(f),h=e("lodash/lang/isArguments"),p=r(h),y=e("lodash/object/has"),v=r(y),g=e("lodash/object/keys"),m=r(g),b=e("lodash/collection/each"),_=r(b),w=function(){function e(){i(this,e),this._setupBuiltinConverters(),this._customTypes={}}return a(e,[{key:"addType",value:function(e,t){if((0,v["default"])(this._customTypes,e))throw new Error("Type "+e+" already present");this._customTypes[e]=t}},{key:"toJSONValue",value:function(e){var t=this._toJSONValueHelper(e);return void 0!==t?t:("object"==typeof e&&(e=this.clone(e),this._adjustTypesToJSONValue(e)),e)}},{key:"fromJSONValue",value:function(e){var t=this._fromJSONValueHelper(e);return t===e&&"object"==typeof e?(e=this.clone(e),this._adjustTypesFromJSONValue(e),e):t}},{key:"stringify",value:function(e){var t=this.toJSONValue(e);return JSON.stringify(t)}},{key:"parse",value:function(e){if("string"!=typeof e)throw new Error("EJSON.parse argument should be a string");return this.fromJSONValue(JSON.parse(e))}},{key:"isBinary",value:function(e){return!!("undefined"!=typeof Uint8Array&&e instanceof Uint8Array||e&&e.$Uint8ArrayPolyfill)}},{key:"equals",value:function(e,t,n){var r,i=this,o=!(!n||!n.keyOrderSensitive);if(e===t)return!0;if((0,d["default"])(e)&&(0,d["default"])(t))return!0;if(!e||!t)return!1;if("object"!=typeof e||"object"!=typeof t)return!1;if(e instanceof Date&&t instanceof Date)return e.valueOf()===t.valueOf();if(this.isBinary(e)&&this.isBinary(t)){if(e.length!==t.length)return!1;for(r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}if("function"==typeof e.equals)return e.equals(t,n);if("function"==typeof t.equals)return t.equals(e,n);if(e instanceof Array){if(!(t instanceof Array))return!1;if(e.length!==t.length)return!1;for(r=0;r<e.length;r++)if(!this.equals(e[r],t[r],n))return!1;return!0}switch(this._isCustomType(e)+this._isCustomType(t)){case 1:return!1;case 2:return this.equals(this.toJSONValue(e),this.toJSONValue(t))}var a;if(o){var u=(0,m["default"])(t);return r=0,a=(0,m["default"])(e).every(function(o){return r>=u.length?!1:o!==u[r]?!1:i.equals(e[o],t[u[r]],n)?(r++,!0):!1}),a&&r===u.length}return r=0,a=(0,m["default"])(e).every(function(o){return(0,v["default"])(t,o)&&i.equals(e[o],t[o],n)?(r++,!0):!1}),a&&(0,m["default"])(t).length===r}},{key:"clone",value:function(e){var t,n=this;if("object"!=typeof e)return e;if(null===e)return null;if(e instanceof Date)return new Date(e.getTime());if(e instanceof RegExp)return e;if(this.isBinary(e)){t=s["default"].newBinary(e.length);for(var r=0;r<e.length;r++)t[r]=e[r];return t}if(Array.isArray(e)||(0,p["default"])(e)){t=[];for(var r=0;r<e.length;r++)t[r]=this.clone(e[r]);return t}return"function"==typeof e.clone?e.clone():this._isCustomType(e)?this.fromJSONValue(this.clone(this.toJSONValue(e)),!0):(t={},(0,_["default"])(e,function(e,r){t[r]=n.clone(e)}),t)}},{key:"newBinary",value:function(e){return s["default"].newBinary(e)}},{key:"_setupBuiltinConverters",value:function(){var e=this;this._builtinConverters=[{matchJSONValue:function(e){return(0,v["default"])(e,"$date")&&1===(0,m["default"])(e).length},matchObject:function(e){return e instanceof Date},toJSONValue:function(e){return{$date:e.getTime()}},fromJSONValue:function(e){return new Date(e.$date)}},{matchJSONValue:function(e){return(0,v["default"])(e,"$InfNaN")&&1===(0,m["default"])(e).length},matchObject:o,toJSONValue:function(e){var t;return t=(0,d["default"])(e)?0:e===1/0?1:-1,{$InfNaN:t}},fromJSONValue:function(e){return e.$InfNaN/0}},{matchJSONValue:function(e){return(0,v["default"])(e,"$binary")&&1===(0,m["default"])(e).length},matchObject:function(e){return"undefined"!=typeof Uint8Array&&e instanceof Uint8Array||e&&(0,v["default"])(e,"$Uint8ArrayPolyfill")},toJSONValue:function(e){return{$binary:s["default"].encode(e)}},fromJSONValue:function(e){return s["default"].decode(e.$binary)}},{matchJSONValue:function(e){return(0,v["default"])(e,"$escape")&&1===(0,m["default"])(e).length},matchObject:function(t){return(0,c["default"])(t)||(0,m["default"])(t).length>2?!1:e._builtinConverters.some(function(e){return e.matchJSONValue(t)})},toJSONValue:function(t){var n={};return(0,_["default"])(t,function(t,r){n[r]=e.toJSONValue(t)}),{$escape:n}},fromJSONValue:function(t){var n={};return(0,_["default"])(t.$escape,function(t,r){n[r]=e.fromJSONValue(t)}),n}},{matchJSONValue:function(e){return(0,v["default"])(e,"$type")&&(0,v["default"])(e,"$value")&&2===(0,m["default"])(e).length},matchObject:function(t){return e._isCustomType(t)},toJSONValue:function(e){var t=e.toJSONValue();return{$type:e.typeName(),$value:t}},fromJSONValue:function(t){var n=t.$type;if(!(0,v["default"])(e._customTypes,n))throw new Error("Custom EJSON type "+n+" is not defined");var r=e._customTypes[n];return r(t.$value)}}]}},{key:"_isCustomType",value:function(e){return e&&"function"==typeof e.toJSONValue&&"function"==typeof e.typeName&&(0,v["default"])(this._customTypes,e.typeName())}},{key:"_adjustTypesToJSONValue",value:function(e){var t=this;if(null===e)return null;var n=this._toJSONValueHelper(e);return void 0!==n?n:"object"!=typeof e?e:((0,_["default"])(e,function(n,r){if("object"==typeof n||void 0===n||o(n)){var i=t._toJSONValueHelper(n);return i?void(e[r]=i):void t._adjustTypesToJSONValue(n)}}),e)}},{key:"_toJSONValueHelper",value:function(e){for(var t=0;t<this._builtinConverters.length;t++){var n=this._builtinConverters[t];if(n.matchObject(e))return n.toJSONValue(e)}return void 0}},{key:"_adjustTypesFromJSONValue",value:function(e){var t=this;if(null===e)return null;var n=this._fromJSONValueHelper(e);return n!==e?n:"object"!=typeof e?e:((0,_["default"])(e,function(n,r){if("object"==typeof n){var i=t._fromJSONValueHelper(n);if(n!==i)return void(e[r]=i);t._adjustTypesFromJSONValue(n)}}),e)}},{key:"_fromJSONValueHelper",value:function(e){if("object"==typeof e&&null!==e&&(0,m["default"])(e).length<=2&&(0,m["default"])(e).every(function(e){return"string"==typeof e&&"$"===e.substr(0,1)}))for(var t=0;t<this._builtinConverters.length;t++){var n=this._builtinConverters[t];if(n.matchJSONValue(e))return n.fromJSONValue(e)}return e}}]),e}();n.EJSON=w,n["default"]=new w},{"./Base64":1,"lodash/collection/each":27,"lodash/lang/isArguments":87,"lodash/lang/isEmpty":89,"lodash/lang/isNaN":92,"lodash/object/has":100,"lodash/object/keys":101}],12:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=e("lodash/object/keys"),u=r(a),s=e("invariant"),l=r(s),c=e("./CollectionIndex"),f=r(c),d=e("./DocumentRetriver"),h=r(d),p=e("./PromiseQueue"),y=r(p),v=function(){function e(t){var n=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];i(this,e),this.db=t,this.indexes={},this._queue=new y["default"]({concurrency:n.concurrency||2}),this.ensureIndex({fieldName:"_id",unique:!0})}return o(e,[{key:"ensureIndex",value:function(e){(0,l["default"])(e&&e.fieldName,"You must specify a fieldName in options object");var t=e.fieldName;return this.indexes[t]?this.indexes[t].buildPromise?this.indexes[t].buildPromise:e&&e.forceRebuild?this.buildIndex(t):Promise.resolve():(this.indexes[t]=new f["default"](e),this.buildIndex(t))}},{key:"buildIndex",value:function(e){var t=this;(0,l["default"])(this.indexes[e],"Index with key `%s` does not ensured yet",e);var n=function(){return t.indexes[e].buildPromise=null},r=this._queue.push(this._doBuildIndex.bind(this,e),10).then(n,n);return this.indexes[e].buildPromise=r,r}},{key:"buildAllIndexes",value:function(){var e=this;return Promise.all((0,u["default"])(this.indexes).map(function(t){return e.ensureIndex({fieldName:t,forceRebuild:!0})}))}},{key:"removeIndex",value:function(e){var t=this;return this._queue.push(function(n,r){delete t.indexes[e],n()},10)}},{key:"indexDocument",value:function(e){var t=this;return this._queue.push(function(n,r){var i=(0,u["default"])(t.indexes),o=null;try{i.forEach(function(n,r){o=r,t.indexes[n].insert(e)}),n()}catch(a){i.slice(0,o).forEach(function(n){t.indexes[n].remove(e)}),r(a)}},1)}},{key:"reindexDocument",value:function(e,t){var n=this;return this._queue.push(function(r,i){var o=(0,u["default"])(n.indexes),a=null;try{o.forEach(function(r,i){a=i,n.indexes[r].update(e,t)}),r()}catch(s){o.slice(0,a).forEach(function(r){n.indexes[r].revertUpdate(e,t)}),i(s)}},1)}},{key:"deindexDocument",value:function(e){var t=this;return this._queue.push(function(n,r){var i=(0,u["default"])(t.indexes);i.forEach(function(n){t.indexes[n].remove(e)}),n()},1)}},{key:"_doBuildIndex",value:function(e,t,n){var r=this.indexes[e];r.reset();var i=[];new h["default"](this.db).retriveAll().then(function(e){e.forEach(function(e){try{r.insert(e)}catch(t){i.push([t,e])}}),i.length?t():n(i)})}}]),e}();n.IndexManager=v,n["default"]=v},{"./CollectionIndex":3,"./DocumentRetriver":9,"./PromiseQueue":13,invariant:21,"lodash/object/keys":101}],13:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=e("async"),a=function(){function e(){var t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];r(this,e),this._queue=(0,o.queue)(this._operationWorker.bind(this),t.concurrency||1)}return i(e,[{key:"push",value:function(e){var t=this;arguments.length<=1||void 0===arguments[1]?1:arguments[1];return new Promise(function(n,r){t._queue.push(function(){return new Promise(e)},function(e){e?r(e):n()})})}},{key:"_operationWorker",value:function(e,t){e().then(t,t)}}]),e}();n.PromiseQueue=a,n["default"]=a},{async:17}],14:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function(){function e(){var e=4022871197,t=function(t){t=t.toString();for(var n=0;n<t.length;n++){e+=t.charCodeAt(n);var r=.02519603282416938*e;e=r>>>0,r-=e,r*=e,e=r>>>0,r-=e,e+=4294967296*r}return 2.3283064365386963e-10*(e>>>0)};return t.version="Mash 0.9",t}return function(t){var n=0,r=0,i=0,o=1;0==t.length&&(t=[+new Date]);var a=e();n=a(" "),r=a(" "),i=a(" ");for(var u=0;u<t.length;u++)n-=a(t[u]),0>n&&(n+=1),r-=a(t[u]),0>r&&(r+=1),i-=a(t[u]),0>i&&(i+=1);a=null;var s=function(){var e=2091639*n+2.3283064365386963e-10*o;return n=r,r=i,i=e-(o=0|e)};return s.uint32=function(){return 4294967296*s()},s.fract53=function(){return s()+1.1102230246251565e-16*(2097152*s()|0)},s.version="Alea 0.9",s.args=t,s}(Array.prototype.slice.call(arguments))},a="23456789ABCDEFGHJKLMNPQRSTWXYZabcdefghijkmnopqrstuvwxyz",u="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789-_",s=function(){function e(){r(this,e);var t=arguments[0];if(!(void 0!==t||"undefined"!=typeof window&&window.crypto&&window.crypto.getRandomValues)){var n="undefined"!=typeof window&&window.innerHeight||"undefined"!=typeof document&&document.documentElement&&document.documentElement.clientHeight||"undefined"!=typeof document&&document.body&&document.body.clientHeight||1,i="undefined"!=typeof window&&window.innerWidth||"undefined"!=typeof document&&document.documentElement&&document.documentElement.clientWidth||"undefined"!=typeof document&&document.body&&document.body.clientWidth||1,a="undefined"!=typeof navigator&&navigator.userAgent||"";t=[new Date,n,i,a,Math.random()]}void 0!==t&&(this.alea=o.apply(null,t))}return i(e,[{key:"fraction",value:function(){var e=this;if(e.alea)return e.alea();if("undefined"!=typeof window&&window.crypto&&window.crypto.getRandomValues){var t=new Uint32Array(1);return window.crypto.getRandomValues(t),2.3283064365386963e-10*t[0]}throw new Error("No random generator available")}},{key:"hexString",value:function(e){for(var t=this,n=[],r=0;e>r;++r)n.push(t.choice("0123456789abcdef"));return n.join("")}},{key:"_randomString",value:function(e,t){for(var n=this,r=[],i=0;e>i;i++)r[i]=n.choice(t);return r.join("")}},{key:"id",value:function(e){var t=this;return void 0===e&&(e=17),t._randomString(e,a)}},{key:"secret",value:function(e){var t=this;return void 0===e&&(e=43),t._randomString(e,u)}},{key:"choice",value:function(e){var t=Math.floor(this.fraction()*e.length);return"string"==typeof e?e.substr(t,1):e[t]}}],[{key:"createWithSeed",value:function(){if(0===arguments.length)throw new Error("No seeds were provided");return new e(arguments)}}]),e}();n.Random=s,n["default"]=s},{}],15:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=e("lodash/object/keys"),u=r(a),s=e("lodash/function/defer"),l=r(s),c=e("eventemitter3"),f=r(c),d=e("./PromiseQueue"),h=r(d),p=e("./EJSON"),y=r(p),v=function(){function e(t,n){i(this,e),this.db=t,this._queue=new h["default"],this._storage={},this.reload()}return o(e,[{key:"loaded",value:function(){return this._loadedPromise}},{key:"reload",value:function(){var e=this;this._loadedPromise?this._loadedPromise=this._loadedPromise.then(function(){return e._loadStorage()}):this._loadedPromise=this._loadStorage()}},{key:"destroy",value:function(){var e=this;return this._loadedPromise.then(function(){e._storage={}})}},{key:"persist",value:function(e,t){var n=this;return this._loadedPromise.then(function(){n._storage[e]=y["default"].clone(t)})}},{key:"delete",value:function(e){var t=this;return this._loadedPromise.then(function(){delete t._storage[e]})}},{key:"get",value:function(e){var t=this;return this._loadedPromise.then(function(){return y["default"].clone(t._storage[e])})}},{key:"createReadStream",value:function(){var e=this,t=new f["default"];return(0,l["default"])(function(){e._loadedPromise.then(function(){(0,u["default"])(e._storage).forEach(function(n){t.emit("data",{value:y["default"].clone(e._storage[n])})}),t.emit("end")})}),t}},{key:"_loadStorage",value:function(){return Promise.resolve()}}]),e}();n.StorageManager=v,n["default"]=v},{"./EJSON":11,"./PromiseQueue":13,eventemitter3:19,
"lodash/function/defer":35,"lodash/object/keys":101}],16:[function(e,t,n){"use strict";var r=e("./dist/Collection")["default"],i=e("./dist/CursorObservable")["default"],o=e("./dist/StorageManager")["default"],a=e("./dist/Random")["default"],u=e("./dist/EJSON")["default"],s=e("./dist/Base64")["default"];t.exports={__esModule:!0,"default":r,Random:a,EJSON:u,Base64:s,Collection:r,CursorObservable:i,StorageManager:o}},{"./dist/Base64":1,"./dist/Collection":2,"./dist/CursorObservable":5,"./dist/EJSON":11,"./dist/Random":14,"./dist/StorageManager":15}],17:[function(t,n,r){(function(t,r){!function(){function i(){}function o(e){return e}function a(e){return!!e}function u(e){return!e}function s(e){return function(){if(null===e)throw new Error("Callback was already called.");e.apply(this,arguments),e=null}}function l(e){return function(){null!==e&&(e.apply(this,arguments),e=null)}}function c(e){return B(e)||"number"==typeof e.length&&e.length>=0&&e.length%1===0}function f(e,t){return c(e)?d(e,t):v(e,t)}function d(e,t){for(var n=-1,r=e.length;++n<r;)t(e[n],n,e)}function h(e,t){for(var n=-1,r=e.length,i=Array(r);++n<r;)i[n]=t(e[n],n,e);return i}function p(e){return h(Array(e),function(e,t){return t})}function y(e,t,n){return d(e,function(e,r,i){n=t(n,e,r,i)}),n}function v(e,t){d(V(e),function(n){t(e[n],n)})}function g(e,t){for(var n=0;n<e.length;n++)if(e[n]===t)return n;return-1}function m(e){var t,n,r=-1;return c(e)?(t=e.length,function(){return r++,t>r?r:null}):(n=V(e),t=n.length,function(){return r++,t>r?n[r]:null})}function b(e,t){return t=null==t?e.length-1:+t,function(){for(var n=Math.max(arguments.length-t,0),r=Array(n),i=0;n>i;i++)r[i]=arguments[i+t];switch(t){case 0:return e.call(this,r);case 1:return e.call(this,arguments[0],r)}}}function _(e){return function(t,n,r){return e(t,r)}}function w(e){return function(t,n,r){r=l(r||i),t=t||[];var o=m(t);if(0>=e)return r(null);var a=!1,u=0,c=!1;!function f(){if(a&&0>=u)return r(null);for(;e>u&&!c;){var i=o();if(null===i)return a=!0,void(0>=u&&r(null));u+=1,n(t[i],i,s(function(e){u-=1,e?(r(e),c=!0):f()}))}}()}}function O(e){return function(t,n,r){return e(J.eachOf,t,n,r)}}function x(e){return function(t,n,r,i){return e(w(n),t,r,i)}}function k(e){return function(t,n,r){return e(J.eachOfSeries,t,n,r)}}function j(e,t,n,r){r=l(r||i);var o=[];e(t,function(e,t,r){n(e,function(e,n){o[t]=n,r(e)})},function(e){r(e,o)})}function E(e,t,n,r){var i=[];e(t,function(e,t,r){n(e,function(n){n&&i.push({index:t,value:e}),r()})},function(){r(h(i.sort(function(e,t){return e.index-t.index}),function(e){return e.value}))})}function A(e,t,n,r){E(e,t,function(e,t){n(e,function(e){t(!e)})},r)}function S(e,t,n){return function(r,i,o,a){function u(){a&&a(n(!1,void 0))}function s(e,r,i){return a?void o(e,function(r){a&&t(r)&&(a(n(!0,e)),a=o=!1),i()}):i()}arguments.length>3?e(r,i,s,u):(a=o,o=i,e(r,s,u))}}function M(e,t){return t}function P(e,t,n){n=n||i;var r=c(t)?[]:{};e(t,function(e,t,n){e(b(function(e,i){i.length<=1&&(i=i[0]),r[t]=i,n(e)}))},function(e){n(e,r)})}function $(e,t,n,r){var i=[];e(t,function(e,t,r){n(e,function(e,t){i=i.concat(t||[]),r(e)})},function(e){r(e,i)})}function I(e,t,n){function r(e,t,n,r){if(null!=r&&"function"!=typeof r)throw new Error("task callback must be a function");return e.started=!0,B(t)||(t=[t]),0===t.length&&e.idle()?J.setImmediate(function(){e.drain()}):(d(t,function(t){var o={data:t,callback:r||i};n?e.tasks.unshift(o):e.tasks.push(o),e.tasks.length===e.concurrency&&e.saturated()}),void J.setImmediate(e.process))}function o(e,t){return function(){a-=1;var n=arguments;d(t,function(e){e.callback.apply(e,n)}),e.tasks.length+a===0&&e.drain(),e.process()}}if(null==t)t=1;else if(0===t)throw new Error("Concurrency must not be zero");var a=0,u={tasks:[],concurrency:t,payload:n,saturated:i,empty:i,drain:i,started:!1,paused:!1,push:function(e,t){r(u,e,!1,t)},kill:function(){u.drain=i,u.tasks=[]},unshift:function(e,t){r(u,e,!0,t)},process:function(){if(!u.paused&&a<u.concurrency&&u.tasks.length)for(;a<u.concurrency&&u.tasks.length;){var t=u.payload?u.tasks.splice(0,u.payload):u.tasks.splice(0,u.tasks.length),n=h(t,function(e){return e.data});0===u.tasks.length&&u.empty(),a+=1;var r=s(o(u,t));e(n,r)}},length:function(){return u.tasks.length},running:function(){return a},idle:function(){return u.tasks.length+a===0},pause:function(){u.paused=!0},resume:function(){if(u.paused!==!1){u.paused=!1;for(var e=Math.min(u.concurrency,u.tasks.length),t=1;e>=t;t++)J.setImmediate(u.process)}}};return u}function N(e){return b(function(t,n){t.apply(null,n.concat([b(function(t,n){"object"==typeof console&&(t?console.error&&console.error(t):console[e]&&d(n,function(t){console[e](t)}))})]))})}function C(e){return function(t,n,r){e(p(t),n,r)}}function T(e){return b(function(t,n){var r=b(function(n){var r=this,i=n.pop();return e(t,function(e,t,i){e.apply(r,n.concat([i]))},i)});return n.length?r.apply(this,n):r})}function L(e){return b(function(t){var n=t.pop();t.push(function(){var e=arguments;r?J.setImmediate(function(){n.apply(null,e)}):n.apply(null,e)});var r=!0;e.apply(this,t),r=!1})}var D,J={},q="object"==typeof self&&self.self===self&&self||"object"==typeof r&&r.global===r&&r||this;null!=q&&(D=q.async),J.noConflict=function(){return q.async=D,J};var R=Object.prototype.toString,B=Array.isArray||function(e){return"[object Array]"===R.call(e)},F=function(e){var t=typeof e;return"function"===t||"object"===t&&!!e},V=Object.keys||function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(n);return t},U="function"==typeof setImmediate&&setImmediate,W=U?function(e){U(e)}:function(e){setTimeout(e,0)};"object"==typeof t&&"function"==typeof t.nextTick?J.nextTick=t.nextTick:J.nextTick=W,J.setImmediate=U?W:J.nextTick,J.forEach=J.each=function(e,t,n){return J.eachOf(e,_(t),n)},J.forEachSeries=J.eachSeries=function(e,t,n){return J.eachOfSeries(e,_(t),n)},J.forEachLimit=J.eachLimit=function(e,t,n,r){return w(t)(e,_(n),r)},J.forEachOf=J.eachOf=function(e,t,n){function r(e){e?n(e):(a+=1,a>=o&&n(null))}n=l(n||i),e=e||[];var o=c(e)?e.length:V(e).length,a=0;return o?void f(e,function(n,i){t(e[i],i,s(r))}):n(null)},J.forEachOfSeries=J.eachOfSeries=function(e,t,n){function r(){var i=!0;return null===a?n(null):(t(e[a],a,s(function(e){if(e)n(e);else{if(a=o(),null===a)return n(null);i?J.nextTick(r):r()}})),void(i=!1))}n=l(n||i),e=e||[];var o=m(e),a=o();r()},J.forEachOfLimit=J.eachOfLimit=function(e,t,n,r){w(t)(e,n,r)},J.map=O(j),J.mapSeries=k(j),J.mapLimit=x(j),J.inject=J.foldl=J.reduce=function(e,t,n,r){J.eachOfSeries(e,function(e,r,i){n(t,e,function(e,n){t=n,i(e)})},function(e){r(e||null,t)})},J.foldr=J.reduceRight=function(e,t,n,r){var i=h(e,o).reverse();J.reduce(i,t,n,r)},J.select=J.filter=O(E),J.selectLimit=J.filterLimit=x(E),J.selectSeries=J.filterSeries=k(E),J.reject=O(A),J.rejectLimit=x(A),J.rejectSeries=k(A),J.any=J.some=S(J.eachOf,a,o),J.someLimit=S(J.eachOfLimit,a,o),J.all=J.every=S(J.eachOf,u,u),J.everyLimit=S(J.eachOfLimit,u,u),J.detect=S(J.eachOf,o,M),J.detectSeries=S(J.eachOfSeries,o,M),J.detectLimit=S(J.eachOfLimit,o,M),J.sortBy=function(e,t,n){function r(e,t){var n=e.criteria,r=t.criteria;return r>n?-1:n>r?1:0}J.map(e,function(e,n){t(e,function(t,r){t?n(t):n(null,{value:e,criteria:r})})},function(e,t){return e?n(e):void n(null,h(t.sort(r),function(e){return e.value}))})},J.auto=function(e,t){function n(e){c.unshift(e)}function r(e){var t=g(c,e);t>=0&&c.splice(t,1)}function o(){u--,d(c.slice(0),function(e){e()})}t=l(t||i);var a=V(e),u=a.length;if(!u)return t(null);var s={},c=[];n(function(){u||t(null,s)}),d(a,function(i){function a(){return y(d,function(e,t){return e&&s.hasOwnProperty(t)},!0)&&!s.hasOwnProperty(i)}function u(){a()&&(r(u),c[c.length-1](f,s))}for(var l,c=B(e[i])?e[i]:[e[i]],f=b(function(e,n){if(n.length<=1&&(n=n[0]),e){var r={};v(s,function(e,t){r[t]=e}),r[i]=n,t(e,r)}else s[i]=n,J.setImmediate(o)}),d=c.slice(0,c.length-1),h=d.length;h--;){if(!(l=e[d[h]]))throw new Error("Has inexistant dependency");if(B(l)&&g(l,i)>=0)throw new Error("Has cyclic dependencies")}a()?c[c.length-1](f,s):n(u)})},J.retry=function(e,t,n){function r(e,t){if("number"==typeof t)e.times=parseInt(t,10)||o;else{if("object"!=typeof t)throw new Error("Unsupported argument type for 'times': "+typeof t);e.times=parseInt(t.times,10)||o,e.interval=parseInt(t.interval,10)||a}}function i(e,t){function n(e,n){return function(r){e(function(e,t){r(!e||n,{err:e,result:t})},t)}}function r(e){return function(t){setTimeout(function(){t(null)},e)}}for(;s.times;){var i=!(s.times-=1);u.push(n(s.task,i)),!i&&s.interval>0&&u.push(r(s.interval))}J.series(u,function(t,n){n=n[n.length-1],(e||s.callback)(n.err,n.result)})}var o=5,a=0,u=[],s={times:o,interval:a},l=arguments.length;if(1>l||l>3)throw new Error("Invalid arguments - must be either (task), (task, callback), (times, task) or (times, task, callback)");return 2>=l&&"function"==typeof e&&(n=t,t=e),"function"!=typeof e&&r(s,e),s.callback=n,s.task=t,s.callback?i():i},J.waterfall=function(e,t){function n(e){return b(function(r,i){if(r)t.apply(null,[r].concat(i));else{var o=e.next();o?i.push(n(o)):i.push(t),L(e).apply(null,i)}})}if(t=l(t||i),!B(e)){var r=new Error("First argument to waterfall must be an array of functions");return t(r)}return e.length?void n(J.iterator(e))():t()},J.parallel=function(e,t){P(J.eachOf,e,t)},J.parallelLimit=function(e,t,n){P(w(t),e,n)},J.series=function(e,t){P(J.eachOfSeries,e,t)},J.iterator=function(e){function t(n){function r(){return e.length&&e[n].apply(null,arguments),r.next()}return r.next=function(){return n<e.length-1?t(n+1):null},r}return t(0)},J.apply=b(function(e,t){return b(function(n){return e.apply(null,t.concat(n))})}),J.concat=O($),J.concatSeries=k($),J.whilst=function(e,t,n){if(n=n||i,e()){var r=b(function(i,o){i?n(i):e.apply(this,o)?t(r):n(null)});t(r)}else n(null)},J.doWhilst=function(e,t,n){var r=0;return J.whilst(function(){return++r<=1||t.apply(this,arguments)},e,n)},J.until=function(e,t,n){return J.whilst(function(){return!e.apply(this,arguments)},t,n)},J.doUntil=function(e,t,n){return J.doWhilst(e,function(){return!t.apply(this,arguments)},n)},J.during=function(e,t,n){n=n||i;var r=b(function(t,r){t?n(t):(r.push(o),e.apply(this,r))}),o=function(e,i){e?n(e):i?t(r):n(null)};e(o)},J.doDuring=function(e,t,n){var r=0;J.during(function(e){r++<1?e(null,!0):t.apply(this,arguments)},e,n)},J.queue=function(e,t){var n=I(function(t,n){e(t[0],n)},t,1);return n},J.priorityQueue=function(e,t){function n(e,t){return e.priority-t.priority}function r(e,t,n){for(var r=-1,i=e.length-1;i>r;){var o=r+(i-r+1>>>1);n(t,e[o])>=0?r=o:i=o-1}return r}function o(e,t,o,a){if(null!=a&&"function"!=typeof a)throw new Error("task callback must be a function");return e.started=!0,B(t)||(t=[t]),0===t.length?J.setImmediate(function(){e.drain()}):void d(t,function(t){var u={data:t,priority:o,callback:"function"==typeof a?a:i};e.tasks.splice(r(e.tasks,u,n)+1,0,u),e.tasks.length===e.concurrency&&e.saturated(),J.setImmediate(e.process)})}var a=J.queue(e,t);return a.push=function(e,t,n){o(a,e,t,n)},delete a.unshift,a},J.cargo=function(e,t){return I(e,1,t)},J.log=N("log"),J.dir=N("dir"),J.memoize=function(e,t){var n={},r={};t=t||o;var i=b(function(i){var o=i.pop(),a=t.apply(null,i);a in n?J.nextTick(function(){o.apply(null,n[a])}):a in r?r[a].push(o):(r[a]=[o],e.apply(null,i.concat([b(function(e){n[a]=e;var t=r[a];delete r[a];for(var i=0,o=t.length;o>i;i++)t[i].apply(null,e)})])))});return i.memo=n,i.unmemoized=e,i},J.unmemoize=function(e){return function(){return(e.unmemoized||e).apply(null,arguments)}},J.times=C(J.map),J.timesSeries=C(J.mapSeries),J.timesLimit=function(e,t,n,r){return J.mapLimit(p(e),t,n,r)},J.seq=function(){var e=arguments;return b(function(t){var n=this,r=t[t.length-1];"function"==typeof r?t.pop():r=i,J.reduce(e,t,function(e,t,r){t.apply(n,e.concat([b(function(e,t){r(e,t)})]))},function(e,t){r.apply(n,[e].concat(t))})})},J.compose=function(){return J.seq.apply(null,Array.prototype.reverse.call(arguments))},J.applyEach=T(J.eachOf),J.applyEachSeries=T(J.eachOfSeries),J.forever=function(e,t){function n(e){return e?r(e):void o(n)}var r=s(t||i),o=L(e);n()},J.ensureAsync=L,J.constant=b(function(e){var t=[null].concat(e);return function(e){return e.apply(this,t)}}),J.wrapSync=J.asyncify=function(e){return b(function(t){var n,r=t.pop();try{n=e.apply(this,t)}catch(i){return r(i)}F(n)&&"function"==typeof n.then?n.then(function(e){r(null,e)})["catch"](function(e){r(e.message?e:new Error(e))}):r(null,n)})},"object"==typeof n&&n.exports?n.exports=J:"function"==typeof e&&e.amd?e([],function(){return J}):q.async=J}()}).call(this,t("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{_process:18}],18:[function(e,t,n){function r(){c=!1,u.length?l=u.concat(l):f=-1,l.length&&i()}function i(){if(!c){var e=setTimeout(r);c=!0;for(var t=l.length;t;){for(u=l,l=[];++f<t;)u&&u[f].run();f=-1,t=l.length}u=null,c=!1,clearTimeout(e)}}function o(e,t){this.fun=e,this.array=t}function a(){}var u,s=t.exports={},l=[],c=!1,f=-1;s.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];l.push(new o(e,t)),1!==l.length||c||setTimeout(i,0)},o.prototype.run=function(){this.fun.apply(null,this.array)},s.title="browser",s.browser=!0,s.env={},s.argv=[],s.version="",s.versions={},s.on=a,s.addListener=a,s.once=a,s.off=a,s.removeListener=a,s.removeAllListeners=a,s.emit=a,s.binding=function(e){throw new Error("process.binding is not supported")},s.cwd=function(){return"/"},s.chdir=function(e){throw new Error("process.chdir is not supported")},s.umask=function(){return 0}},{}],19:[function(e,t,n){"use strict";function r(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function i(){}var o="function"!=typeof Object.create?"~":!1;i.prototype._events=void 0,i.prototype.listeners=function(e,t){var n=o?o+e:e,r=this._events&&this._events[n];if(t)return!!r;if(!r)return[];if(r.fn)return[r.fn];for(var i=0,a=r.length,u=new Array(a);a>i;i++)u[i]=r[i].fn;return u},i.prototype.emit=function(e,t,n,r,i,a){var u=o?o+e:e;if(!this._events||!this._events[u])return!1;var s,l,c=this._events[u],f=arguments.length;if("function"==typeof c.fn){switch(c.once&&this.removeListener(e,c.fn,void 0,!0),f){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,t),!0;case 3:return c.fn.call(c.context,t,n),!0;case 4:return c.fn.call(c.context,t,n,r),!0;case 5:return c.fn.call(c.context,t,n,r,i),!0;case 6:return c.fn.call(c.context,t,n,r,i,a),!0}for(l=1,s=new Array(f-1);f>l;l++)s[l-1]=arguments[l];c.fn.apply(c.context,s)}else{var d,h=c.length;for(l=0;h>l;l++)switch(c[l].once&&this.removeListener(e,c[l].fn,void 0,!0),f){case 1:c[l].fn.call(c[l].context);break;case 2:c[l].fn.call(c[l].context,t);break;case 3:c[l].fn.call(c[l].context,t,n);break;default:if(!s)for(d=1,s=new Array(f-1);f>d;d++)s[d-1]=arguments[d];c[l].fn.apply(c[l].context,s)}}return!0},i.prototype.on=function(e,t,n){var i=new r(t,n||this),a=o?o+e:e;return this._events||(this._events=o?{}:Object.create(null)),this._events[a]?this._events[a].fn?this._events[a]=[this._events[a],i]:this._events[a].push(i):this._events[a]=i,this},i.prototype.once=function(e,t,n){var i=new r(t,n||this,!0),a=o?o+e:e;return this._events||(this._events=o?{}:Object.create(null)),this._events[a]?this._events[a].fn?this._events[a]=[this._events[a],i]:this._events[a].push(i):this._events[a]=i,this},i.prototype.removeListener=function(e,t,n,r){var i=o?o+e:e;if(!this._events||!this._events[i])return this;var a=this._events[i],u=[];if(t)if(a.fn)(a.fn!==t||r&&!a.once||n&&a.context!==n)&&u.push(a);else for(var s=0,l=a.length;l>s;s++)(a[s].fn!==t||r&&!a[s].once||n&&a[s].context!==n)&&u.push(a[s]);return u.length?this._events[i]=1===u.length?u[0]:u:delete this._events[i],this},i.prototype.removeAllListeners=function(e){return this._events?(e?delete this._events[o?o+e:e]:this._events=o?{}:Object.create(null),this):this},i.prototype.off=i.prototype.removeListener,i.prototype.addListener=i.prototype.on,i.prototype.setMaxListeners=function(){return this},i.prefixed=o,"undefined"!=typeof t&&(t.exports=i)},{}],20:[function(e,t,n){!function(){function e(e){for(var t=[],n=[],r=0;r<e[0].length;r++)t.push(e[0][r][1]),n.push(e[0][r][0]);return t=t.sort(function(e,t){return e-t}),n=n.sort(function(e,t){return e-t}),[[t[0],n[0]],[t[t.length-1],n[n.length-1]]]}function n(e,t,n){for(var r=[[0,0]],i=0;i<n.length;i++){for(var o=0;o<n[i].length;o++)r.push(n[i][o]);r.push(n[i][0]),r.push([0,0])}for(var a=!1,i=0,o=r.length-1;i<r.length;o=i++)r[i][0]>t!=r[o][0]>t&&e<(r[o][1]-r[i][1])*(t-r[i][0])/(r[o][0]-r[i][0])+r[i][1]&&(a=!a);return a}var r=this.gju={};"undefined"!=typeof t&&t.exports&&(t.exports=r),r.lineStringsIntersect=function(e,t){for(var n=[],r=0;r<=e.coordinates.length-2;++r)for(var i=0;i<=t.coordinates.length-2;++i){var o={x:e.coordinates[r][1],y:e.coordinates[r][0]},a={x:e.coordinates[r+1][1],y:e.coordinates[r+1][0]},u={x:t.coordinates[i][1],y:t.coordinates[i][0]},s={x:t.coordinates[i+1][1],y:t.coordinates[i+1][0]},l=(s.x-u.x)*(o.y-u.y)-(s.y-u.y)*(o.x-u.x),c=(a.x-o.x)*(o.y-u.y)-(a.y-o.y)*(o.x-u.x),f=(s.y-u.y)*(a.x-o.x)-(s.x-u.x)*(a.y-o.y);if(0!=f){var d=l/f,h=c/f;d>=0&&1>=d&&h>=0&&1>=h&&n.push({type:"Point",coordinates:[o.x+d*(a.x-o.x),o.y+d*(a.y-o.y)]})}}return 0==n.length&&(n=!1),n},r.pointInBoundingBox=function(e,t){return!(e.coordinates[1]<t[0][0]||e.coordinates[1]>t[1][0]||e.coordinates[0]<t[0][1]||e.coordinates[0]>t[1][1])},r.pointInPolygon=function(t,i){for(var o="Polygon"==i.type?[i.coordinates]:i.coordinates,a=!1,u=0;u<o.length;u++)r.pointInBoundingBox(t,e(o[u]))&&(a=!0);if(!a)return!1;for(var s=!1,u=0;u<o.length;u++)n(t.coordinates[1],t.coordinates[0],o[u])&&(s=!0);return s},r.pointInMultiPolygon=function(t,i){for(var o="MultiPolygon"==i.type?[i.coordinates]:i.coordinates,a=!1,u=!1,s=0;s<o.length;s++){for(var l=o[s],c=0;c<l.length;c++)a||r.pointInBoundingBox(t,e(l[c]))&&(a=!0);if(!a)return!1;for(var c=0;c<l.length;c++)u||n(t.coordinates[1],t.coordinates[0],l[c])&&(u=!0)}return u},r.numberToRadius=function(e){return e*Math.PI/180},r.numberToDegree=function(e){return 180*e/Math.PI},r.drawCircle=function(e,t,n){for(var i=[t.coordinates[1],t.coordinates[0]],o=e/1e3/6371,a=[r.numberToRadius(i[0]),r.numberToRadius(i[1])],n=n||15,u=[[i[0],i[1]]],s=0;n>s;s++){var l=2*Math.PI*s/n,c=Math.asin(Math.sin(a[0])*Math.cos(o)+Math.cos(a[0])*Math.sin(o)*Math.cos(l)),f=a[1]+Math.atan2(Math.sin(l)*Math.sin(o)*Math.cos(a[0]),Math.cos(o)-Math.sin(a[0])*Math.sin(c));u[s]=[],u[s][1]=r.numberToDegree(c),u[s][0]=r.numberToDegree(f)}return{type:"Polygon",coordinates:[u]}},r.rectangleCentroid=function(e){var t=e.coordinates[0],n=t[0][0],r=t[0][1],i=t[2][0],o=t[2][1],a=i-n,u=o-r;return{type:"Point",coordinates:[n+a/2,r+u/2]}},r.pointDistance=function(e,t){var n=e.coordinates[0],i=e.coordinates[1],o=t.coordinates[0],a=t.coordinates[1],u=r.numberToRadius(a-i),s=r.numberToRadius(o-n),l=Math.pow(Math.sin(u/2),2)+Math.cos(r.numberToRadius(i))*Math.cos(r.numberToRadius(a))*Math.pow(Math.sin(s/2),2),c=2*Math.atan2(Math.sqrt(l),Math.sqrt(1-l));return 6371*c*1e3},r.geometryWithinRadius=function(e,t,n){if("Point"==e.type)return r.pointDistance(e,t)<=n;if("LineString"==e.type||"Polygon"==e.type){var i,o={};i="Polygon"==e.type?e.coordinates[0]:e.coordinates;for(var a in i)if(o.coordinates=i[a],r.pointDistance(o,t)>n)return!1}return!0},r.area=function(e){for(var t,n,r=0,i=e.coordinates[0],o=i.length-1,a=0;a<i.length;o=a++){var t={x:i[a][1],y:i[a][0]},n={x:i[o][1],y:i[o][0]};r+=t.x*n.y,r-=t.y*n.x}return r/=2},r.centroid=function(e){for(var t,n,i,o=0,a=0,u=e.coordinates[0],s=u.length-1,l=0;l<u.length;s=l++){var n={x:u[l][1],y:u[l][0]},i={x:u[s][1],y:u[s][0]};t=n.x*i.y-i.x*n.y,o+=(n.x+i.x)*t,a+=(n.y+i.y)*t}return t=6*r.area(e),{type:"Point",coordinates:[a/t,o/t]}},r.simplify=function(e,t){t=t||20,e=e.map(function(e){return{lng:e.coordinates[0],lat:e.coordinates[1]}});var n,r,i,o,a,u,s,l,c,f,d,h,p,y,v,g,m,b,_,w=Math.PI/180*.5,O=new Array,x=new Array,k=new Array;if(e.length<3)return e;for(n=e.length,f=360*t/(2*Math.PI*6378137),f*=f,i=0,x[0]=0,k[0]=n-1,r=1;r>0;)if(o=x[r-1],a=k[r-1],r--,a-o>1){for(d=e[a].lng()-e[o].lng(),h=e[a].lat()-e[o].lat(),Math.abs(d)>180&&(d=360-Math.abs(d)),d*=Math.cos(w*(e[a].lat()+e[o].lat())),p=d*d+h*h,u=o+1,s=o,c=-1;a>u;u++)y=e[u].lng()-e[o].lng(),v=e[u].lat()-e[o].lat(),Math.abs(y)>180&&(y=360-Math.abs(y)),y*=Math.cos(w*(e[u].lat()+e[o].lat())),g=y*y+v*v,m=e[u].lng()-e[a].lng(),b=e[u].lat()-e[a].lat(),Math.abs(m)>180&&(m=360-Math.abs(m)),m*=Math.cos(w*(e[u].lat()+e[a].lat())),_=m*m+b*b,l=g>=p+_?_:_>=p+g?g:(y*h-v*d)*(y*h-v*d)/p,l>c&&(s=u,c=l);f>c?(O[i]=o,i++):(r++,x[r-1]=s,k[r-1]=a,r++,x[r-1]=o,k[r-1]=s)}else O[i]=o,i++;O[i]=n-1,i++;for(var j=new Array,u=0;i>u;u++)j.push(e[O[u]]);return j.map(function(e){return{type:"Point",coordinates:[e.lng,e.lat]}})},r.destinationPoint=function(e,t,n){n/=6371,t=r.numberToRadius(t);var i=r.numberToRadius(e.coordinates[0]),o=r.numberToRadius(e.coordinates[1]),a=Math.asin(Math.sin(o)*Math.cos(n)+Math.cos(o)*Math.sin(n)*Math.cos(t)),u=i+Math.atan2(Math.sin(t)*Math.sin(n)*Math.cos(o),Math.cos(n)-Math.sin(o)*Math.sin(a));return u=(u+3*Math.PI)%(2*Math.PI)-Math.PI,{type:"Point",coordinates:[r.numberToDegree(u),r.numberToDegree(a)]}}}()},{}],21:[function(e,t,n){"use strict";var r=function(e,t,n,r,i,o,a,u){if(!e){var s;if(void 0===t)s=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var l=[n,r,i,o,a,u],c=0;s=new Error("Invariant Violation: "+t.replace(/%s/g,function(){return l[c++]}))}throw s.framesToPop=1,s}};t.exports=r},{}],22:[function(e,t,n){"use strict";var r=function(e){var t,n={};if(!(e instanceof Object)||Array.isArray(e))throw new Error("keyMirror(...): Argument must be an object.");for(t in e)e.hasOwnProperty(t)&&(n[t]=t);return n};t.exports=r},{}],23:[function(e,t,n){function r(e){var t=e?e.length:0;return t?e[t-1]:void 0}t.exports=r},{}],24:[function(e,t,n){t.exports=e("./every")},{"./every":28}],25:[function(e,t,n){t.exports=e("./some")},{"./some":34}],26:[function(e,t,n){t.exports=e("./includes")},{"./includes":30}],27:[function(e,t,n){t.exports=e("./forEach")},{"./forEach":29}],28:[function(e,t,n){function r(e,t,n){var r=u(e)?i:a;return n&&s(e,t,n)&&(t=void 0),("function"!=typeof t||void 0!==n)&&(t=o(t,n,3)),r(e,t)}var i=e("../internal/arrayEvery"),o=e("../internal/baseCallback"),a=e("../internal/baseEvery"),u=e("../lang/isArray"),s=e("../internal/isIterateeCall");t.exports=r},{"../internal/arrayEvery":39,"../internal/baseCallback":44,"../internal/baseEvery":48,"../internal/isIterateeCall":79,"../lang/isArray":88}],29:[function(e,t,n){var r=e("../internal/arrayEach"),i=e("../internal/baseEach"),o=e("../internal/createForEach"),a=o(r,i);t.exports=a},{"../internal/arrayEach":38,"../internal/baseEach":47,"../internal/createForEach":69}],30:[function(e,t,n){function r(e,t,n,r){var d=e?o(e):0;return s(d)||(e=c(e),d=e.length),n="number"!=typeof n||r&&u(t,n,r)?0:0>n?f(d+n,0):n||0,"string"==typeof e||!a(e)&&l(e)?d>=n&&e.indexOf(t,n)>-1:!!d&&i(e,t,n)>-1}var i=e("../internal/baseIndexOf"),o=e("../internal/getLength"),a=e("../lang/isArray"),u=e("../internal/isIterateeCall"),s=e("../internal/isLength"),l=e("../lang/isString"),c=e("../object/values"),f=Math.max;t.exports=r},{"../internal/baseIndexOf":52,"../internal/getLength":73,"../internal/isIterateeCall":79,"../internal/isLength":81,"../lang/isArray":88,"../lang/isString":96,"../object/values":104}],31:[function(e,t,n){function r(e,t,n){var r=u(e)?i:a;return t=o(t,n,3),r(e,t)}var i=e("../internal/arrayMap"),o=e("../internal/baseCallback"),a=e("../internal/baseMap"),u=e("../lang/isArray");t.exports=r},{"../internal/arrayMap":40,"../internal/baseCallback":44,"../internal/baseMap":56,"../lang/isArray":88}],32:[function(e,t,n){function r(e,t){return i(e,o(t))}var i=e("./map"),o=e("../utility/property");t.exports=r},{"../utility/property":106,"./map":31}],33:[function(e,t,n){function r(e){var t=e?i(e):0;return o(t)?t:a(e).length}var i=e("../internal/getLength"),o=e("../internal/isLength"),a=e("../object/keys");t.exports=r},{"../internal/getLength":73,"../internal/isLength":81,"../object/keys":101}],34:[function(e,t,n){function r(e,t,n){var r=u(e)?i:a;return n&&s(e,t,n)&&(t=void 0),("function"!=typeof t||void 0!==n)&&(t=o(t,n,3)),r(e,t)}var i=e("../internal/arraySome"),o=e("../internal/baseCallback"),a=e("../internal/baseSome"),u=e("../lang/isArray"),s=e("../internal/isIterateeCall");t.exports=r},{"../internal/arraySome":41,"../internal/baseCallback":44,"../internal/baseSome":62,"../internal/isIterateeCall":79,"../lang/isArray":88}],35:[function(e,t,n){var r=e("../internal/baseDelay"),i=e("./restParam"),o=i(function(e,t){return r(e,1,t)});t.exports=o},{"../internal/baseDelay":46,"./restParam":36}],36:[function(e,t,n){function r(e,t){if("function"!=typeof e)throw new TypeError(i);return t=o(void 0===t?e.length-1:+t||0,0),function(){for(var n=arguments,r=-1,i=o(n.length-t,0),a=Array(i);++r<i;)a[r]=n[t+r];switch(t){case 0:return e.call(this,a);case 1:return e.call(this,n[0],a);case 2:return e.call(this,n[0],n[1],a)}var u=Array(t+1);for(r=-1;++r<t;)u[r]=n[r];return u[t]=a,e.apply(this,u)}}var i="Expected a function",o=Math.max;t.exports=r},{}],37:[function(e,t,n){function r(e,t){var n=-1,r=e.length;for(t||(t=Array(r));++n<r;)t[n]=e[n];return t}t.exports=r},{}],38:[function(e,t,n){function r(e,t){for(var n=-1,r=e.length;++n<r&&t(e[n],n,e)!==!1;);return e}t.exports=r},{}],39:[function(e,t,n){function r(e,t){for(var n=-1,r=e.length;++n<r;)if(!t(e[n],n,e))return!1;return!0}t.exports=r},{}],40:[function(e,t,n){function r(e,t){for(var n=-1,r=e.length,i=Array(r);++n<r;)i[n]=t(e[n],n,e);return i}t.exports=r},{}],41:[function(e,t,n){function r(e,t){for(var n=-1,r=e.length;++n<r;)if(t(e[n],n,e))return!0;return!1}t.exports=r},{}],42:[function(e,t,n){function r(e,t,n){for(var r=-1,o=i(t),a=o.length;++r<a;){var u=o[r],s=e[u],l=n(s,t[u],u,e,t);(l===l?l===s:s!==s)&&(void 0!==s||u in e)||(e[u]=l)}return e}var i=e("../object/keys");t.exports=r},{"../object/keys":101}],43:[function(e,t,n){function r(e,t){return null==t?e:i(t,o(t),e)}var i=e("./baseCopy"),o=e("../object/keys");t.exports=r},{"../object/keys":101,"./baseCopy":45}],44:[function(e,t,n){function r(e,t,n){var r=typeof e;return"function"==r?void 0===t?e:a(e,t,n):null==e?u:"object"==r?i(e):void 0===t?s(e):o(e,t)}var i=e("./baseMatches"),o=e("./baseMatchesProperty"),a=e("./bindCallback"),u=e("../utility/identity"),s=e("../utility/property");t.exports=r},{"../utility/identity":105,"../utility/property":106,"./baseMatches":57,"./baseMatchesProperty":58,"./bindCallback":65}],45:[function(e,t,n){function r(e,t,n){n||(n={});for(var r=-1,i=t.length;++r<i;){var o=t[r];n[o]=e[o]}return n}t.exports=r},{}],46:[function(e,t,n){function r(e,t,n){if("function"!=typeof e)throw new TypeError(i);return setTimeout(function(){e.apply(void 0,n)},t)}var i="Expected a function";t.exports=r},{}],47:[function(e,t,n){var r=e("./baseForOwn"),i=e("./createBaseEach"),o=i(r);t.exports=o},{"./baseForOwn":50,"./createBaseEach":67}],48:[function(e,t,n){function r(e,t){var n=!0;return i(e,function(e,r,i){return n=!!t(e,r,i)}),n}var i=e("./baseEach");t.exports=r},{"./baseEach":47}],49:[function(e,t,n){var r=e("./createBaseFor"),i=r();t.exports=i},{"./createBaseFor":68}],50:[function(e,t,n){function r(e,t){return i(e,t,o)}var i=e("./baseFor"),o=e("../object/keys");t.exports=r},{"../object/keys":101,"./baseFor":49}],51:[function(e,t,n){function r(e,t,n){if(null!=e){void 0!==n&&n in i(e)&&(t=[n]);for(var r=0,o=t.length;null!=e&&o>r;)e=e[t[r++]];return r&&r==o?e:void 0}}var i=e("./toObject");t.exports=r},{"./toObject":85}],52:[function(e,t,n){function r(e,t,n){if(t!==t)return i(e,n);for(var r=n-1,o=e.length;++r<o;)if(e[r]===t)return r;return-1}var i=e("./indexOfNaN");t.exports=r},{"./indexOfNaN":76}],53:[function(e,t,n){function r(e,t,n,u,s,l){return e===t?!0:null==e||null==t||!o(e)&&!a(t)?e!==e&&t!==t:i(e,t,r,n,u,s,l)}var i=e("./baseIsEqualDeep"),o=e("../lang/isObject"),a=e("./isObjectLike");t.exports=r},{"../lang/isObject":95,"./baseIsEqualDeep":54,"./isObjectLike":82}],54:[function(e,t,n){function r(e,t,n,r,d,y,v){var g=u(e),m=u(t),b=c,_=c;g||(b=p.call(e),b==l?b=f:b!=f&&(g=s(e))),m||(_=p.call(t),_==l?_=f:_!=f&&(m=s(t)));var w=b==f,O=_==f,x=b==_;if(x&&!g&&!w)return o(e,t,b);if(!d){var k=w&&h.call(e,"__wrapped__"),j=O&&h.call(t,"__wrapped__");if(k||j)return n(k?e.value():e,j?t.value():t,r,d,y,v)}if(!x)return!1;y||(y=[]),v||(v=[]);for(var E=y.length;E--;)if(y[E]==e)return v[E]==t;y.push(e),v.push(t);var A=(g?i:a)(e,t,n,r,d,y,v);return y.pop(),v.pop(),A}var i=e("./equalArrays"),o=e("./equalByTag"),a=e("./equalObjects"),u=e("../lang/isArray"),s=e("../lang/isTypedArray"),l="[object Arguments]",c="[object Array]",f="[object Object]",d=Object.prototype,h=d.hasOwnProperty,p=d.toString;t.exports=r},{"../lang/isArray":88,"../lang/isTypedArray":97,"./equalArrays":70,"./equalByTag":71,"./equalObjects":72}],55:[function(e,t,n){function r(e,t,n){var r=t.length,a=r,u=!n;if(null==e)return!a;for(e=o(e);r--;){var s=t[r];if(u&&s[2]?s[1]!==e[s[0]]:!(s[0]in e))return!1}for(;++r<a;){s=t[r];var l=s[0],c=e[l],f=s[1];if(u&&s[2]){if(void 0===c&&!(l in e))return!1}else{var d=n?n(c,f,l):void 0;if(!(void 0===d?i(f,c,n,!0):d))return!1}}return!0}var i=e("./baseIsEqual"),o=e("./toObject");t.exports=r},{"./baseIsEqual":53,"./toObject":85}],56:[function(e,t,n){function r(e,t){var n=-1,r=o(e)?Array(e.length):[];return i(e,function(e,i,o){r[++n]=t(e,i,o)}),r}var i=e("./baseEach"),o=e("./isArrayLike");t.exports=r},{"./baseEach":47,"./isArrayLike":77}],57:[function(e,t,n){function r(e){var t=o(e);if(1==t.length&&t[0][2]){var n=t[0][0],r=t[0][1];return function(e){return null==e?!1:e[n]===r&&(void 0!==r||n in a(e))}}return function(e){return i(e,t)}}var i=e("./baseIsMatch"),o=e("./getMatchData"),a=e("./toObject");t.exports=r},{"./baseIsMatch":55,"./getMatchData":74,"./toObject":85}],58:[function(e,t,n){function r(e,t){var n=u(e),r=s(e)&&l(t),h=e+"";return e=d(e),function(u){if(null==u)return!1;var s=h;if(u=f(u),(n||!r)&&!(s in u)){if(u=1==e.length?u:i(u,a(e,0,-1)),null==u)return!1;s=c(e),u=f(u)}return u[s]===t?void 0!==t||s in u:o(t,u[s],void 0,!0)}}var i=e("./baseGet"),o=e("./baseIsEqual"),a=e("./baseSlice"),u=e("../lang/isArray"),s=e("./isKey"),l=e("./isStrictComparable"),c=e("../array/last"),f=e("./toObject"),d=e("./toPath");t.exports=r},{"../array/last":23,"../lang/isArray":88,"./baseGet":51,"./baseIsEqual":53,"./baseSlice":61,"./isKey":80,"./isStrictComparable":83,"./toObject":85,"./toPath":86}],59:[function(e,t,n){function r(e){return function(t){return null==t?void 0:t[e]}}t.exports=r},{}],60:[function(e,t,n){function r(e){var t=e+"";return e=o(e),function(n){return i(n,e,t)}}var i=e("./baseGet"),o=e("./toPath");t.exports=r},{"./baseGet":51,"./toPath":86}],61:[function(e,t,n){function r(e,t,n){var r=-1,i=e.length;t=null==t?0:+t||0,0>t&&(t=-t>i?0:i+t),n=void 0===n||n>i?i:+n||0,0>n&&(n+=i),i=t>n?0:n-t>>>0,t>>>=0;for(var o=Array(i);++r<i;)o[r]=e[r+t];return o}t.exports=r},{}],62:[function(e,t,n){function r(e,t){var n;return i(e,function(e,r,i){return n=t(e,r,i),!n}),!!n}var i=e("./baseEach");t.exports=r},{"./baseEach":47}],63:[function(e,t,n){function r(e){return null==e?"":e+""}t.exports=r},{}],64:[function(e,t,n){function r(e,t){for(var n=-1,r=t.length,i=Array(r);++n<r;)i[n]=e[t[n]];return i}t.exports=r},{}],65:[function(e,t,n){function r(e,t,n){if("function"!=typeof e)return i;if(void 0===t)return e;switch(n){case 1:return function(n){return e.call(t,n)};case 3:return function(n,r,i){return e.call(t,n,r,i)};case 4:return function(n,r,i,o){return e.call(t,n,r,i,o)};case 5:return function(n,r,i,o,a){return e.call(t,n,r,i,o,a)}}return function(){return e.apply(t,arguments)}}var i=e("../utility/identity");t.exports=r},{"../utility/identity":105}],66:[function(e,t,n){function r(e){return a(function(t,n){var r=-1,a=null==t?0:n.length,u=a>2?n[a-2]:void 0,s=a>2?n[2]:void 0,l=a>1?n[a-1]:void 0;
for("function"==typeof u?(u=i(u,l,5),a-=2):(u="function"==typeof l?l:void 0,a-=u?1:0),s&&o(n[0],n[1],s)&&(u=3>a?void 0:u,a=1);++r<a;){var c=n[r];c&&e(t,c,u)}return t})}var i=e("./bindCallback"),o=e("./isIterateeCall"),a=e("../function/restParam");t.exports=r},{"../function/restParam":36,"./bindCallback":65,"./isIterateeCall":79}],67:[function(e,t,n){function r(e,t){return function(n,r){var u=n?i(n):0;if(!o(u))return e(n,r);for(var s=t?u:-1,l=a(n);(t?s--:++s<u)&&r(l[s],s,l)!==!1;);return n}}var i=e("./getLength"),o=e("./isLength"),a=e("./toObject");t.exports=r},{"./getLength":73,"./isLength":81,"./toObject":85}],68:[function(e,t,n){function r(e){return function(t,n,r){for(var o=i(t),a=r(t),u=a.length,s=e?u:-1;e?s--:++s<u;){var l=a[s];if(n(o[l],l,o)===!1)break}return t}}var i=e("./toObject");t.exports=r},{"./toObject":85}],69:[function(e,t,n){function r(e,t){return function(n,r,a){return"function"==typeof r&&void 0===a&&o(n)?e(n,r):t(n,i(r,a,3))}}var i=e("./bindCallback"),o=e("../lang/isArray");t.exports=r},{"../lang/isArray":88,"./bindCallback":65}],70:[function(e,t,n){function r(e,t,n,r,o,a,u){var s=-1,l=e.length,c=t.length;if(l!=c&&!(o&&c>l))return!1;for(;++s<l;){var f=e[s],d=t[s],h=r?r(o?d:f,o?f:d,s):void 0;if(void 0!==h){if(h)continue;return!1}if(o){if(!i(t,function(e){return f===e||n(f,e,r,o,a,u)}))return!1}else if(f!==d&&!n(f,d,r,o,a,u))return!1}return!0}var i=e("./arraySome");t.exports=r},{"./arraySome":41}],71:[function(e,t,n){function r(e,t,n){switch(n){case i:case o:return+e==+t;case a:return e.name==t.name&&e.message==t.message;case u:return e!=+e?t!=+t:e==+t;case s:case l:return e==t+""}return!1}var i="[object Boolean]",o="[object Date]",a="[object Error]",u="[object Number]",s="[object RegExp]",l="[object String]";t.exports=r},{}],72:[function(e,t,n){function r(e,t,n,r,o,u,s){var l=i(e),c=l.length,f=i(t),d=f.length;if(c!=d&&!o)return!1;for(var h=c;h--;){var p=l[h];if(!(o?p in t:a.call(t,p)))return!1}for(var y=o;++h<c;){p=l[h];var v=e[p],g=t[p],m=r?r(o?g:v,o?v:g,p):void 0;if(!(void 0===m?n(v,g,r,o,u,s):m))return!1;y||(y="constructor"==p)}if(!y){var b=e.constructor,_=t.constructor;if(b!=_&&"constructor"in e&&"constructor"in t&&!("function"==typeof b&&b instanceof b&&"function"==typeof _&&_ instanceof _))return!1}return!0}var i=e("../object/keys"),o=Object.prototype,a=o.hasOwnProperty;t.exports=r},{"../object/keys":101}],73:[function(e,t,n){var r=e("./baseProperty"),i=r("length");t.exports=i},{"./baseProperty":59}],74:[function(e,t,n){function r(e){for(var t=o(e),n=t.length;n--;)t[n][2]=i(t[n][1]);return t}var i=e("./isStrictComparable"),o=e("../object/pairs");t.exports=r},{"../object/pairs":103,"./isStrictComparable":83}],75:[function(e,t,n){function r(e,t){var n=null==e?void 0:e[t];return i(n)?n:void 0}var i=e("../lang/isNative");t.exports=r},{"../lang/isNative":93}],76:[function(e,t,n){function r(e,t,n){for(var r=e.length,i=t+(n?0:-1);n?i--:++i<r;){var o=e[i];if(o!==o)return i}return-1}t.exports=r},{}],77:[function(e,t,n){function r(e){return null!=e&&o(i(e))}var i=e("./getLength"),o=e("./isLength");t.exports=r},{"./getLength":73,"./isLength":81}],78:[function(e,t,n){function r(e,t){return e="number"==typeof e||i.test(e)?+e:-1,t=null==t?o:t,e>-1&&e%1==0&&t>e}var i=/^\d+$/,o=9007199254740991;t.exports=r},{}],79:[function(e,t,n){function r(e,t,n){if(!a(n))return!1;var r=typeof t;if("number"==r?i(n)&&o(t,n.length):"string"==r&&t in n){var u=n[t];return e===e?e===u:u!==u}return!1}var i=e("./isArrayLike"),o=e("./isIndex"),a=e("../lang/isObject");t.exports=r},{"../lang/isObject":95,"./isArrayLike":77,"./isIndex":78}],80:[function(e,t,n){function r(e,t){var n=typeof e;if("string"==n&&u.test(e)||"number"==n)return!0;if(i(e))return!1;var r=!a.test(e);return r||null!=t&&e in o(t)}var i=e("../lang/isArray"),o=e("./toObject"),a=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\n\\]|\\.)*?\1)\]/,u=/^\w*$/;t.exports=r},{"../lang/isArray":88,"./toObject":85}],81:[function(e,t,n){function r(e){return"number"==typeof e&&e>-1&&e%1==0&&i>=e}var i=9007199254740991;t.exports=r},{}],82:[function(e,t,n){function r(e){return!!e&&"object"==typeof e}t.exports=r},{}],83:[function(e,t,n){function r(e){return e===e&&!i(e)}var i=e("../lang/isObject");t.exports=r},{"../lang/isObject":95}],84:[function(e,t,n){function r(e){for(var t=s(e),n=t.length,r=n&&e.length,l=!!r&&u(r)&&(o(e)||i(e)),f=-1,d=[];++f<n;){var h=t[f];(l&&a(h,r)||c.call(e,h))&&d.push(h)}return d}var i=e("../lang/isArguments"),o=e("../lang/isArray"),a=e("./isIndex"),u=e("./isLength"),s=e("../object/keysIn"),l=Object.prototype,c=l.hasOwnProperty;t.exports=r},{"../lang/isArguments":87,"../lang/isArray":88,"../object/keysIn":102,"./isIndex":78,"./isLength":81}],85:[function(e,t,n){function r(e){return i(e)?e:Object(e)}var i=e("../lang/isObject");t.exports=r},{"../lang/isObject":95}],86:[function(e,t,n){function r(e){if(o(e))return e;var t=[];return i(e).replace(a,function(e,n,r,i){t.push(r?i.replace(u,"$1"):n||e)}),t}var i=e("./baseToString"),o=e("../lang/isArray"),a=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\n\\]|\\.)*?)\2)\]/g,u=/\\(\\)?/g;t.exports=r},{"../lang/isArray":88,"./baseToString":63}],87:[function(e,t,n){function r(e){return o(e)&&i(e)&&u.call(e,"callee")&&!s.call(e,"callee")}var i=e("../internal/isArrayLike"),o=e("../internal/isObjectLike"),a=Object.prototype,u=a.hasOwnProperty,s=a.propertyIsEnumerable;t.exports=r},{"../internal/isArrayLike":77,"../internal/isObjectLike":82}],88:[function(e,t,n){var r=e("../internal/getNative"),i=e("../internal/isLength"),o=e("../internal/isObjectLike"),a="[object Array]",u=Object.prototype,s=u.toString,l=r(Array,"isArray"),c=l||function(e){return o(e)&&i(e.length)&&s.call(e)==a};t.exports=c},{"../internal/getNative":75,"../internal/isLength":81,"../internal/isObjectLike":82}],89:[function(e,t,n){function r(e){return null==e?!0:a(e)&&(o(e)||l(e)||i(e)||s(e)&&u(e.splice))?!e.length:!c(e).length}var i=e("./isArguments"),o=e("./isArray"),a=e("../internal/isArrayLike"),u=e("./isFunction"),s=e("../internal/isObjectLike"),l=e("./isString"),c=e("../object/keys");t.exports=r},{"../internal/isArrayLike":77,"../internal/isObjectLike":82,"../object/keys":101,"./isArguments":87,"./isArray":88,"./isFunction":91,"./isString":96}],90:[function(e,t,n){function r(e,t,n,r){n="function"==typeof n?o(n,r,3):void 0;var a=n?n(e,t):void 0;return void 0===a?i(e,t,n):!!a}var i=e("../internal/baseIsEqual"),o=e("../internal/bindCallback");t.exports=r},{"../internal/baseIsEqual":53,"../internal/bindCallback":65}],91:[function(e,t,n){function r(e){return i(e)&&u.call(e)==o}var i=e("./isObject"),o="[object Function]",a=Object.prototype,u=a.toString;t.exports=r},{"./isObject":95}],92:[function(e,t,n){function r(e){return i(e)&&e!=+e}var i=e("./isNumber");t.exports=r},{"./isNumber":94}],93:[function(e,t,n){function r(e){return null==e?!1:i(e)?c.test(s.call(e)):o(e)&&a.test(e)}var i=e("./isFunction"),o=e("../internal/isObjectLike"),a=/^\[object .+?Constructor\]$/,u=Object.prototype,s=Function.prototype.toString,l=u.hasOwnProperty,c=RegExp("^"+s.call(l).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");t.exports=r},{"../internal/isObjectLike":82,"./isFunction":91}],94:[function(e,t,n){function r(e){return"number"==typeof e||i(e)&&u.call(e)==o}var i=e("../internal/isObjectLike"),o="[object Number]",a=Object.prototype,u=a.toString;t.exports=r},{"../internal/isObjectLike":82}],95:[function(e,t,n){function r(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}t.exports=r},{}],96:[function(e,t,n){function r(e){return"string"==typeof e||i(e)&&u.call(e)==o}var i=e("../internal/isObjectLike"),o="[object String]",a=Object.prototype,u=a.toString;t.exports=r},{"../internal/isObjectLike":82}],97:[function(e,t,n){function r(e){return o(e)&&i(e.length)&&!!M[$.call(e)]}var i=e("../internal/isLength"),o=e("../internal/isObjectLike"),a="[object Arguments]",u="[object Array]",s="[object Boolean]",l="[object Date]",c="[object Error]",f="[object Function]",d="[object Map]",h="[object Number]",p="[object Object]",y="[object RegExp]",v="[object Set]",g="[object String]",m="[object WeakMap]",b="[object ArrayBuffer]",_="[object Float32Array]",w="[object Float64Array]",O="[object Int8Array]",x="[object Int16Array]",k="[object Int32Array]",j="[object Uint8Array]",E="[object Uint8ClampedArray]",A="[object Uint16Array]",S="[object Uint32Array]",M={};M[_]=M[w]=M[O]=M[x]=M[k]=M[j]=M[E]=M[A]=M[S]=!0,M[a]=M[u]=M[b]=M[s]=M[l]=M[c]=M[f]=M[d]=M[h]=M[p]=M[y]=M[v]=M[g]=M[m]=!1;var P=Object.prototype,$=P.toString;t.exports=r},{"../internal/isLength":81,"../internal/isObjectLike":82}],98:[function(e,t,n){function r(e){var t=e?o(e):0;return a(t)?t?i(e):[]:u(e)}var i=e("../internal/arrayCopy"),o=e("../internal/getLength"),a=e("../internal/isLength"),u=e("../object/values");t.exports=r},{"../internal/arrayCopy":37,"../internal/getLength":73,"../internal/isLength":81,"../object/values":104}],99:[function(e,t,n){var r=e("../internal/assignWith"),i=e("../internal/baseAssign"),o=e("../internal/createAssigner"),a=o(function(e,t,n){return n?r(e,t,n):i(e,t)});t.exports=a},{"../internal/assignWith":42,"../internal/baseAssign":43,"../internal/createAssigner":66}],100:[function(e,t,n){function r(e,t){if(null==e)return!1;var n=p.call(e,t);if(!n&&!l(t)){if(t=d(t),e=1==t.length?e:i(e,o(t,0,-1)),null==e)return!1;t=f(t),n=p.call(e,t)}return n||c(e.length)&&s(t,e.length)&&(u(e)||a(e))}var i=e("../internal/baseGet"),o=e("../internal/baseSlice"),a=e("../lang/isArguments"),u=e("../lang/isArray"),s=e("../internal/isIndex"),l=e("../internal/isKey"),c=e("../internal/isLength"),f=e("../array/last"),d=e("../internal/toPath"),h=Object.prototype,p=h.hasOwnProperty;t.exports=r},{"../array/last":23,"../internal/baseGet":51,"../internal/baseSlice":61,"../internal/isIndex":78,"../internal/isKey":80,"../internal/isLength":81,"../internal/toPath":86,"../lang/isArguments":87,"../lang/isArray":88}],101:[function(e,t,n){var r=e("../internal/getNative"),i=e("../internal/isArrayLike"),o=e("../lang/isObject"),a=e("../internal/shimKeys"),u=r(Object,"keys"),s=u?function(e){var t=null==e?void 0:e.constructor;return"function"==typeof t&&t.prototype===e||"function"!=typeof e&&i(e)?a(e):o(e)?u(e):[]}:a;t.exports=s},{"../internal/getNative":75,"../internal/isArrayLike":77,"../internal/shimKeys":84,"../lang/isObject":95}],102:[function(e,t,n){function r(e){if(null==e)return[];s(e)||(e=Object(e));var t=e.length;t=t&&u(t)&&(o(e)||i(e))&&t||0;for(var n=e.constructor,r=-1,l="function"==typeof n&&n.prototype===e,f=Array(t),d=t>0;++r<t;)f[r]=r+"";for(var h in e)d&&a(h,t)||"constructor"==h&&(l||!c.call(e,h))||f.push(h);return f}var i=e("../lang/isArguments"),o=e("../lang/isArray"),a=e("../internal/isIndex"),u=e("../internal/isLength"),s=e("../lang/isObject"),l=Object.prototype,c=l.hasOwnProperty;t.exports=r},{"../internal/isIndex":78,"../internal/isLength":81,"../lang/isArguments":87,"../lang/isArray":88,"../lang/isObject":95}],103:[function(e,t,n){function r(e){e=o(e);for(var t=-1,n=i(e),r=n.length,a=Array(r);++t<r;){var u=n[t];a[t]=[u,e[u]]}return a}var i=e("./keys"),o=e("../internal/toObject");t.exports=r},{"../internal/toObject":85,"./keys":101}],104:[function(e,t,n){function r(e){return i(e,o(e))}var i=e("../internal/baseValues"),o=e("./keys");t.exports=r},{"../internal/baseValues":64,"./keys":101}],105:[function(e,t,n){function r(e){return e}t.exports=r},{}],106:[function(e,t,n){function r(e){return a(e)?i(e):o(e)}var i=e("../internal/baseProperty"),o=e("../internal/basePropertyDeep"),a=e("../internal/isKey");t.exports=r},{"../internal/baseProperty":59,"../internal/basePropertyDeep":60,"../internal/isKey":80}]},{},[16])(16)});